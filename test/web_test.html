<!DOCTYPE html>
<html>
    <head>
        <title>StrategyBlocks Light Client Web Demo</title>
        <script src="/src/scripts/isv/require.js"></script>
        <link rel="stylesheet/less" type="text/css" href="/test/css/web_test.less">
        <script>
        	require.config({
        		baseUrl:"/src/scripts", 
        	});
        	
        	require( ['./sb','./isv/jquery-1.8.3.min', './isv/less-1.3.1.min'], function(sb, jquery, less) {
        		
        		$('#login_form').submit(function() {
        			var list = $(this).serializeArray();
        			sb.state.login(list[0].value, list[1].value);
        			return false;
        		});
        		
        		
				function handleSession(e) {
					if(sb.state.unauthorized()) {
						sb.ext.debug("Unauthorized. Prompting for authentication.");
						userLogin();	
					} else {
						sb.ext.debug("Authorized. Fetching blocks.");
						sb.models.subscribe("blocks", handleBlocks);
					}
				}
							
				function handleBlocks() {
					var blocks = sb.models.rawArray("blocks");
					sb.ext.debug("blocks: ", blocks ? blocks.length : "none");	
					changePage("blocksPage");
					
				}
			
				function userLogin() {
					changePage("loginPage");
					
				}
				
				function changePage(p) {
					$(".page").each(function(i,el) {
						console.log("EL: ", el);
						if(el.id == p) { 
							$(el).addClass("selected");
						} else {
							$(el).removeClass("selected");
						}
					});
				}
				
				sb.state.host = window.location.host;
				sb.AJAX = sb.ajax.jquery();
				sb.jquery = window.jQuery; //jQuery
				
				sb.state.subscribe("session", handleSession);
				//sb.model.subscribe("blocks", handleBlocks);
				sb.state.login();        		  		
        			
        	})
        </script>
        <style>
        	
        </style>
    </head>
    <body>
    	<div class="page selected" id="welcomePage">
    		<h1>StrategyBlocks Light Client Web Demo</h1>
    		
    	</div>
        <div class="page" id="loginPage">
			<form id="login_form" name="login_form" action="/login/auth.html" method="post">
				<div class="form-input-elements">
					<p>
						<label>Email: </label>
						<input size="40" type="text" name="username" id="email" tabindex="1"  value=""></input>
					</p>
					<p>
						<label>Password: </label>
						<input size="40" type="password" name="password" id="password" tabindex="2"></input>
					</p>
					<p class="forgot_password">
						<label>&nbsp;</label>
						<a href="#"  title="Forgot your password?" onclick="sblocks_forgot_password()" tabindex="4">Forgot your password?</a>
					</p>
					<input type="hidden" name="url_hash" value="" ></input>
				</div>
				<div class="form-buttons-container">
					<input name="Sign in"  class="signin-button" type="submit" id="Sign in" value="Sign in" title="Sign in" tabindex="3"></input>
					<div>
						or  &nbsp; <a href="/register.html" target="_blank" title="create an account" tabindex="5">create an account</a>.
					</div>
					<div class="clear"></div>
				</div>
			</form>        	
        </div>
        <div class="page" id="blocksPage">
        	  	
        	
        </div>
    </body>
</html>