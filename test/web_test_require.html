<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
    <head>
        <title>StrategyBlocks Light Client Web Demo</title>
        
        <script src="http://code.jquery.com/jquery-1.9.1.min.js" charset="utf-8"></script>
        <script src="/bin/sb_light_rjs.uncompressed.js"></script>

        <style>

        	html,body {
        		width:100%;height:100%;margin:0;padding:0;overflow: none;
        		font-family: Verdana, Arial, sans-serif;
        	}
        	.sb_light_widget {
        		position:absolute;
        	}
        </style>
    </head>
    <body>
    	<div id="console_output">
    	</div>

    	<script>
    		sb.state.host = "http://localhost:3000";
			sb.api.ajax = sb.ajax.jquery($);

    		var body = $("body").get(0);
    		var w = body.clientWidth;
    		var h = body.clientHeight;

			function showLoginPrompt() {
				var layout = sb.layout.parse(body, {
					id:"popup", widget:"div", width:500, height:450, left:(w/2-250), top:(h/2-225), 
					style:"position:absolute;border:solid 2px #9AF",
					children: [
						{id:"loginHeader", widget:"div", fringe:0, width:"100%", height:25, text:"Login to SB", 
						style:"background:#9AF;text-align:center;font-size:14px;color:#333;font-weight:bold; "},
						{id:"loginPage", widget:sb.widgets.login, fringe:0, top:25}
					]
				});

				layout.rootWidth =w;
				layout.rootHeight = h;
				sb.queue.high(sb.layout.resize.bind(sb.layout, layout), "loginPageResize");
			}
			function consoleDump(str) {
				var c = $("#console_output");
				c.append(sb.ext.slice(arguments).join(" | "));
			}

			function refreshData() {
				$("#popup").remove();
				var blocks = sb.models.rawArray("blocks");
				if(!blocks || !blocks.length) { return ; }
					
				consoleDump("root", sb.queries.rootBlock().title, blocks.length);
			}

			function handleSession() {
				consoleDump("sb.state.host", sb.state.host);
				if(sb.state.unknown() || sb.state.startup()) {
					consoleDump("try login");
					sb.state.login();
				} else if (sb.state.unauthorized()) {
					consoleDump("login Prompt");
					showLoginPrompt();
				} 			} 

			sb.models.subscribe("blocks", refreshData);
			sb.state.subscribe("session", handleSession);

			handleSession();


    	</script>
    </body>
</html>