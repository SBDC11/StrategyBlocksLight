<!DOCTYPE html>
<html>
    <head>
        <title>StrategyBlocks Light Client Web Demo</title>
        
        <script src="/test/lib/require.js"></script>

        <link rel="stylesheet/less" type="text/css" href="/test/css/web_test.less">

        <script>
        	require.config({
        		baseUrl:"/",
        		paths: {
        			"jquery":"/test/lib/jquery-1.8.3.min",	
        			"less":"/test/lib/less-1.3.3.min",
        			"sb_light":"/src/sb_light",
        			"widgets":"/src/widgets"
        		},
        		shim: {
        			"jquery": {exports: "$"},
        			"less": {exports:"less"}	
        		}
        	});
        	
        	require(["jquery", "less","sb_light/main"], function($,less,sb) {
        		
				console.log(sb);	
				sb.state.host = window.location.host;
				sb.api.ajax = sb.ajax.jquery($);

				var r = $("#test");

				r.width(1100).height(500);


				//execute in a different stack that the require stack -- pretty much removes a lot of cruft from debugging
				doLayoutTest.bindDelay(null, 100, sb, r);
			});


			function doLayoutTest(sb, r) {
				require(["widgets/formInput"], function(FormInput) {
					var layout = sb.layout.parse(r.get(0), [
						{id:"divA", widget:"DIV", left:50, right:50, top:"10%", height:"25%", style:"background-color:#ffeeee;border:solid 1px yellow; overflow:hidden;",  children: [
							{id:"divB", widget:"DIV", left:10, width:"20%", top:10, bottom:"auto", style:"background-color:#ffff00", text:"This needs to be a certain amount of text so autosize works. Then if I add more text it should keep growing"},
							{id:"divC", widget:"DIV", left:"@divB#right#10", width:"20%", height:"50%", bottom:"@divD#top", style:"background-color:#00ff00"},
							{id:"divD", widget:"DIV", left:"@divC#right#20", width:"20%", height:"50%", top:"25%", style:"background-color:#0000ff"},
							{id:"divE", widget:"DIV", left:"@divD#right#10", width:"20%", style:"background-color:#ff00ff"},
							{id:"textA", widget:"span", text:"Foo", fringe:"@divD#5"},
							{id:"textB", widget:"span", text:"	Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.", fringe:"@divE#1",  left:"@divE#5", right:"@divE#-17", height:"auto", style:"overflow:auto;" },

						]},
						{id:"formA", widget:"form", top:"@divA#bottom#10", left:50, right:50, height:"auto", style:"border:solid 1px blue;", children:[
							{id:"labelA", widget:"label", left:10, width:130, height:20, top:"@inputA#top", text:"Test Form A", style:"text-align:right"},
							{id:"inputA", widget:"input", left:"@labelA#right#20", width:250, height:20, top:10, text:"Test Form", value:"Test Input A"},
							{id:"errorA", widget:"error", left:"@inputA#right#20", width:250, height:20, top:"@inputA", text:"Error A"},
							{id:"labelB", widget:"label", left:10, width:130, height:20, top:"@inputB#top", text:"Test Form B", style:"text-align:right"},
							{id:"inputB", widget:"input", left:"@labelA#right#20", width:250, height:20, top:"@inputA#bottom#10", text:"Test Form", value:"Test Input B"},
							{id:"errorB", widget:"error", left:"@inputA#right#20", width:250, height:20, top:"@inputB", text:"Error B"},
							{id:"labelC", widget:"label", left:10, width:130, height:20, top:"@inputC#top", text:"Test Form C", style:"text-align:right"},
							{id:"inputC", widget:"input", left:"@labelA#right#20", width:250, height:20, top:"@inputB#bottom#10", text:"Test Form", value:"Test Input C"},
							{id:"errorC", widget:"error", left:"@inputA#right#20", width:250, height:20, top:"@inputC", text:"Error C"},
							// {id:"labelD", widget:"label", left:10, width:130, height:20, top:"@inputD#top", text:"Test Form D", style:"text-align:right"},
							// {id:"inputD", widget:"input", left:"@labelA#right#20", width:250, height:20, top:"@inputC#bottom#10", text:"Test Form", value:"Test Input D"},
							// {id:"errorD", widget:"error", left:"@inputA#right#20", width:250, height:20, top:"@inputD", text:"Error D"},
							{id:"inputD", widget:FormInput, left:10, right:10, height:20, top:"@inputC#bottom#10", label:"Test Form D", value:"Test Input D"},
							{id:"submit", widget:"button", right:"@inputA#right", width:100, height:25, top:"@inputD#bottom#10", text:"Submit"},

						]}
					]);

					//record the expected positions of the elements given the container is 1100 x 500
					//if you change the border of the root object, you might need to adjust the tolerance for "compareInt"
					// borders mean the size won't be exactly 1100X500
					var results = [  //left,	right,	top,	bottom,	width,	height
						["divA",		50, 	50, 	50, 	325,	1000,	125 ],
						["divB",		10,		790,	10,		36,		200,	78 ],
						["divC",		220,	580,	-31,	94,		200,	62.5 ],
						["divD",		440,	360,	31,		31,		200,	62.5 ],
						["divE",		650,	150,	0,		0,		200,	125 ],
						["textA",		445,	365,	36,		36,		190,	52 ],
						["textA",		445,	365,	36,		36,		190,	52 ],
						["inputD",		10,		10,		100,	35,		980,	20 ],

					]
					var keys = ["left",	"right",	"top",	"bottom",	"width",	"height"];
					var errors = [];
					results.forEach(function(row,i){
						sb.ext.slice(row,1).forEach(function(cell,i){
							var w = layout.widgets[row[0]];
							var act = sb.ext.floorTo(w.sizeFuncs(keys[i])("test"));
							var exp = sb.ext.floorTo(cell);
							if(sb.ext.compareInt(act,exp, 3) == false) {
								errors.push(row[0]+":"+keys[i]+" " + act+" ("+exp+")");
							}
						});
					});
	 	
					if(errors.length) {
						$("#output").text("Errors: ("+r.width() +", "+r.height()+") " + errors.join(", ")).css("color", "red");
					} else {
						$("#output").text("Tests Passed!").css("color", "green");
					}
				});
        	}
        </script>
        <style>
        	
        </style>
    </head>
    <body>
    	<div id="output" style="position:absolute;top:10px;left:20px;height:40px;border:solid 1px purple;background-color:#eeeeee;right:20px;"></div>
    	<div id="test" style="position:absolute; border:solid 1px black; top:100px;left:20px;" />
    </body>
</html>