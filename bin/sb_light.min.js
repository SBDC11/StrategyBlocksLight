/**
 * @version 0.1.0
 * 
 */

// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

define("sb_light/globals",["require"],function(){var t={version:(new Date).getTime()},e=function(){return t};return e()}),function(t){function e(t,e){return function(n){return u(t.call(this,n),e)}}function n(t){return function(e){return this.lang().ordinal(t.call(this,e))}}function r(){}function s(t){o(this,t)}function i(t){var e=this._data={},n=t.years||t.year||t.y||0,r=t.months||t.month||t.M||0,s=t.weeks||t.week||t.w||0,i=t.days||t.day||t.d||0,o=t.hours||t.hour||t.h||0,u=t.minutes||t.minute||t.m||0,l=t.seconds||t.second||t.s||0,c=t.milliseconds||t.millisecond||t.ms||0;this._milliseconds=c+1e3*l+6e4*u+36e5*o,this._days=i+7*s,this._months=r+12*n,e.milliseconds=c%1e3,l+=a(c/1e3),e.seconds=l%60,u+=a(l/60),e.minutes=u%60,o+=a(u/60),e.hours=o%24,i+=a(o/24),i+=7*s,e.days=i%30,r+=a(i/30),e.months=r%12,n+=a(r/12),e.years=n}function o(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(t){return 0>t?Math.ceil(t):Math.floor(t)}function u(t,e){for(var n=t+"";e>n.length;)n="0"+n;return n}function l(t,e,n){var r,s=e._milliseconds,i=e._days,o=e._months;s&&t._d.setTime(+t+s*n),i&&t.date(t.date()+i*n),o&&(r=t.date(),t.date(1).month(t.month()+o*n).date(Math.min(r,t.daysInMonth())))}function c(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t,e){var n,r=Math.min(t.length,e.length),s=Math.abs(t.length-e.length),i=0;for(n=0;r>n;n++)~~t[n]!==~~e[n]&&i++;return i+s}function h(t,e){return e.abbr=t,j[t]||(j[t]=new r),j[t].set(e),j[t]}function f(t){return t?(!j[t]&&R&&require("./lang/"+t),j[t]):L.fn._lang}function _(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function p(t){var e,n,r=t.match(F);for(e=0,n=r.length;n>e;e++)r[e]=ie[r[e]]?ie[r[e]]:_(r[e]);return function(s){var i="";for(e=0;n>e;e++)i+="function"==typeof r[e].call?r[e].call(s,t):r[e];return i}}function m(t,e){function n(e){return t.lang().longDateFormat(e)||e}for(var r=5;r--&&U.test(e);)e=e.replace(U,n);return ne[e]||(ne[e]=p(e)),ne[e](t)}function g(t){switch(t){case"DDDD":return H;case"YYYY":return z;case"YYYYY":return V;case"S":case"SS":case"SSS":case"DDD":return Y;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return W;case"X":return Z;case"Z":case"ZZ":return G;case"T":return q;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return K;default:return RegExp(t.replace("\\",""))}}function b(t,e,n){var r,s=n._a;switch(t){case"M":case"MM":s[1]=null==e?0:~~e-1;break;case"MMM":case"MMMM":r=f(n._l).monthsParse(e),null!=r?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=e&&(s[2]=~~e);break;case"YY":s[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~e;break;case"a":case"A":n._isPm="pm"===(e+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":s[3]=~~e;break;case"m":case"mm":s[4]=~~e;break;case"s":case"ss":s[5]=~~e;break;case"S":case"SS":case"SSS":s[6]=~~(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,r=(e+"").match($),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&"+"===r[0]&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}null==e&&(n._isValid=!1)}function y(t){var e,n,r=[];if(!t._d){for(e=0;7>e;e++)t._a[e]=r[e]=null==t._a[e]?2===e?1:0:t._a[e];r[3]+=t._tzh||0,r[4]+=t._tzm||0,n=new Date(0),t._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),t._d=n}}function v(t){var e,n,r=t._f.match(F),s=t._i;for(t._a=[],e=0;r.length>e;e++)n=(g(r[e]).exec(s)||[])[0],n&&(s=s.slice(s.indexOf(n)+n.length)),ie[r[e]]&&b(r[e],n,t);t._isPm&&12>t._a[3]&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),y(t)}function E(t){var e,n,r,i,a,u=99;for(i=t._f.length;i>0;i--){if(e=o({},t),e._f=t._f[i-1],v(e),n=new s(e),n.isValid()){r=n;break}a=d(e._a,n.toArray()),u>a&&(u=a,r=n)}o(t,r)}function w(t){var e,n=t._i;if(J.exec(n)){for(t._f="YYYY-MM-DDT",e=0;4>e;e++)if(Q[e][1].exec(n)){t._f+=Q[e][0];break}G.exec(n)&&(t._f+=" Z"),v(t)}else t._d=new Date(n)}function S(e){var n=e._i,r=N.exec(n);n===t?e._d=new Date:r?e._d=new Date(+r[1]):"string"==typeof n?w(e):c(n)?(e._a=n.slice(0),y(e)):e._d=n instanceof Date?new Date(+n):new Date(n)}function D(t,e,n,r,s){return s.relativeTime(e||1,!!n,t,r)}function k(t,e,n){var r=P(Math.abs(t)/1e3),s=P(r/60),i=P(s/60),o=P(i/24),a=P(o/365),u=45>r&&["s",r]||1===s&&["m"]||45>s&&["mm",s]||1===i&&["h"]||22>i&&["hh",i]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",P(o/30)]||1===a&&["y"]||["yy",a];return u[2]=e,u[3]=t>0,u[4]=n,D.apply({},u)}function x(t,e,n){var r=n-e,s=n-t.day();return s>r&&(s-=7),r-7>s&&(s+=7),Math.ceil(L(t).add("d",s).dayOfYear()/7)}function O(t){var e=t._i,n=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=f().preparse(e)),L.isMoment(e)?(t=o({},e),t._d=new Date(+e._d)):n?c(n)?E(t):v(t):S(t),new s(t))}function T(t,e){L.fn[t]=L.fn[t+"s"]=function(t){var n=this._isUTC?"UTC":"";return null!=t?(this._d["set"+n+e](t),this):this._d["get"+n+e]()}}function M(t){L.duration.fn[t]=function(){return this._data[t]}}function A(t,e){L.duration.fn["as"+t]=function(){return+this/e}}for(var L,C,I="2.0.0",P=Math.round,j={},R="undefined"!=typeof module&&module.exports,N=/^\/?Date\((\-?\d+)/i,B=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,F=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,K=/\d\d?/,Y=/\d{1,3}/,H=/\d{3}/,z=/\d{1,4}/,V=/[+\-]?\d{1,6}/,W=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,G=/Z|[\+\-]\d\d:?\d\d/i,q=/T/i,Z=/[\+\-]?\d+(\.\d{1,3})?/,J=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,X="YYYY-MM-DDTHH:mm:ssZ",Q=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],$=/([\+\-]|\d\d)/gi,te="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ee={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ne={},re="DDD w W M D d".split(" "),se="M D H h m s w W".split(" "),ie={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},YYYYY:function(){return u(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return u(~~(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(~~(t/60),2)+":"+u(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(~~(10*t/6),4)},X:function(){return this.unix()}};re.length;)C=re.pop(),ie[C+"o"]=n(ie[C]);for(;se.length;)C=se.pop(),ie[C+C]=e(ie[C],2);for(ie.DDDD=e(ie.DDD,3),r.prototype={set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,r;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=L([2e3,e]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=RegExp(r.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=L([2e3,1]).day(e),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=RegExp(r.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,r){var s=this._relativeTime[n];return"function"==typeof s?s(t,e,n,r):s.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return x(t,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},L=function(t,e,n){return O({_i:t,_f:e,_l:n,_isUTC:!1})},L.utc=function(t,e,n){return O({_useUTC:!0,_isUTC:!0,_l:n,_i:t,_f:e})},L.unix=function(t){return L(1e3*t)},L.duration=function(t,e){var n,r,s=L.isDuration(t),o="number"==typeof t,a=s?t._data:o?{}:t,u=B.exec(t);return o?e?a[e]=t:a.milliseconds=t:u&&(n="-"===u[1]?-1:1,a={y:0,d:~~u[2]*n,h:~~u[3]*n,m:~~u[4]*n,s:~~u[5]*n,ms:~~u[6]*n}),r=new i(a),s&&t.hasOwnProperty("_lang")&&(r._lang=t._lang),r},L.version=I,L.defaultFormat=X,L.lang=function(e,n){return e?(n?h(e,n):j[e]||f(e),L.duration.fn._lang=L.fn._lang=f(e),t):L.fn._lang._abbr},L.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),f(t)},L.isMoment=function(t){return t instanceof s},L.isDuration=function(t){return t instanceof i},L.fn=s.prototype={clone:function(){return L(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return L(this).utc().format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!d(this._a,(this._isUTC?L.utc(this._a):L(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(t){var e=m(this,t||L.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t?L.duration(+e,t):L.duration(t,e),l(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t?L.duration(+e,t):L.duration(t,e),l(this,n,-1),this},diff:function(t,e,n){var r,s,i=this._isUTC?L(t).utc():L(t).local(),o=6e4*(this.zone()-i.zone());return e&&(e=e.replace(/s$/,"")),"year"===e||"month"===e?(r=432e5*(this.daysInMonth()+i.daysInMonth()),s=12*(this.year()-i.year())+(this.month()-i.month()),s+=(this-L(this).startOf("month")-(i-L(i).startOf("month")))/r,"year"===e&&(s/=12)):(r=this-i-o,s="second"===e?r/1e3:"minute"===e?r/6e4:"hour"===e?r/36e5:"day"===e?r/864e5:"week"===e?r/6048e5:r),n?s:a(s)},from:function(t,e){return L.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(L(),t)},calendar:function(){var t=this.diff(L().startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return 0===t%4&&0!==t%100||0===t%400},isDST:function(){return L([this.year()]).zone()>this.zone()||L([this.year(),5]).zone()>this.zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(this._d["set"+e+"Month"](t),this):this._d["get"+e+"Month"]()},startOf:function(t){switch(t=t.replace(/(.)s$/,"$1")){case"year":case"y":this.month(0);case"month":case"M":this.date(1);case"week":case"w":case"day":case"d":this.hours(0);case"hour":case"h":this.minutes(0);case"minute":case"m":this.seconds(0);case"second":case"s":this.milliseconds(0)}return("week"===t||"w"===t)&&this.day(0),this},endOf:function(t){return this.startOf(t).add(t,1).subtract("ms",1)},isAfter:function(e,n){return n=n!==t?n:"millisecond",+this.clone().startOf(n)>+L(e).startOf(n)},isBefore:function(e,n){return n=n!==t?n:"millisecond",+L(e).startOf(n)>+this.clone().startOf(n)},isSame:function(e,n){return n=n!==t?n:"millisecond",+this.clone().startOf(n)===+L(e).startOf(n)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return L.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=P((L(this).startOf("day")-L(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},isoWeek:function(t){var e=x(this,1,4);return null==t?e:this.add("d",7*(t-e))},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},lang:function(e){return e===t?this._lang:(this._lang=f(e),this)}},C=0;te.length>C;C++)T(te[C].toLowerCase().replace(/s$/,""),te[C]);T("year","FullYear"),L.fn.days=L.fn.day,L.fn.months=L.fn.month,L.fn.weeks=L.fn.week,L.fn.isoWeeks=L.fn.isoWeek,L.duration.fn=i.prototype={weeks:function(){return a(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,n=k(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},get:function(t){return this[t.toLowerCase()]()},as:function(t){var e=t.toLowerCase();return this["as"+e.charAt(0).toUpperCase()+e.slice(1)]()},lang:L.fn.lang};for(C in ee)ee.hasOwnProperty(C)&&(A(C,ee[C]),M(C.toLowerCase()));A("Weeks",6048e5),L.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},L.lang("en",{ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),R&&(module.exports=L),"undefined"==typeof ender&&(this.moment=L),"function"==typeof define&&define.amd&&define("sb_light/lib/moment",[],function(){return L})}.call(this),define("sb_light/utils/ext",["sb_light/globals"],function(t){var e={};return e._unique=0,e.unique=function(){return++e._unique},e.slice=function(t,e,n){return e=isNaN(e)?0:e,isNaN(n)?Array.prototype.slice.call(t,e):Array.prototype.slice.call(t,e,n)},e.debug=function(){if(t.debug){var n=[(new Date).toTimeString()].concat(e.slice(arguments)).join(" ");e.ti()?Ti.API.debug(n):"undefined"!=typeof console&&console.log(n)}},e.ti=function(){return"undefined"!=typeof Ti},e.map=function(t,n,r){var s,i,o=[];if(e.isArray(t))for(s=0,i=t.length;i>s;++s)o.push(n.call(r||this,t[s],s,t));else for(var a in t)o.push(n.call(r||this,t[a],a,t));return o},e.each=function(t,n,r){if(e.isArray(t))t.forEach(n,r);else for(var s in t)n.call(r||t,t[s],s,t)},e.set=function(t,e,n){return t[e]=n,t},e.length=function(t){return e.isArray(t)?t.length:t?Object.keys(t).length:0},e.toObject=function(t,e){return t.reduce(function(t,n){return t[n[e]]=n,t},{})},e.values=function(t,n){return e.map(t,function(t){return n?t[n]:t})},e.keys=function(t){return t?Object.keys(t):[]},e.deepClone=function(t){return JSON.parse(JSON.stringify(t))},e.valid=function(t,n){switch(n||"object"){case"object":return null!==t&&t!==void 0;case"arr":case"array":return e.isArr(t);case"func":case"function":return e.isFunc(t);case"str":case"string":return e.isStr(t)&&""!==t;case"num":case"number":return e.isNum(t)&&!isNaN(t)}},e.isArr=function(t){return"[object Array]"==Object.prototype.toString.call(t)},e.isArray=e.isArr,e.isFunc=function(t){return"[object Function]"==Object.prototype.toString.call(t)},e.isFunction=e.isFunc,e.isStr=function(t){return"[object String]"==Object.prototype.toString.call(t)},e.isString=e.isStr,e.isBool=function(t){return"[object Boolean]"==Object.prototype.toString.call(t)},e.isBoolean=e.isBool,e.isNum=function(t){return"[object Number]"==Object.prototype.toString.call(t)},e.isNumber=e.isNum,e.isDate=function(t){return"[object Date]"==Object.prototype.toString.call(t)},e._getClass={}.toString,e.caps=function(t){return t=e.isArray(t)?t:[t],t.reduce(function(t,e){return e?(t?t+" ":"")+e.charAt(0).toUpperCase()+e.slice(1):t},null)},e.capitalize=e.caps,e.replace=function(t,n){var r=t;return e.each(n,function(t,e){var n=RegExp("%"+e.toUpperCase()+"%");r=r.replace(n,t)}),r},e.time=function(){return(new Date).getTime()},e.parseDate=function(e){return t.moment(e).toDate()},e.daysDiff=function(e,n){return t.moment(n).diff(t.moment(e),"days")},e.today=function(){return new Date},e.minDate=function(){return e.parseDate(e.slice(arguments).sort(e.sortDate)[0])},e.maxDate=function(){return e.parseDate(e.slice(arguments).sort(e.sortDate).last())},e.serverFormat="YYYY/MM/DD",e.userFormat=function(){var n=t.state&&t.state.value("user");return n?n.date_format:e.serverFormat},e.serverDate=function(n){return t.moment(n||new Date).format(e.serverFormat)},e.userDate=function(n){return t.moment(n||new Date).format(e.userFormat())},e.dateFromNow=function(n,r,s){return s?"("+t.moment(n).fromNow()+") "+t.moment(n).format(r||e.userFormat()):t.moment(n).format(r||e.userFormat())+" ("+t.moment(n).fromNow()+")"},e.regEmail=RegExp("([\\w-\\.]+)@((?:[\\w]+\\.)+)([a-zA-Z]{2,4})"),e.regUrl=RegExp("^https?://"),e.sortFactory=function(t,e,n){return function(r,s){var i=r?r[t]:null,o=s?s[t]:null;return e(i,o)*(n?-1:1)}},e.sortTime=function(t,n){return e.sortNumbers(e.parseDate(t).getTime(),e.parseDate(n).getTime())},e.sortNumber=function(t,e){return t-e},e.sortNumbers=e.sortNumber,e.sortDate=function(t,n){return e.daysDiff(n,t)},e.sortDates=e.sortDate,e.sortString=function(t,e){return(t+"").localeCompare(e+"")},e.sortStrings=e.sortString,e.sortBool=function(t,n){return e.sortNumber(t?1:0,n?1:0)},e.sortBoolean=e.sortBool,e.sortDateValue=function(t,n){return e.sortDate(t.date,n.date)},e.sortUsers=function(){return e.sortFunc("last_name",e.sortString)},e.sortFocus=function(){return e.sortFunc("title",e.sortString)},e.sortName=function(){return e.sortFunc("name",e.sortString)},e.sortBlocksByProgress=function(t,n){var r=t.closed,s=n.closed;if(r&&!s)return 1;if(!r&&s)return-1;var i="new"==t.ownership_state,o="new"==n.ownership_state;if(i&&!o)return 1;if(!i&&o)return-1;if(i&&o||r&&s)return e.sortString(t.title,n.title);var a=t.expected_progress,u=n.expected_progress;return!a&&u?1:a&&!u?-1:a||u?e.sortNumbers(t.percent_progress/a,n.percent_progress/u):0},e.px=function(t){return[t,"px"].join("")},e.pc=function(t){return[t,"%"].join("")},e.roundTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.round(t*r)/r},e.floorTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.floor(t*r)/r},e.ceilTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.ceil(t*r)/r},e.to_i=function(t,n,r){var s=parseInt(t,n||10);return isNaN(s)?e.number(r,0):s},e.to_f=function(t,n){var r=parseFloat(t);return isNaN(r)?e.number(n,0):r},e.rand=function(t,n,r){return e.floorTo(Math.random()*(n-t+1),r)+t},e.to_color=function(t){return"#"+("00000"+(0|t).toString(16)).substr(-6)},e.number=function(t,n){return t=e.isFunc(t)?t():t,t=e.isArr(t)&&e.isFunc(t[0])?t[0].apply(null,t.slice(1)):t,isNaN(t)?n||0:t},e.max=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.NEGATIVE_INFINITY)}),n=t.reduce(function(t,e){return t>e?t:e},Number.NEGATIVE_INFINITY);return n},e.min=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.POSITIVE_INFINITY)}),n=t.reduce(function(t,e){return e>t?t:e},Number.POSITIVE_INFINITY);return n},e.range=function(t,n,r){return e.max(t,e.min(n,r))},e.snapto=function(t,e){for(var n=Math.abs(t[0]-e),r=t[0],s=1;t.length>s;++s)n>Math.abs(t[s]-e)&&(n=Math.abs(t[s]-e),r=t[s]);return r},e.sum=function(){var t=e.slice(arguments).map(function(t){return e.number(t)}),n=t.reduce(function(t,n){return t+e.number(n)},0);return n},e.diff=function(){var t=e.number(arguments[0]),n=e.slice(arguments,1).map(function(t){return e.number(t)}),r=n.reduce(function(t,n){return t-e.number(n)},t);return r},e.prod=function(){var t=e.slice(arguments).map(function(t){return e.number(t,1)}),n=t.reduce(function(t,n){return t*e.number(n)},1);return n},e.compareInt=function(t,n,r){return r=e.number(r,0),r>=Math.abs(t-n)},e.healthColor=function(t){return["#D80000","#EACF00","#0FAD00"][t.status+1]},e.healthText=function(t){return["Bad","Warning","Good"][t.status+1]},e.blockProgressFill=function(t){switch(t.progress_color){case"green":return["#176717","url(#progressGood)"];case"yellow":return["#77771B","url(#progressWarning)"];case"red":return["#641717","url(#progressBad)"];default:return["#999","url(#progressNone)"]}},e.getResultMessages=function(t){var n={errors:null,warnings:null,notices:null};return t&&(e.isArray(t.result)?t.result.forEach(function(e){e&&e.errors&&(n.errors={form:t.result.errors,message:JSON.stringify(t.result)})}):t.result&&t.result.errors&&(n.errors={form:t.result.errors,message:JSON.stringify(t.result)}),!n.errors&&t.flash&&t.flash.error&&(n.errors={message:t.flash.error}),!n.errors&&t.errors&&t.errors.error&&(n.errors={message:t.errors.error})),n.notices=t.flash.notice,n.warnings=t.flash.warning,n},e.massageTA=function(t){var n=[];t.values.forEach(function(t){t.date=e.parseDate(t.date),n.punique(t.date)}),t.values.sort(e.sortDateValue),t.target.forEach(function(r){r.date=e.parseDate(r.date),n.punique(r.date);var s=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_start:t.tolerance.range_end,i=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_end:t.tolerance.range_start;r.upper=r.value+(t.tolerance.percentage?r.value*s/100:s),r.lower=r.value+(t.tolerance.percentage?r.value*i/100:i)}),t.target.sort(e.sortDateValue),t.dates=n.sort(e.sortDate);var r=new Date;return t.dates[0].getTime()>r.getTime()&&t.dates.unshift(r),r.getTime()>t.dates.last().getTime()&&t.dates.put(r),t},e.massageHealth=function(t){var n=e.map(t.historical_values,function(t,n){return{date:e.parseDate(n),value:t}});return t.series=n.sort(e.sortDateValue),t.dates=t.series.map(function(t){return t.date}),t.dates.push(e.parseDate(t.end_date)),t},e.mixin=function(t,n,r){var s=r||{};t=t||{},n=n||{};var i,o;for(i in n){o=n[i];var a=e.isArray(s)?s.indexOf(i)>=0:i in s;a||(t[i]=o)}return t},e.combine=function(t,n){t=e.isArray(t)?t.concat(e.slice(arguments,1)):e.slice(arguments);var r=t.reduce(function(t,r){var s=e.mixin(t,r,n);return s},{});return r},e.merge=function(t,n,r){return e.combine([t,n],r)},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var n=0,r=this.length;r>n;++n)t.call(e||this,this[n],n,this)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=e.slice(arguments,1),r=this,s=function(){},i=function(){return r.apply(this instanceof s?this:t,n.concat(e.slice(arguments)))};return s.prototype=this.prototype,i.prototype=new s,i}),Function.prototype.bindDelay||(Function.prototype.bindDelay=function(t,e){var n=this,r=t,s=Array.prototype.slice.call(arguments,2);return setTimeout(function(){n.apply(r,s)},e)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var n=0,r=this.length;r>n;++n)t.call(e||this,this[n],n,this)}),Array.prototype.clone||(Array.prototype.clone=function(){return[].concat(this)}),Array.prototype.last||(Array.prototype.last=function(t){return t=this.length-1-(t||0),this.length>t&&t>=0?this[t]:null}),Array.prototype.reduce||(Array.prototype.reduce=function(t){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var e,n=0,r=this.length>>0;if("function"!=typeof t)throw new TypeError("First argument is not callable");if(2>arguments.length){if(0===r)throw new TypeError("Array length is 0 and no second argument");e=this[0],n=1}else e=arguments[1];for(;r>n;)n in this&&(e=t.call(void 0,e,this[n],n,this)),++n;return e}),Array.prototype.filter||(Array.prototype.filter=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],s=arguments[1],i=0;n>i;i++)if(i in e){var o=e[i];t.call(s,o,i,e)&&r.push(o)}return r}),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var i=[];for(var o in s)t.call(s,o)&&i.push(o);if(e)for(var a=0;r>a;a++)t.call(s,n[a])&&i.push(n[a]);return i}}()),Array.prototype.find||(Array.prototype.find=function(t,e){for(var n=0;this.length>n;++n)if(this[n][t]==e)return{index:n,value:this[n]};return{index:0/0,value:null}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:0!=r&&1/0!=r&&r!=-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var s=r>=0?r:Math.max(n-Math.abs(r),0);n>s;s++)if(s in e&&e[s]===t)return s;return-1}),Array.prototype.map||(Array.prototype.map=function(t,e){var n,r,s;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(n=e),r=Array(o),s=0;o>s;){var a,u;s in i&&(a=i[s],u=t.call(n,a,s,i),r[s]=u),s++}return r}),Array.prototype.put||(Array.prototype.put=function(){for(var t=e.slice(arguments);t.length;)this[this.length]=t.shift();return this}),Array.prototype.punique||(Array.prototype.punique=function(){for(var t=e.slice(arguments);t.length;){var n=t.shift();0>this.indexOf(n)&&(this[this.length]=n)}return this}),Array.prototype.cloneExcept||(Array.prototype.cloneExcept=function(){var t=e.slice(arguments);return this.reduce(function(e,n){return 0>t.indexOf(n)?e.put(n):e},[])}),Date.prototype.getMonthName=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names_short[this.getMonth()]},Date.locale={en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},e}),define("sb_light/utils/svg",["sb_light/globals"],function(t){var e={},n="undefined"!=typeof d3&&d3||{__missing:!0};e.ZERO=1e-6,e.extendD3=function(t,e){n.__missing||(n.selection.prototype[t]=n.transition.prototype[t]=n.selection.enter.prototype[t]=e)},e.extendD3("rect",function(){var e=this,n=t.ext.slice(arguments);return n.length?(["x","y","width","height"].forEach(function(t,r){null!==n[r]&&e.dim(t,n[r])}),e):["x","y","width","height"].reduce(function(n,r){return t.ext.set(n,r,e.dim(r))},{})}),e.extendD3("dim",function(n,r){return arguments.length?this.attr(n,e.isSvg(this.node()||t.ext.isFunc(r))?r:t.ext.px(r)):t.ext.to_f(this.attr(n))}),e.extendD3("corners",function(t,e){return arguments.length?(this.dim("rx",t),this.dim("ry",e),this):{rx:this.dim("rx"),ry:this.dim("ry")}}),e.extendD3("class",function(){var e=t.ext.slice(arguments);return e.length?(this.attr("class",e.join(" ")),this):this.attr("class")}),e.extendD3("circle",function(t,e,n){return arguments.length?(this.dim("r",t),this.dim("cx",e),this.dim("cy",n),this):{r:this.dim("r"),cx:this.dim("cx"),cy:this.dim("cy")}}),e.extendD3("line",function(t,e,n,r){return arguments.length?(this.dim("x1",t),this.dim("x2",n),this.dim("y1",e),this.dim("y2",r),this):{x1:this.dim("x1"),y1:this.dim("y1"),x2:this.dim("x2"),y2:this.dim("y2")}}),e.isSvg=function(t){return null!=t.ownerSVGElement},e.multiline=function(e,n,r,s){if(n){e=d3.select(e);var i=e.attr("width"),o=n.split(" "),a=e.append("tspan");a.text(o[0]);for(var u=1;o.length>u;u++){var l=a.text();l.length,a.text(l+" "+o[u]),a.node().getComputedTextLength()>i&&(a.text(l),a=e.append("tspan").attr("x",t.ext.number(r,10)).attr("dy",t.ext.number(s,18)).text(o[u]))}return e}},e.gridPath=function(t,e,n,r,s,i){var o=[],a=this,u="number"==typeof s?d3.range(t+s,t+n,s):s;i=i||s;var l="number"==typeof i?d3.range(e+i,e+r,i):i;return u.forEach(function(t){o.put(a.M(t,e),a.v(r))}),l.forEach(function(e){o.put(a.M(t,e),a.h(n))}),o.join("")},e.popupPath=function(t,e,n,r,s){var i=10,o=2*i,a=15,u=2*a,l=15,c=this;s=s||"TM";var d=[];if("T"==s.charAt(0)){switch(d.put(c.M(t+i,e)),s.charAt(1)){case"L":d.put(c.l(a,-l),c.l(a,l),c.h(n-u-o));break;case"M":d.put(c.h((n-o-u)/2),c.l(a,-l),c.l(a,l),c.h((n-o-u)/2));break;case"R":d.put(c.h(n-u-o),c.l(a,-l),c.l(a,l))}d.put(c.q(i,0,i,i),c.v(r-o)),d.put(c.q(0,i,-i,i),c.h(o-n)),d.put(c.q(-i,0,-i,-i),c.v(o-r)),d.put(c.q(0,-i,i,-i))}else"R"==s.charAt(0)||"B"==s.charAt(0)||"L"==s.charAt(0);return d.join("")},e.transform=function(t){var e=[];return t.r&&e.put(this.rotate.apply(this,t.r)),t.s&&e.put(this.scale.apply(this,t.s)),t.t&&e.put(this.translate.apply(this,t.t)),console.log("transform",e.join(" ")),e.join(" ")};var r=",";e.translate=function(t,e){return(isNaN(e)?["translate(",t,")"]:["translate(",t,", ",e,")"]).join("")},e.scale=function(t,e){return(isNaN(e)?["scale(",t,")"]:["scale(",t,", ",e,")"]).join("")},e.rotate=function(t){return"rotate("+t+")"},e.viewBox=function(t,e,n,r){return[t,e,n,r].join(" ")},e.l=function(t,e){return["l",t,r,e].join("")},e.L=function(t,e){return["L",t,r,e].join("")},e.m=function(t,e){return["m",t,r,e].join("")},e.M=function(t,e){return["M",t,r,e].join("")},e.h=function(t){return["h",t].join("")},e.H=function(t){return["H",t].join("")},e.v=function(t){return["v",t].join("")},e.V=function(t){return["V",t].join("")},e.q=function(t,e,n,s){var i=r;return["q",t,i,e,i,n,i,s].join("")},e.Q=function(t,e,n,s){var i=r;return["Q",t,i,e,i,n,i,s].join("")},e.path=function(){return t.ext.slice(arguments).join("")},e.append=function(t,e,n){var r=t.select(e);if(r.empty()){r=t;var s=e.split(" ");s.forEach(function(t){if(t&&t.length>0)if(r.select(t).empty()){var e=t.split(".");r=r.append(e.shift()).attr("class",e.join(" "))}else r=r.select(t)}),n&&n(r)}return r},e.remove=function(t,e){var n=t.select(e);n.empty()||n.remove()},e.dims=function(t,e,n,r,s){return s.attr("x",t).attr("y",e).attr("width",n).attr("height",r),s
},e.dim=function(e,n,r){return 3==arguments.length?e.attr(n,r):t.ext.to_f(e.attr(n))},e.style=function(t){for(var e=1;arguments.length>e;e+=2){var n=arguments[e];n=s[n]||n,t.style(n,arguments[e+1])}return t};var s={t:"font",f:"fill",fo:"fill-opacity",s:"stroke",so:"stroke-opacity",sw:"stroke-width",slc:"stroke-linecap",slj:"stroke-linejoin",sda:"stroke-dasharray",ta:"text-anchor"};return e}),define("sb_light/utils/queue",["sb_light/globals"],function(t){var e={},n=[],r=[],s=0,i=function(){e.next(),i=function(){}};e.interval=function(t){return arguments.length&&(s=t),s},e.add=function(e,r,s){s=t.ext.number(s,0),r=r||"queued_"+t.ext.unique();var o=n.find("name",r).value;o||(n.push({name:r,func:e,time:t.ext.time(),delay:s}),i())},e.high=function(e,n,s){s=t.ext.number(s,0),n=n||"queued_"+t.ext.unique();var o=r.find("name",n).value;o||(r.push({name:n,func:e,time:t.ext.time(),delay:s}),i())},e.next=function(){o(r)||o(n),e.next.bindDelay(e,s)};var o=function(e){for(var n=t.ext.time(),r=e.length,s=0,i=!1,o=[];r>s&&!i;){var a=e.shift();n-a.time>a.delay?(a.func(),i=!0):o.push(a),s+=1}return e.unshift.apply(e,o),i};return e.report=function(){r.map(function(t){return t.name}).join(" "),n.map(function(t){return t.name}).join(" ")},e}),define("sb_light/utils/events",["sb_light/globals"],function(){var t={};return t.stop=function(t){t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),t&&t.preventDefault&&t.preventDefault()},t}),define("sb_light/utils/Class",[],function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(n){function r(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var i=new this;t=!1;for(var o in n)i[o]="function"==typeof n[o]&&"function"==typeof s[o]&&e.test(n[o])?function(t,e){return function(){var n=this._super;this._super=s[t];var r=e.apply(this,arguments);return this._super=n,r}}(o,n[o]):n[o];return r.prototype=i,r.prototype.constructor=r,r.extend=arguments.callee,r},Class}),define("widgets/widget",["sb_light/utils/Class"],function(t){var e=t.extend({_sb:null,_dom:null,_def:null,_domFuncs:null,_sizeFuncs:null,_sizeDefs:null,_parent:null,_name:null,_events:null,_binds:null,_props:null,init:function(t,e,n){this._sb=t,this._props=this._buildPropsList(),this._binds={},this._sizeFuncs={},this._sizeDefs={},this._parent=e,this._def=n,this._domFuncs=this._propertyOverrides();try{this.create(),this.postCreate()}catch(r){throw console.log("Failed to create widget "+n.id+" "+JSON.stringify(r.message?r.message+"\n"+r.source:r)),Error("Failed to create widget "+n.id+" "+JSON.stringify(r.message?r.message+"\n"+r.source:r))}},bind:function(t){if(!this._binds[t]){if(!this[t])throw Error("SB_Light Widget ("+t+") is not a function of : "+this.id());this._binds[t]=this[t].bind(this)}return this._binds[t]},_buildPropsList:function(){var t=[];for(var e in this)t.push(e);return t.join(",")},has:function(t){var e=RegExp("(^|,)_?"+t+"(,|$)");return this._props.match(e)},create:function(){this._dom=this.createDom(this._def),this.parentDom().appendChild(this._dom)},postCreate:function(){this.applyProperties()},dom:function(){return this._dom},id:function(){return this._def.id||this._dom.id},name:function(){return this._name||this._def.widget},parentId:function(){return this._parent?this._sb.ext.isFunc(this._parent.id)?this._parent.id():this._parent.id:null},parentDom:function(){return this._parent?this._sb.ext.isFunc(this._parent.dom)?this._parent.dom():this._parent:null},cid:function(t){return[this.id(),t].join("_")},_dims:{b:"bottom",l:"left",r:"right",t:"top",h:"height",w:"width",f:"fringe"},_dimReg:/left|right|top|bottom|height|width|fringe/,cidDim:function(t,e,n){var r=(this._dims[e]||e||"")+"",s=["@",this.cid(t)],r=r.match(this._dimReg)?r:null,i=2!=arguments.length||r?n||0:e;return r&&s.put("#",r),s.put("#",i),s.join("")},_noop:function(){},_propertyOverrides:function(){return{"default":this.bind("property"),subscribe:this.bind("subscribe"),css:this.bind("cssText"),style:this.bind("cssText"),widget:this._noop,"widget-name":this.bind("dataProperty"),"class":this.bind("className"),children:this._noop,text:this.bind("text"),left:this._noop,right:this._noop,top:this._noop,bottom:this._noop,x:this._noop,y:this._noop,height:this._noop,width:this._noop,fringe:this._noop}},appendChild:function(t){this._dom&&t&&this._dom.appendChild(t)},createDom:function(t){if(!t.widget)throw Error("The 'widget' option must be specified, and be the name of a valid HTML element.");return document.createElement(t.widget)},applyProperties:function(){this._def["class"]=(this._def["class"]||"")+" sb_light_widget",this._def["widget-name"]=this.name();for(var t in this._def){var e=this._domFuncs[t]||this._domFuncs["default"];e(t,this._def[t])}},prop:function(t,e){var n;if(n=this.has("_"+t)?"_"+t:t,!this.has(n))throw Error("SB_Light Widget ("+t+") is not a property of : "+this._name);return arguments.length>1?(this[n]=e,this):this[n]},source:function(t,e){return arguments.length>1?(this._def[t]=e,this):this._def[t]===void 0?null:this._def[t]},className:function(){var t=this._sb.ext.slice(arguments,"class"==arguments[0]?1:0);if(t.length){var e=this.dom();return t[0].split(" ").forEach(function(n){if(""!==n){var r=e.className.replace(n," ");e.className=r+(t[1]?"":" "+n)}}),this}return this.dom().className},property:function(t,e){return arguments.length>1?(this._dom.setAttribute(t,e),this):this._dom.getAttribute(t)},subscribe:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0),e=t[0];for(var n in e){var r=e[n];if(!this._events[n])throw Error("SB_Light Widget ("+this._name+") does not provide the event: "+n);this._events[n]=this._events[n]||{},this._events[n][r.id]=r.func}},unsubscribe:function(t,e){this._events&&this._events[t]&&delete this._events[t][e]},trigger:function(t){if(this._sb.ext.slice(arguments,2),this._events&&this._events[t])for(var e in this._events[t])this._sb.queue.add(this._events[t][e])},dataProperty:function(t,e){this.property.call(this,"data-"+t,e)},cssText:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.style.cssText=t[0],this):this._dom.style.cssText},text:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.textContent=t[0],this):this._dom.textContent},sizeDefs:function(t,e){return arguments.length>1?(this._sizeDefs[t]=e,this):this._sizeDefs[t]},sizeFuncs:function(t,e){return arguments.length>1?(this._sizeFuncs[t]=e,this):this._sizeFuncs[t]},applyLayout:function(){this.dom();var t=this.bind("dim");this._sb.ext.px;var e=this.bind("sizeFuncs");["left","top","width","height"].forEach(function(n){t(n,e(n)())}),this._sb.queue.add(this.bind("handleResize"),"handleResize_"+this.id())},handleResize:function(){},_provideEvents:function(){var t=this._sb.ext.slice(arguments);this._events=this._events||{};for(var e=0;arguments.length>e;++e)this._events[t]={}},dim:function(t,e){return arguments.length>1?(this.dom().style[t]=this._sb.ext.px(e),this):this._sb.ext.to_i(this.dom().style[t])},rect:function(){return{x:this.dim("left"),y:this.dim("top"),width:this.dim("width"),height:this.dim("height")}}});return e}),define("widgets/svg",["widgets/widget"],function(t){var e=t.extend({_d3:null,_pd3:null,_svgDiv:null,_children:null,_rootElement:null,_dispatcher:null,_width:null,_height:null,_left:null,_top:null,init:function(t,e,n,r){if(!d3)throw"You need to load the d3.js library to use SVG widgets";this._rootElement=r||(t.ext.isStr(n.widget)?n.widget:"svg"),this._super(t,e,n)},create:function(){this._name=this._name||this._rootElement+" "+this.id(),this._children={},this._dispatches=this._dispatches||{},this._pd3=d3.select(this.parentDom()),this._d3=this.createDom(this._def),this._dom=this._d3.node(),this.createChildren(this.childrenLayout())},postCreate:function(){var t=this._sb.ext.keys(this._def.dispatches);t.length&&(this._dispatcher=d3.dispatch.apply(d3,t)),this._super()},pd3:function(){return this._pd3},d3:function(){return this._d3},parentId:function(){return this.pd3().attr("id")},_propertyOverrides:function(){var t=this._super(),e=this;return t["default"]=this.bind("attr"),t.style=this.bind("css"),t.dispatches=this.bind("dispatches"),this._sb.ext.mixin(t,["stroke","stroke-width","stroke-linecap","stroke-opacity","stroke-linejoin","stroke-dasharray","fill","fill-opacity","text-anchor"].reduce(function(t,n){return t[n]=e.bind("style"),t},{})),this._sb.ext.mixin(t,["left","top","width","height"].reduce(function(t,n){return t[n]=e.bind("prop"),t},{})),t},childrenLayout:function(){return null},createChildren:function(t){try{var n;t=this._sb.ext.isArr(t)?t:t?[t]:[];for(var r=0;t.length>r;++r)n=t[r],n.id=this._sb.layout.uniqueId(n),this._children[n.id]=this._sb.ext.isString(n.widget)?new e(this._sb,this.dom(),n):new n.widget(this._sb,this.dom(),n),n.children&&this._children[n.id].createChildren(n.children)}catch(s){throw["SB_Light::SVG::create ",s.message,n.id].join(" -- ")}},child:function(t){return this._children[t]||this._children[this.cid(t)]||null},appendChild:function(){},createDom:function(t){if(!t.widget)throw"The 'widget' option must be specified, and be the name of a valid HTML element.";return"svg"!=this._rootElement||this.parentDom().ownerSVGElement||(this._svgDiv=this.pd3().append("div").attr("class","sb_light_widget")),(this._svgDiv||this.pd3()).append(this._rootElement)},attr:function(){return this.d3().attr.apply(this._d3,arguments)},style:function(){return this.d3().style.apply(this._d3,arguments)},css:function(){return this._svgDiv?this.cssText.apply(this,arguments):this.style.apply(this,arguments)},text:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);return this.d3().text.apply(this.d3(),t)},className:function(){var t=this._sb.ext.slice(arguments,"class"==arguments[0]||"className"==arguments[0]?1:0),e=this._svgDiv||this._d3;if(t.length){var n=t[0].split(/\s/);return n.forEach(function(n){e.classed(n,t[1]!==!0)}),this}return e.attr("class")},dispatches:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);if(t.length){var e=t[0];for(var n in e)this._dispatcher.on(n,e[n]);return this}return this._dispatches},dispatch:function(t,e,n,r){this._dispatcher&&this._dispatcher[t]&&this._dispatcher[t].apply(e,[n,r])},dispatcher:function(){return this._dispatcher},applyLayout:function(){(this._svgDiv||this._d3).node();var t=this.bind("dim");this._sb.ext.px;var e=this.bind("sizeFuncs");["left","top","width","height"].forEach(function(n){var r=e(n);r&&t(n,r())}),this.redraw()},handleResize:function(){this.redraw()},redraw:function(){},dim:function(t,e){if(t.match(/left|top|width|height/)&&this.prop.apply(this,this._sb.ext.slice(arguments)),this._svgDiv){if(arguments.length>1)return this._svgDiv.style(t,this._sb.ext.px(e)),t.match(/width|height/)&&this.d3().attr(t,e),this}else if(arguments.length>1)return this.d3().attr(t,e),this;return this.prop(t)},rect:function(){return this._super()}});return e}),define("sb_light/layout",["sb_light/globals","widgets/widget","widgets/svg"],function(t,e,n){var r={};r.init=function(){},r.create=function(r,s){try{var i;if(t.ext.isStr(s.widget))i="svg"==s.widget?new n(t,r,s):new e(t,r,s);else{var o=s.widget;i=new o(t,r,s)}return i}catch(a){throw console.log(["SB_Light::Layout::create ",JSON.stringify(a),s.id].join(" -- ")),Error(["SB_Light::Layout::create ",JSON.stringify(a),s.id].join(" -- "))}},r.parse=function(t,e,n){var i=t.ownerDocument?t.getBoundingClientRect():t.rect(),o={root:t,widgets:{},rootWidth:i.width,rootHeight:i.height};return s(null,e,o),n||r.resize(o),o},r.resize=function(t){l(t),d(t),_(t)},r.change=function(t,e,n,s,i){t.widgets[e].source(n,s),i||r.resize(t)},r.uniqueId=function(e){return e.id||(e.id="unknown_"+t.ext.unique()),e.id};var s=function(e,n,i){var o=e?i.widgets[e]:i.root;if(!o)throw Error("Warning: missing parent id",e);n=t.ext.isArray(n)?n:[n],n.forEach(function(t,e){t.id=r.uniqueId(t),t.style=t.style||"",t.style=t.style+(t.style.match("/z-index/")?"":";z-index:"+e);var n=r.create(o,t);i.widgets[t.id]=n,t.children&&t.children.length&&("svg"==t.widget?n.createChildren(t.children):s(t.id,t.children,i))})},i=/^@(.+?)(#(left|right|top|bottom|height|width))?(#(-?\d+))?$/,o=/^(-?\d+)([^0-9]+)?$/,a=["left","right","top","bottom","height","width"],u=["top","bottom","height"],l=function(e){for(var n in e.widgets){var r=e.widgets[n];e.widgets[r.parentId()]||null;var s=r.sizeDefs.bind(r),i=t.ext.valid;a.forEach(function(t){s(t,r.source(t))}),i(s("left"))&&i(s("width"))&&i(s("right"))&&s("right",null),i(s("top"))&&i(s("bottom"))&&i(s("height"))&&s("bottom",null);var o=i(r.source("fringe"))?r.source("fringe"):0;i(s("left"))||i(s("width"))&&i(s("right"))||s("left",o),i(s("right"))||i(s("width"))&&i(s("left"))||s("right",o),i(s("top"))||i(s("height"))&&i(s("bottom"))||s("top",o),i(s("bottom"))||i(s("height"))&&i(s("top"))||s("bottom",o)}},c=function(t){return u.indexOf(t)>-1},d=function(e){for(var n in e.widgets){var r=e.widgets[n],s=r.sizeFuncs.bind(r),u=e.widgets[r.parentId()]||null,l=r.parentId()||"_root",d=u&&u.sizeFuncs.bind(u)||null,_=d?[d,"width",l+"@width"]:e.rootWidth,p=d?[d,"height",l+"@height"]:e.rootHeight,m=t.ext.valid;a.forEach(function(a){var u=r.sizeDefs(a)+"",l=u?u.match(i):null,d=u.match(o);if(d)3==d.length&&"%"==d[2]?(d=t.ext.to_f(d[1])/100,s(a,h(n,a,t.ext.prod,c(a)?p:_,d))):2!=d.length&&m(d[2])||(d=t.ext.to_f(d[1]),s(a,h(n,a,t.ext.sum,d)));else if("auto"==u)s(a,f(n,a,r,e));else{if(!l)return"width"==a?s(a,h(n,a,t.ext.diff,_,[s,"left",n+"@left"],[s,"right",n+"@right"])):"height"==a?s(a,h(n,a,t.ext.diff,p,[s,"top",n+"@top"],[s,"bottom",n+"@bottom"])):"left"==a?s(a,h(n,a,t.ext.diff,_,[s,"width",n+"@width"],[s,"right",n+"@right"])):"top"==a?s(a,h(n,a,t.ext.diff,p,[s,"height",n+"@height"],[s,"bottom",n+"@bottom"])):"right"==a?s(a,h(n,a,t.ext.diff,_,[s,"width",n+"@width"],[s,"left",n+"@left"])):"bottom"==a&&s(a,h(n,a,t.ext.diff,p,[s,"height",n+"@height"],[s,"top",n+"@top"])),void 0;var g=l[1]&&e.widgets[l[1]]?l[1]:null,b=m(l[3])?l[3]:a,y=m(l[5])?t.ext.to_f(l[5],0):0,v=e.widgets[g],E=v.sizeFuncs.bind(v);"right"==b&&"left"==a?s(a,h(n,a,t.ext.sum,[E,"left",g+"@left"],[E,"width",g+"@width"],y)):"left"==b&&"right"==a?s(a,h(n,a,t.ext.sum,[E,"right",g+"@right"],[E,"width",g+"@width"],y)):"bottom"==b&&"top"==a?s(a,h(n,a,t.ext.sum,[E,"top",g+"@top"],[E,"height",g+"@height"],y)):"top"==b&&"bottom"==a?s(a,h(n,a,t.ext.sum,[E,"bottom",g+"@bottom"],[E,"height",g+"@height"],y)):s(a,h(n,a,t.ext.sum,[E,b,g+"@"+b],y))}})}},h=function(e,n,r){var s=e+":"+n,i=t.ext.slice(arguments,3);return function(e){if(e=e||"Chain: ",e.match(s))throw Error("sb_light::utils::layout Error -- Circular dependancy ("+e+") "+s);var n=i.map(function(n){return t.ext.isArr(n)?[n[0](n[1]),e+"_"+s+(n[2]?"("+n[2]+")":"")]:n}),o=r.apply(r,n);return o}},f=function(e,n,r,s){var i=e+":"+n;return function(o){if(o=o||"Chain: ",o.match(i))throw Error("sb_light::utils::layout Error -- Circular dependancy ("+o+") "+i);var a=[];for(var u in s.widgets){var l=s.widgets[u],c=l.sizeFuncs.bind(l);l.parentId()==e&&a.push(function(){return"width"==n?c("left")(o+"_"+i+"_"+u+"@"+n)+c("width")(o+"_"+i+"_"+u+"@"+n):"height"==n?c("top")(o+"_"+i+"_"+u+"@"+n)+c("height")(o+"_"+i+"_"+u+"@"+n):"left"==n?c("left")(o+"_"+i+"_"+u+"@"+n):"top"==n?c("top")(o+"_"+i+"_"+u+"@"+n):void 0})}if(a.length)return"width"==n||"height"==n?t.ext.max.apply(null,a):t.ext.min.apply(null,a);var d=r.parentId(),h=s.widgets[d]||null,f=r.dom().getBoundingClientRect(),_=h?h.dom().getBoundingClientRect():s.root.getBoundingClientRect(),p=h?h.sizeFuncs("height")(o+"_"+i):s.rootHeight,m=h?h.sizeFuncs("width")(o+"_"+i):s.rootWidth;return"bottom"!==n&&"right"!=n?f[n]:"bottom"==n?p-f.height-(f.top-_.top):m-f.width-(f.left-_.left)}},_=function(e){for(var n in e.widgets){var r=e.widgets[n];r.sizeFuncs.bind(r),t.ext.roundTo,r.applyLayout()}};return r}),define("sb_light/utils/consts",["sb_light/globals"],function(){var t={};return t.COLOR={BLOCK:{green:"#176717",yellow:"#77771B",red:"#641717"}},t.STATE={BLOCK:"block",BLOCK_TREE_ZOOM:"blockTreeZoom",BLOCK_MAP_ZOOM:"blockMapZoom",CHILD_BLOCK:"childBlock",BLOCK_SETTINGS_VIEW:"blockSettingsView",BLOCK_SETTINGS_COLLAPSE:"blockSettingsCollapse",BLOCKS_TREE_VIEW:"blocksTreeView",BLOCKS_MAP_VIEW:"blocksMapView",BLOCKS_TIMELINE_VIEW:"blocksTimelineView",MANAGE_BLOCK_VIEW:"manageBlockView",PAGE:"page",USER_ID:"userId",COMPANY_ID:"companyId",COMPANY:"company",USER:"user",SESSION:"session",PREV_PAGE:"previousPage",PREV_BLOCK:"previousBlock"},t.BLOCK_SETTINGS={VIEW:{DEFAULT:{name:"Default",key:"bd"},STATUS:{name:"Status",key:"bs"},PROGRESS:{name:"Progress",key:"bp"},HEALTH:{name:"Health",key:"bh"},KPI:{name:"Outputs",key:"bk"},RISK:{name:"Risk",key:"br"},NPV:{name:"Value",key:"bn"}},COLLAPSE:"c"},t.BLOCKS_MAP={VIEW:{RADIAL:"radial",HIERARCHY:"hierarchy"}},t.BLOCKS_TREE={VIEW:{STATUS:t.BLOCK_SETTINGS.VIEW.STATUS.key,PROGRESS:t.BLOCK_SETTINGS.VIEW.PROGRESS.key,HEALTH:t.BLOCK_SETTINGS.VIEW.HEALTH.key,KPI:t.BLOCK_SETTINGS.VIEW.KPI.key,RISK:t.BLOCK_SETTINGS.VIEW.RISK.key,NPV:t.BLOCK_SETTINGS.VIEW.NPV.key}},t.BLOCKS_TIMELINE={VIEW:{CHART:"chart",TABLE:"table"}},t.MANAGE_BLOCK={VIEW:{BLOCK:"block",NEW_CHILD:"newChild",EDIT_CHILD:"editChild",CHILDREN_LIST:"childrenList",NEW_LINK:"newLink",EDIT_LINK:"editLink"}},t.SIZES={BLOCK_WIDTH:350,BLOCK_HEIGHT:185,BLOCK_HEIGHT_SMALL:150,BLOCK_PADDING_X:80,BLOCK_PADDING_Y:90},t}),define("sb_light/models/_abstractModel",["sb_light/utils/Class"],function(t){var e=t.extend({name:null,_sb:null,_model:null,_modelArray:null,_urlDef:null,_selectQueue:null,_subscriptions:null,init:function(t,e,n){if(!e)throw Error("AbstractModel: Model name must be declared");if(!n)throw Error("AbstractModel: Model urlDef must be declared");this._sb=t,this.name=e,this._urlDef=n,this._selectQueue=[],this._subscriptions=[],this._sb.state.register(this,this._urlDef,this._handleUpdate.bind(this))},reset:function(t){this._model=null,this._modelArray=null,this._sb.state.resetTimestamp(this.name),t&&this._publish()},isValid:function(){return null!=this.get()},get:function(){return this._model?this._modelArray:(this._sb.ext.debug("Getting the "+this.name+" model."),this._sb.state.authorized()&&(this._sb.ext.debug("Forcing the update"),this._sb.state.forceModelUpdate(this)),null)},raw:function(){return this._model},rawArray:function(){return this._modelArray},subscribe:function(t){this._subscriptions.put(t);var e=this.get();e&&t(e)},unsubscribe:function(t){var e=this._subscriptions.indexOf(t);e>=0&&this._subscriptions.splice(e,1)},_publish:function(){var t=this.get();this._subscriptions.forEach(function(e){e.bindDelay(null,50,t)})},select:function(t,e,n){this._selectQueue.push({type:t,cb:e,func:n}),this._processQueue()},_handleUpdate:function(t){this._processResponse(t),this._model&&(this._publish(),this._processQueue())},_processQueue:function(){var t=this.get();if(t)for(;this._selectQueue.length;){var e=this._selectQueue.pop();switch(e.type){case"map":e.cb(this._model);break;case"all":e.cb(t);break;case"filter":e.cb(t.filter(e.func))}}},_processResponse:function(t){this._model=this._model||{},this._sb.ext.debug("Processin Model",this.name),this._addItems(t.added),this._updateItems(t.updated),this._deleteItems(t.deleted),this._massageUpdatedModel(),this._resetArrayCache()},_addItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_updateItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_deleteItems:function(t){var e=this._model;t=t||[];var n=this;t.forEach(function(t){e[t]&&n._sb.ext.debug("Deleting Model",n.name,t),delete e[t]})},_massageUpdatedModel:function(){},_resetArrayCache:function(){this._modelArray=this._sb.ext.map(this._model,function(t){return t})}});return e}),define("sb_light/models/tagsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"tags",t.urls.MODEL_TAGS)}});return e}),define("sb_light/models/newsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"news",t.urls.MODEL_NEWS)},_massageUpdatedModel:function(){this._super()}});return e}),define("sb_light/models/usersModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"users",t.urls.MODEL_USERS)},_massageUpdatedModel:function(){this._super();for(var t in this._model){var e=this._model[t];e.name=e.first_name+" "+e.last_name}}});return e}),define("sb_light/models/blocksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({_progress:null,_health:null,_npv:null,_npv_queue:null,_progress_queue:null,_health_queue:null,_properties:null,_propertiesList:["comments","news","tags","documents","context","watching_users"],init:function(t){this._npv_queue=[],this._progress_queue=[],this._health_queue=[],this._properties={},this._super(t,"blocks",t.urls.MODEL_BLOCKS)},_handleUpdate:function(t){this._progress=null,this._health=null,this._npv=null,this._super(t)},_massageUpdatedModel:function(){this._super();var t=this._model[this._sb.state.value("company").root_block.id];this._massage(t,null,0,(new Date).getTime()),this._sb.ext.debug("Finished massaging blocks")},rawPaths:function(){var t=this.rawArray()||[],e={};return t.forEach(function(t){t.paths.forEach(function(n){e[n]=t})}),e},rawArrayPaths:function(){return this._sb.ext.map(this.rawPaths(),function(t,e){return{path:e,block:t}})},progress:function(t){this._data(t,"_progress",this._sb.urls.BLOCKS_PROGRESS)},health:function(t){this._data(t,"_health",this._sb.urls.BLOCKS_HEALTH)},npv:function(t){this._data(t,"_npv",this._sb.urls.BLOCKS_NPV)},comments:function(t,e,n){this._property(e,"comments",t,n)},news:function(t,e,n){this._property(e,"news",t,n)},tags:function(t,e,n){this._property(e,"tags",t,n)},documents:function(t,e,n){this._property(e,"documents",t,n)},context:function(t,e,n){this._property(e,"context",t,n)},watching:function(t,e,n){this._property(e,"watching_users",t,n)},_property:function(t,e,n,r){if(!(this._propertiesList.indexOf(e)>=0))throw Error("BlockModel property is not valid:"+e);this._properties[e]=this._properties[e]||{},!this._properties[e][n]||r?(this._properties[e][n]="waiting",this._properties[e+"_queue"]=this._properties[e+"_queue"]||{},this._properties[e+"_queue"][n]=this._properties[e+"_queue"][n]||[],this._properties[e+"_queue"][n].push(t),this._sb.controller.invoke(this._sb.urls.BLOCKS_PROPERTIES,{id:n,type:e},this._handleProperty.bind(this,e,n))):"waiting"==this._properties[e][n]?this._properties[e+"_queue"][n].push(t):t(this._properties[e][n])},_data:function(t,e,n){var r=this._handleData.bind(this,e);this[e+"_queue"].push(t),this[e]?r():1==this[e+"_queue"].length&&sb.controller.invoke(n,null,r)},_handleData:function(t,e){for(this[t]=e?e.result:this[t];this[t+"_queue"].length;){var n=this[t+"_queue"].pop();n(this[t])}},_handleProperty:function(t,e,n){for(this._properties[t]=this._properties[t]||{},this._properties[t][e]=n?n.result:this._properties[t][e];this._properties[t+"_queue"][e].length;){var r=this._properties[t+"_queue"][e].pop();r(this._properties[t][e])}},_massage:function(t,e,n,r){var s=t._schema!=r;t._schema=s?r:t._schema,t.paths=!s&&t.paths||[],t.children=t.children||[];var i=e?this._model[e.last()]:null;if(i){var o=t.parents.find("parent_id",i.id).value,a=t.parents.find("linked_parent_id",null).value;o.position=i.children.indexOf(t.id),o.level=n,t.paths.put(e.concat([t.id])),i.id==a.parent_id&&(t.default_path=t.paths.last(),t.default_parent=i.id,t.default_level=n,t.default_position=o.position),i.is_owner&&(o.can_move_left=o.position>0,o.can_move_right=i.children.length-1>o.position&&i.children.length>1,o.can_delete=!0)}else t.default_path=[t.id],t.default_parent=null,t.paths.put([t.id]),t.default_position=0,t.default_level=0;for(var u=t.paths.last(),l=0;t.children.length>l;++l)this._massage(this._model[t.children[l]],u,n+1,r)},_resetArrayCache:function(){this._super(),this._modelArray.sort(this._sb.ext.sortBlocksByProgress)}});return e}),define("sb_light/models/levelsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"levels",t.urls.MODEL_LEVELS)}});return e}),define("sb_light/models/focusModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"focus",t.urls.MODEL_FOCUS)}});return e}),define("sb_light/models/risksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"risks",t.urls.MODEL_RISKS)}});return e}),define("sb_light/models/kpisModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"kpis",t.urls.MODEL_KPIS)}});return e}),define("sb_light/models/companiesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"companies",t.urls.MODEL_COMPANIES)}});return e}),define("sb_light/models/timezonesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"timezones",t.urls.MODEL_TIMEZONES)},_processResponse:function(t){this._sb.ext.debug("Handle Timezone response"),this._super(t),this._sb.ext.debug("Done Handle Timezone response",this._model)},get:function(){this._sb.ext.debug("Getting Timezones.");var t=this._super();return this._sb.ext.debug("Done Getting Timezones.",t),t}});return e}),define("sb_light/models",["sb_light/globals","sb_light/models/tagsModel","sb_light/models/newsModel","sb_light/models/usersModel","sb_light/models/blocksModel","sb_light/models/levelsModel","sb_light/models/focusModel","sb_light/models/risksModel","sb_light/models/kpisModel","sb_light/models/groupsModel","sb_light/models/companiesModel","sb_light/models/timezonesModel"],function(t,e,n,r,s,i,o,a,u,l,c,d){function h(e){var n=f[e];if(!n)throw Error("sb.appModel.js: Model name not found: "+e);return n.model||(n.model=new n.klass(t)),n}var f={tags:{klass:e},news:{klass:n},users:{klass:r},blocks:{klass:s},levels:{klass:i},focus:{klass:o},risks:{klass:a},kpis:{klass:u},groups:{klass:l},companies:{klass:c},timezones:{klass:d}},_={};return _.reset=function(t){for(var e in f){var n=f[e]?f[e].model:null;n&&n.reset(t)}},_.get=function(t){var e=h(t);return e.model},_.subscribe=function(t,e){var n=h(t);n.model.subscribe(e)},_.unsubscribe=function(t,e){var n=h(t);n.model.unsubscribe(e)},_.rawArray=function(t){var e=h(t);return e.model?e.model.rawArray():void 0},_.raw=function(t){var e=h(t);return e.model?e.model.raw():void 0},_.select=function(e,n,r,s){var i=h(e);i.model&&(t.ext.debug("Doing a select on the model.",e),i.model.select(n,r,s))},_.isValid=function(t){var e=h(t),n=!1;return e.model&&(n=e.model.isValid()),n},_}),define("sb_light/controller",["sb_light/globals"],function(t){var e={};return e.invoke=function(e,n,r,s,i){var o=t.urls.url(e,n),a={};e.deleteId&&delete n.id;var u=e.massageParamsFunc?t.urls[e.massageParamsFunc](n):n;null!=u&&(u instanceof Array?a.json=JSON.stringify(u):Object.keys(u).length>0&&(e.normalParams?a=u:a.json=JSON.stringify(u)));var l=e.post===void 0||e.post||!1;t.api.request(o,a,l,r,s,i||null)},e.forgotPassword=function(n,r,s){e.invoke(t.urls.LOGIN_FORGOT_PASSWORD,{username:n},r,s,t.state.invalid)},e.blockComment=function(n,r,s){e.invoke(t.urls.COMMENT_PROPERTIES_ADD,{id:n,body:r},s,s)},e.blockClose=function(n,r,s){e.invoke(t.urls.BLOCKS_CLOSE,t.ext.mixin({id:n},r),s,s)},e.blockPublish=function(n,r,s){e.invoke(t.urls.BLOCKS_MAKE_PUBLIC,{id:n,children:r},s,s)},e.changeDefaultCompany=function(n,r,s){e.invoke(t.urls.USERS_CHANGE_DEFAULT_COMPANY,{id:t.state.value("userId"),default_company_id:n},r,s)},e}),define("sb_light/api/state",["sb_light/globals","sb_light/utils/consts"],function(t,e){function n(e){if(e){var n=e.user?e.user.id:null,r=e.company?e.company.id:null;(n!=o.userId||r!=o.companyId)&&(o.userId=e.user?e.user.id:null,o.companyId=e.company?e.company.id:null),null==o.block&&null!=e.block&&(o.block=e.block+"")}else o.userId=o.companyId=null,o.user=o.company=null;null==i.value("userId")?(t.ext.debug("setting session to unauthorized"),(i.unknown()||i.startup())&&(e.flash={notice:"Please enter your login credentials."}),o.session=i.session_invalid):(o.company=e.company,o.user=e.user,e.company&&e.company.license&&"expired"==e.company.license.status?(t.ext.debug("setting session to payment"),o.session=i.session_payment):(t.ext.debug("setting session to normal"),o.session=i.session_normal)),i.authorized()||t.models.reset(),i.value("flash",e.flash),i.value("errors",e.errors)}function r(t){for(var e in i.models)t&&t[e]&&(u[e]=a[e]=null,i.models[e].timestamp=t[e].timestamp,i.models[e].cb(t[e]))}function s(e,n){var r=n&&n.result,s=r[e.name]||r;null==e.raw()&&s&&(t.ext.isArray(s)&&(s=s.reduce(function(t,e){return t[e.id]=e,t},{})),e._handleUpdate({added:s})),u[e.name]=!1}var i={};i.stateKeys=["session_unknown","session_normal","session_payment","session_invalid","session_disconnected","session_startup"],i.stateKeys.reduce(function(t,e,n){return t[e]=n,t},i);var o={page:"",block:null,news:null,kpi:null,risk:null,tag:null,userId:null,companyId:null,company:null,user:null,session:i.session_startup,url:"",childBlock:null,blockTreeZoom:1,blockMapZoom:1,blockSettingsView:"",blockSettingsCollapse:"",blocksTreeView:e.BLOCKS_TREE.VIEW.STATUS,blocksMapView:e.BLOCKS_MAP.VIEW.RADIAL,blocksTimelineView:e.BLOCKS_TIMELINE.VIEW.CHART,previousBlock:null,previousPage:null},a={},u={},l={},c=["page","block","childBlock","blocksTreeView","blocksMapView","blocksTimelineView","manageBlockView"];return i.host="",i.models={},i.subscriptions={},i.url=function(e){return void 0!==e&&(e="string"==typeof e?t.urls.url_to_o(e):e,t.ext.each(e,function(t,e){i.value(t,e,!1)}),i.publish("url")),"#"+c.reduce(function(t,e){return val=i.value(e),null!==val&&void 0!==val?t.put([e,i.value(e)].join("=")):t},[]).join(";")},i.register=function(t,e,n){i.models[t.name]||(i.models[t.name]={timestamp:0,cb:n,urlDef:e},!i.authorized()||a||a[t.name]||(a[t.name]=_forceModelUpdate.bindDelay(i,200,t)))},i.resetTimestamp=function(t){i.models[t]&&(i.models[t].timestamp=0)},i.login=function(e,n,r,s){var o=null;e&&n&&(o={username:e,password:n}),t.api.post(t.urls.url(t.urls.LOGIN),o,r,s,i.unauthorized)},i.logout=function(){t.api.post(t.urls.url(t.urls.LOGOUT)),i.session=i.session_unknown},i.changeCompany=function(e){i.session=i.session_unknown,t.models.reset(!1),t.api.post(t.urls.url(t.urls.LOGIN),{company_id:e})},i.forceModelUpdate=function(e){if(a[e.name]&&(clearTimeout(a[e.name]),a[e.name]=null),!u[e.name]&&i.authorized()){u[e.name]=!0;var n=i.models[e.name];n.timestamp=0;var r=t.urls.url(n.urlDef),o=s.bind(i,e);t.api.get(r,null,o)}},i.any=function(){return!0},i.startup=function(){return o.session==i.session_startup},i.known=function(){return o.session!=i.session_unknown},i.unknown=function(){return o.session==i.session_unknown},i.unauthorized=function(){return o.session==i.session_unknown||o.session==i.session_invalid||o.session==i.session_startup},i.invalid=function(){return o.session==i.session_invalid},i.authorized=function(){return o.session==i.session_normal||o.session==i.session_payment},i.disconnected=function(){return o.session==i.session_disconnected},i.update=function(t){return n(t),r(t),i.publish.bindDelay(i,50,"session"),i.authorized()},i.value=function(t,e,n){if(void 0!==e&&o[t]!=e){var r=o[t],s=l[t],a=s?s(r||null,e):e;if("url"==t)throw"Please use State.url to change the url object directly.";o[t]=a,i.publish(t),c.indexOf(t)>-1&&(o.url=i.url(),n!==!1&&i.publish("url"))}return o[t]},i.clone=function(){return t.ext.mixin({},o)},i.getValueKey=function(e,n){var r=t.urls.s_to_o(i.value(e));return r[n]||null},i.setValueKey=function(e,n,r){var s=t.urls.s_to_o(i.value(e));null==r?delete s[n]:s[n]=r,i.value(e,t.urls.o_to_s(s))},i.subscribe=function(e,n){if(!t.ext.isFunc(n))throw"SB_LIGHT:State -- subscribing to an event with an invalid function.";t.ext.debug("subscribing to: ",e),i.subscriptions[e]=i.subscriptions[e]||[],i.subscriptions[e].push(n)},i.unsubscribe=function(t,e){var n=i.subscriptions[t].indexOf(e);
n>-1&&i.subscriptions[t].splice(n,1)},i.publish=function(e){var n=i.subscriptions[e]||[],r=i.value(e),s=t.ext;n.forEach(function(t){e.indexOf("Zoom")>-1?(s.debug("Publish Zoom: ",e,r),t.bindDelay(null,0,r)):(s.debug("Publish: ",e,r),t.bindDelay(null,50,r))})},i.addTimestamps=function(e){t.ext.debug("Adding timestamp for ",Object.keys(i.models).join(","));for(var n in i.models)e[n+"_timestamp"]=i.models[n].timestamp},i}),define("sb_light/api/queries",["sb_light/globals"],function(t){var e={};e.company=function(e){var n=t.models.raw("companies");return e=e||t.state.value("companyId"),n&&e&&n[e]||null},e.fullname=function(e){var n=t.models.raw("users");return n&&e&&n[e]?n[e].name:null},e.currentUser=function(){var e=t.models.raw("users");return e&&e[t.state.value("userId")]||null},e.user=function(e){var n=t.models.raw("users");return n[e]},e.companyMembership=function(){var t=e.currentUser();if(t.company_membership)return t.company_membership;var n=e.company();return t&&n&&t.companies[n.id]||null},e.userDate=function(n,r){var s=e.currentUser();return t.moment(n,r).format(s.date_format)};var n="YYYY/MM/DD";e.userToServerDate=function(r){var s=e.currentUser(),i=t.moment(r,s.date_format);return i.format(n)},e.authors=function(){var e=t.state.value("companyId");return t.models.rawArray("users").filter(function(t){var n=t.company_membership||t.companies&&t.companies[e]||null;return n&&n.active&&("Author"==n.role||"Administrator"==n.role)}).sort(t.ext.sortUsers)},e.focusArea=function(e){var n=t.models.raw("focus");return n&&n[e]?n[e].title:null},e.focusAreaDesc=function(e){var n=t.models.raw("focus");return n&&n[e]?n[e].description:null},e.levelColor=function(e){var n=t.models.raw("levels"),r=n&&n[e]?n[e].color:null;return r?t.ext.to_color(r):null},e.levelName=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.levelPos=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.currentNewsItem=function(){var e=t.state.value("news"),n=t.models.raw("news");return n&&e?n[e]:null};var r=/%(users|blocks)_(\d+)%/g;e.newsMessage=function(e){var n=r,s=t.models.raw("blocks"),i=t.models.raw("users");return e.msg.replace(n,function(t,e,n){return"blocks"==e?s[n]?s[n].title:"(unknown block)":"users"==e?i[n]?i[n].name:"(unknown user)":void 0})};var s=/%users_(\d+)%/g;e.newsUsers=function(t){var e=s,n=[],r=null;do r&&n.push(r[1]),r=e.exec(t.msg);while(r);return n};var i=/%blocks_(\d+)%/g;e.newsBlocks=function(t){var e=i,n=[],r=null;do r&&n.push(r[1]),r=e.exec(t.msg);while(r);return n},e.currentBlock=function(){return e.block(e.currentBlockId())},e.previousBlock=function(){return e.block(e.previousBlockId())},e.rootBlock=function(){var n=t.state.value("company");return n?e.block(n.root_block.id):null},e.currentBlockId=function(){var t=e.currentBlockPath();return t&&t.length?t.last():null},e.previousBlockId=function(){var t=e.previousBlockPath();return t&&t.length?t.last():null},e.currentBlockPath=function(n){return e.blockPath(t.state.value("block"),n)},e.currentBlockLevel=function(){return e.blockLevel(e.currentBlockPath())},e.previousBlockPath=function(n){var r=t.state.value("previousBlock")||t.state.value("company").root_block.id;return e.blockPath(r,n)},e.previousBlockLevel=function(){return e.blockLevel(e.previousBlockPath())},e.managedBlocks=function(){return t.models.rawArray("blocks").reduce(function(t,e){return e.is_manager?t.put(e):t},[])},e.parentPath=function(t,n){return t=e.blockPath(t),e.blockPath(t.slice(0,-1),n)},e.blockParentInfo=function(t){t=e.blockPath(t);var n=e.block(t);return n&&n.parents&&n.parents.length?n.parents.find("parent_id",t.last(1)).value:null},e.blockPath=function(t,n){t=o(t);var r=e.block(t);return r&&2>t.length&&r.parents.length>0&&(t=r.default_path),n?t.join("_"):t};var o=function(t){return"array"==typeof t?t:"number"==typeof t?[t+""]:"string"==typeof t?t.split("_"):t};e.blockId=function(t){return t=o(t),t&&t.length?t.last():null},e.block=function(n){var r=e.blockId(n),s=t.models.raw("blocks");return r&&s&&s[r]?s[r]:null},e.blockLevel=function(t){var n=e.blockParentInfo(t||e.currentBlockPath());return n?n.level:0},e.childrenPaths=function(t,n){t=e.blockPath(t);var r=e.block(t);return r?r.children.map(function(r){return e.blockPath(t.concat([r]),n)}):null},e.parentPaths=function(n,r){var s=e.block(n);return s.paths.reduce(function(e,n){var s=t.queries.parentPath(n,r);return s&&s.length?e.put(s):e},[])},e.siblingPaths=function(n,r){var s=e.block(n);return s.paths.reduce(function(e,s){var i=t.queries.childrenPaths(t.queries.parentPath(s),r);return i?(i=i.filter(function(e){return t.queries.blockPath(e,!0)!=t.queries.blockPath(n,!0)}),e.concat(i)):e},[])},e.arePathsEqual=function(t,n){return e.blockPath(t,!0)==e.blockPath(n,!0)},e.isCenterPath=function(t){return e.currentBlockPath(!0).indexOf(e.blockPath(t,!0))>-1},e.isCurrentPath=function(t){return e.arePathsEqual(t,e.currentBlockPath())},e.maxDate=function(){return t.ext.parseDate(e.rootBlock().end_date)},e.minDate=function(){return t.ext.parseDate(e.rootBlock().start_date)},e.dateRange=function(n){var r={minStart:t.moment(new Date(1980,1,1)),maxStart:t.moment(new Date(2038,12,31)),minEnd:t.moment(new Date(1980,1,1)),maxEnd:t.moment(new Date(2038,12,31))},s=e.block(n.default_parent),i=n.children.map(function(t){return e.block(t).start_date}).put(s?s.end_date:r.maxStart),o=n.children.map(function(t){return e.block(t).end_date}).put(s?s.start_date:r.minEnd);return r.maxStart=t.ext.minDate.apply(null,i),r.minStart=s?s.start_date:r.minStart,r.maxEnd=s&&!s.floating_end_date?s.end_date:r.maxEnd,r.minEnd=t.ext.maxDate.apply(null,o),r},e.is_link=function(t,e){return null!=a(t,e).linked_parent_id},e.custom_progress_weight=function(e,n){return t.ext.to_i(a(e,n).custom_progress_weight)};var a=function(e,n){var r=t.models.raw("blocks"),s=r[e],i=r[n];if(-1==s.children.indexOf(n))throw Error("Block("+n+") is not a parent of block("+e+")");return i.parents.reduce(function(t,n){return n.parent_id==e?t.put(n):t},[])[0]};return e.progressVariance=function(t){var n=e.block(t);if(n){var r=n.percent_progress||100,s=n.expected_progress||0;return s>0?Math.round(100*((r-s)/s)):100}return 0},e.blockFullTree=function(n,r,s){if(s=s||t.models.raw("blocks")){n=e.blockPath(n||e.rootBlock().default_path),r=r||[];var i=s[n.last()],o={name:i.title,data:i,path:n,children:[]},a=i.children.cloneExcept(r.last());a.map(function(t){return n.concat([t])});var u=n.last(1);u&&r.last()!=u&&a.unshift(n.slice(0,-1));var l=1;return a.forEach(function(t){var r=e.blockFullTree(t,n,s);l+=r.size,o.children.put(r)}),o.size=l,o}},e.buildStrategyTree=function(n){var r=e.currentBlockPath(),s=e.currentBlock(),i=t.models.raw("blocks");if(!r||!s||!i)return null;var o=r.reduce(function(t,e){var n=t.last()||[];return t.put(n.concat([e])),t},[]),a=-(o.length-1);if(s.children.length){var u=s.children.indexOf(n),l=s.children[0>u?0:u];o.push(o.last().concat([l]))}var c={},d=c;return o.forEach(function(e){var n=t.ext.slice(e,0,-1),r=n.last(),s=e.last(),o=r?i[r].children:[s],u=o.indexOf(s);d.children=o.map(function(e,r){var s=n.concat([e]).join("_"),o=t.state.value(t.consts.STATE.BLOCKS_TREE_VIEW),l=t.state.getValueKey(t.consts.STATE.BLOCK_SETTINGS_VIEW,s);return l&&l!=t.consts.BLOCK_SETTINGS.VIEW.DEFAULT.key||(l=o),{path:s,dy:a,dx:r-u,data:i[e],viewType:l}}),a+=1,d=d.children[u]}),c.children[0]},e}),define("sb_light/api/urls",["sb_light/globals"],function(t){var e={},n={MODEL_BLOCKS:{url:"/blocks.js",post:!1},MODEL_COMPANIES:{url:"/companies.js",post:!1},MODEL_CAPABILITIES:{url:"/company_settings.js",post:!1},MODEL_EXPORTS:{url:"/exports.js",post:!1},MODEL_FOCUS:{url:"/focus.js",post:!1},MODEL_GROUPS:{url:"/groups.js",post:!1},MODEL_KPIS:{url:"/kpis.js",post:!1},MODEL_RISKS:{url:"/risks.js",post:!1},MODEL_LEVELS:{url:"/levels.js",post:!1},MODEL_NEWS:{url:"/news.js",post:!1},MODEL_LICENSES:{url:"/licenses.js",post:!1},MODEL_PROGRESS:{url:"/blocks/progress.js",post:!1},MODEL_HEALTH:{url:"/health_calculations.js",post:!1},MODEL_NPV:{url:"/blocks/npv.js",post:!1},MODEL_RISK:{url:"/blocks/risk.js",post:!1},MODEL_USERS:{url:"/users.js",post:!1},MODEL_TAGS:{url:"/tags.js",post:!1},MODEL_TIMEZONES:{url:"/companies/timezones.js",post:!1},MODEL_DASHBOARD:{url:"/reports/dashboard_layout.js",post:!1},BLOCKS_CONTEXT:{url:"/blocks/context/%id%.js"},BLOCKS_CLOSE:{url:"/blocks/close/%id%.js",deleteId:!0},BLOCKS_MANAGE_CHILDREN:{url:"/blocks/manage_children/%id%.js",deleteId:!0},BLOCKS_DELETE:{url:"/blocks/%type%/%id%.js",normalParams:!0},BLOCKS_DOCUMENTS:{url:"/blocks/documents/%id%.js"},BLOCKS_IMPORT:{url:"/blocks/import/%id%.js"},BLOCKS_INVITE:{url:"/blocks/invite/%id%.js"},BLOCKS_MAKE_PUBLIC:{url:"/blocks/make_public/%id%.js",normalParams:!0},BLOCKS_MOVE:{url:"/blocks/move/%id%.js",normalParams:!0},BLOCKS_PROPERTIES:{url:"/blocks/%type%/%id%.js"},BLOCKS_RELOCATE:{url:"/blocks/reassign_parent/%id%.js",normalParams:!0},BLOCKS_UPDATE:{url:"/blocks/update/%id%.js",massageParamsFunc:"massageParamsForBlockUpdate"},BLOCKS_UNWATCH:{url:"/blocks/unwatch/%id%.js"},BLOCKS_WATCHING_USERS:{url:"/blocks/watching_users/%id%.js"},BLOCKS_TAGGED:{url:"/blocks_for_tag/%name%.js"},BLOCKS_UPDATE_GROUPS:{url:"/blocks/update_group_expression/%id%.js",normalParams:!0},BLOCKS_CHANGE_CHARTED_KPI:{url:"/blocks/set_default_kpi/%id%.js"},BLOCKS_UPDATE_CASHFLOWS:{url:"/blocks/update_net_cashflows/%id%.js"},BLOCKS_HEALTH:{url:"/blocks/health.js",normalParams:!0},BLOCKS_PROGRESS:{url:"/blocks/progress.js",normalParams:!0},BLOCK_FILES_UPLOAD_URL:{url:"/blocks/%id%/documents/create.js"},BLOCK_FILES_DOWNLOAD_URL:{url:"/blocks/%id%/documents/show/%doc_id%.js"},BLOCK_FILES_DELETE:{url:"/blocks/%id%/documents/destroy/%doc_id%.js"},BOOKMARKS:{url:"/saved_client_states/index.js"},BOOKMARK_CREATE_DYNAMIC:{url:"/saved_client_states/create_dynamic.js"},BOOKMARK_SAVE_DYNAMIC:{url:"/saved_client_states/%id%/save_dynamic.js",normalParams:!0},BOOKMARK_CREATE:{url:"/saved_client_states/create.js",normalParams:!0},BOOKMARK_UPDATE:{url:"/saved_client_states/%id%/update.js",normalParams:!0},BOOKMARK_DELETE:{url:"/saved_client_states/%id%/delete.js"},COMMENT_PROPERTIES_ADD:{url:"/blocks/%id%/comment.js",normalParams:!0,deleteId:!0},COMPANIES_CREATE:{url:"/companies/create.js"},COMPANIES_UPDATE:{url:"/companies/update.js"},COMPANIES_HEALTH:{url:"/health_calculations.js"},COMPANIES_HEALTH_CREATE:{url:"/health_calculations/create.js"},COMPANIES_HEALTH_UPDATE:{url:"/health_calculations/%id%/update.js"},COMPANIES_HEALTH_DELETE:{url:"/health_calculations/%id%/destroy.js"},COMPANIES_HEALTH_DEFAULT:{url:"/health_calculations/%id%/set_default.js"},COMPANIES_LOGO_PREVIEW_URL:{url:"/upload/company_logo_preview.js"},COMPANIES_REMOVE_PREVIEW_LOGO:{url:"/upload/remove_company_logo_preview.js"},CAPABILITIES_UPDATE:{url:"/company_settings/update.js"},EXPORTS_CREATE:{url:"/exports/%id%/create.js"},EXPORTS_REPORT:{url:"/exports/%id%/create.js"},EXPORTS_DELETE:{url:"/exports/%id%/destroy.js"},FOCUS_CREATE:{url:"/focus/create.js"},FOCUS_UPDATE:{url:"/focus/update/%id%.js",deleteId:!0},FOCUS_DELETE:{url:"/focus/destroy/%id%.js",deleteId:!0},FOCUS_REPARENT:{url:"/focus/reparent/%id%.js"},GROUPS_CREATE:{url:"/groups/create.js"},GROUPS_DELETE:{url:"/groups/%id%/destroy.js",deleteId:!0},GROUPS_UPDATE:{url:"/groups/%id%/update.js",deleteId:!0},GROUPS_ADD:{url:"/groups/%id%/add.js"},GROUPS_REMOVE:{url:"/groups/%id%/remove.js"},RISKS_CREATE:{url:"/risks/create.js"},RISKS_DESTROY:{url:"/risks/%id%/destroy.js"},RISKS_UPDATE:{url:"/risks/%id%/update.js"},RISKS_UPDATE_STATUS:{url:"/risks/%id%/update_status.js"},RISKS_ADD_IMPACT:{url:"/risks/%id%/add_impact.js"},RISKS_REMOVE_IMPACT:{url:"/risks/%id%/remove_impact.js"},RISKS_ATTACH_DOC:{url:"/risks/%id%/attach_document.js"},RISKS_SHOW_DOC:{url:"/risks/%id%/show_document/%doc_id%.js"},RISKS_DESTROY_DOC:{url:"/risks/%id%/destroy_document.js"},RISKS_DUMMY_REFRESH:{url:"/risks/%id%/refresh_risk.js"},RISKS_SETTINGS:{url:"/risk_profiles/update_risk_settings.js"},RISKS_MATRIX_SIZE:{url:"/risk_profiles/set_matrix_size.js"},RISKS_PROFILES_UPDATE:{url:"/risk_profiles/update_batch.js"},KPIS_CREATE:{url:"/kpis/create.js"},KPIS_DESTROY:{url:"/kpis/%id%/destroy.js"},KPIS_UPDATE:{url:"/kpis/%id%/update.js"},KPIS_ATTACH_BLOCK:{url:"/kpis/%id%/attach.js"},KPIS_DETACH_BLOCK:{url:"/kpis/%id%/detach.js"},LEVELS_UPDATE:{url:"/levels/update.js"},MEASURES_BLOCKS:{url:"/blocks/measure_values/%id%.js"},USERS_CREATE:{url:"/users/create.js"},USERS_CREATE_BATCH:{url:"/users/create_batch.js"},USERS_ADD_GROUP:{url:"/users/%id%/add_group.js",normalParams:!0},USERS_REMOVE_GROUP:{url:"/users/%id%/remove_group.js",normalParams:!0},USERS_ACTIVATE:{url:"/users/%id%/activate.js"},USERS_DEACTIVATE:{url:"/users/%id%/deactivate.js"},USERS_UPDATE:{url:"/users/%id%/update.js",deleteId:!0},USERS_REMOVE_MEMBERSHIP:{url:"/users/%id%/delete_membership.js"},USERS_CHANGE_MEMBERSHIP:{url:"/users/%id%/update_membership.js",deleteId:!0},USERS_CHANGE_DEFAULT_COMPANY:{url:"/users/%id%/change_default_company.js",normalParams:!0},REGISTER_COMPANY:{url:"/registration/register_company.js"},LOGIN:{url:"/login/auth.js"},LOGOUT:{url:"/login/logout.js"},LOGIN_FORGOT_PASSWORD:{url:"/login/forgot_password.js",normalParams:!0},LOGIN_REMEMBER_ME:{url:"/login/remember_me.js"},URL_SAVE_BOOKMARK:{url:"/users/save_bookmark.js"},PAYMENTS:{url:"/purchases/index.js"},PAYMENTS_QUOTE:{url:"/purchases/quote.js"},PAYMENTS_CREATE:{url:"/purchases/create.js"},ADMIN_RAISE:{url:"/admin/log_client_error.js"}};n.url=function(e,n){if(!e||!e.url)throw Error("Url does not exist: "+e);n=n||{};var s=e.url;for(var i in n)s=s.replace(r(i),n[i]);if(s.indexOf("%")>-1)throw Error("Bad url."+s);return t.state.host+s};var r=function(t){return e[t]=e[t]||RegExp("%"+t+"%"),e[t]};return n.massageParamsForBlockUpdate=function(t){return delete t.id,t},n.s_to_o=function(e){return e?e.split("-").reduce(function(e,n){return n?t.ext.set.apply(Object,[e].concat(n.split("!"))):e},{}):{}},n.o_to_s=function(e){return t.ext.map(e,function(t,e){return[e,t].join("!")}).join("-")},n.url_to_o=function(e){var n="string"==typeof e?e.split(";"):e;return n=t.ext.isArray(n)?n:n.reduce(function(n,r){if(r="string"==typeof r?r.split("="):r,t.ext.isArray(r))n[r[0]]=r[1];else{if(!r.key)throw"URL Cannot be parsed: "+JSON.stringify(e);n[r.key]=r.value}return n},{})},n.o_to_params=function(e){return t.ext.map(e,function(t,e){return e+"="+encodeURIComponent(t)}).join("&")},n}),define("sb_light/api/api",["sb_light/globals"],function(t){function e(e,s,i){if(t.ext.debug("Sending request to ",e,i,JSON.stringify(s)),!o.ajax)throw"Error: sb.api.ajax has not been inititalized. Please set this value to one of the functions available in sb.ajax";s=s||{},t.state.addTimestamps(s),o.ajax({url:e,type:i?"POST":"GET",data:s,dataType:"json",context:o,success:n.bind(null,t.ext.slice(arguments)),error:r.bind(null,t.ext.slice(arguments))})}function n(e,n){t.ext.debug("SUCCESS: SB_Api",e,n),u=l;var r=t.state.authorized();if(t.state.update(n)){var s=t.ext.getResultMessages(n).errors;!s&&e[3]&&(e[3](n),i()),s&&e[4]&&(e[4](n),i())}else r&&(c.length=0),e[4]&&e[4](n)}function r(e,n){t.ext.debug("FAILURE SB_Api",JSON.stringify(n)),t.state.value("session",t.state.session_disconnected)}function s(e){var n=e.url+(JSON.stringify(e.params)||"");t.ext.debug("Pushing request on the queue: ",n),0==c.filter(function(t){return t.key==n}).length&&c.push({key:n,data:e})}function i(){if(a)t.ext.debug("Running Error Request"),e.apply(this,this._errorData);else if(c.length>0){var n=c.shift().data;n.state()?e.call(null,n.url,n.params,n.post,n.success,n.failure):(n.count+=1,this._maxRetries>n.count&&s.bindDelay(null,_retryDelay,n),i())}}var o={},a=null,u=50,l=50,c=[];return o.get=function(t,e,n,r,s){o.request(t,e,!1,n,r,s)},o.post=function(t,e,n,r,s){o.request(t,e,!0,n,r,s)},o.request=function(n,r,s,i,o,a){var u=a||t.state.authorized;u.call(t.state)&&e(n,r,s,i,o)},o}),define("sb_light/api/ajax",["sb_light/globals"],function(t){var e={};return e.d3=function(e){return function(n){var r=n.url.replace(/^(https?:\/\/)/,"//"),s=t.urls.o_to_params(n.data);"POST"!==n.type&&s&&(r+="?"+s);var i=e.json(r).on("load",function(t){n.success(t)}).on("error",function(t){n.error(t)});t.state.host!==window.location.host&&i.header("Access-Control-Request-Method",n.type),"POST"!==n.type?i.get():(i.header("Content-type","application/x-www-form-urlencoded"),i.post(s))}},e.dojo=function(e){return function(n){n.url=n.url.replace(/^(https?:\/\/)/,"//"),t.ext.debug("dojo ajax",n.type,n.url),e(n.url,{method:n.type,data:n.data}).then(n.success,n.error)}},e.jquery=function(e){return function(n){var r=t.state.host!=window.location.host;n.url=r?n.url.replace(/^(https?:\/\/)/,"//"):n.url.replace(/^(https?:\/\/)?.+?\//,"/"),t.ext.debug("jquery ajax",n.type,n.url),e.ajax({type:n.type,url:n.url,data:n.data,dataType:n.dataType,crossDomain:r}).done(n.success).fail(n.error)}},e.node=function(e){return function(n){t.ext.debug("Request Agent: ",e);var r="POST"===n.type?e.post(n.url).send(n.data):e.get(n.url).query(n.data);r.set("Accept","application/json").end(function(e){e.ok?(t.ext.debug("Node Ajax success!",e.text),n.success&&n.success(JSON.parse(e.text))):(t.ext.debug("Node Ajax Error",e.text),n.error&&n.error(e.text))})}},e.titanium=function(){return function(e){var n,r;if(t.ext.ti()){var s=t.ext.merge({type:"GET",url:null,data:!1,contentType:"application/json",async:!0,autoEncodeUrl:!0,success:null,error:null,beforeSend:null,complete:null},e),i=Ti.Network.createHTTPClient({autoEncodeUrl:s.autoEncodeUrl,async:s.async});if("GET"===s.type&&s.data){r=[];for(n in s.data)r.put(n+"="+encodeURIComponent(s.data[n]));s.url+="?"+r.join("&"),delete s.data}return i.open(s.type,s.url),i.setRequestHeader("Content-Type",s.contentType),s.beforeSend&&s.beforeSend(i),i.setTimeout(1e4),i.onerror=function(){return null!==s.error?s.error(this):void 0},i.onload=function(){if(400>this.status)try{if(null!==s.success){var t=JSON.parse(this.responseText);return s.success(t)}}catch(e){return Ti.API.error("XHR success function threw Exception: "+e),void 0}else if(null!==s.error)return s.error(this)},s.data?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(s.data)):i.send(),null!==s.complete?s.complete(this):void 0}}},e}),define("widgets/layoutWidget",["widgets/widget"],function(t){var e=t.extend({_layout:null,init:function(t,e,n){this._rootElement=this._rootElement||"div",this._super(t,e,n)},createDom:function(t){return t.widget=this._rootElement,this._dom=this._super(t),this._layout=this._sb.layout.parse(this,this.childrenLayout(),!0),this._dom},childrenLayout:function(){return[]},child:function(t){return this._layout.widgets[this.cid(t)]},applyLayout:function(){this._super(),this._sb.queue.add(this.bind("handleResize"),"handleResize_"+this.id())},handleResize:function(t){this._super(t);var e=this._dom.getBoundingClientRect();this._layout.rootWidth=e.width,this._layout.rootHeight=e.height,this._sb.layout.resize(this._layout)}});return e}),define("widgets/formInput",["widgets/layoutWidget"],function(t){var e=t.extend({create:function(){this._name="layoutWidget::formInput",this._super()},_propertyOverrides:function(){var t=this._super();return t.type=this.bind("type"),t.value=this.bind("value"),t.label=this.bind("label"),t.error=this.bind("error"),t},type:function(t,e){var n=this._sb.ext.slice(arguments,"type"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("input")].property("type",e),this):this._layout.widgets[this.cid("input")].property("type")},label:function(t,e){var n=this._sb.ext.slice(arguments,"label"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("label")].text(e),this):this._layout.widgets[this.cid("label")].text()},value:function(t,e){var n=this._sb.ext.slice(arguments,"value"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("input")].dom().value=e,this):this._layout.widgets[this.cid("input")].dom().value},error:function(t,e){var n=this._sb.ext.slice(arguments,"error"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("error")].text(e),this):this._layout.widgets[this.cid("error")].text()},childrenLayout:function(){return[{id:this.cid("label"),widget:"label",left:10,width:"24%",height:20,top:0,text:"Test Form Widget",style:"text-align:right"},{id:this.cid("input"),widget:"input",left:this.cidDim("label","r",20),width:"40%",height:20,top:0,value:"Test Input Widget"},{id:this.cid("error"),widget:"div",left:this.cidDim("input","r",20),width:"36%",height:20,top:0,text:"Error Widget"}]}});return e}),define("widgets/resizer",["widgets/layoutWidget"],function(t){var e=t.extend({_dragPos:null,_dragDim:"left",_min:0,_max:0,create:function(){this._name="layoutWidget::resizer",this._provideEvents("resize"),this._super()},postCreate:function(){this._super(),this.dom().addEventListener("mousedown",this.bind("_startDrag"))},_propertyOverrides:function(){var t=this._super();return t.min=this.bind("prop"),t.max=this.bind("prop"),t},childrenLayout:function(){return[{id:this.cid("mainBar"),widget:"div",fringe:2,style:"background-color:#FFF;border:solid 1px black;"},{id:this.cid("ghostBar"),widget:"div",fringe:3,left:4,style:"background-color:#000"}]},applyLayout:function(){this._super()},applyProperties:function(){this._super();var t=this.dom().getBoundingClientRect();this._dragDim=t.width>t.height?"top":"left",this.className(this._horizontal?"resizer-v":"resizer-h")},_startDrag:function(t){this._sb.events.stop(t),this._dragging=this.dim(this._dragDim),this.className("dragging"),this.dom().ownerDocument.body.addEventListener("mousemove",this.bind("_drag")),this.dom().ownerDocument.body.addEventListener("mouseup",this.bind("_stopDrag"))},_drag:function(t){var e=this.parentDom().getBoundingClientRect(),n=("left"==this._dragDim?t.clientX:t.clientY)-e[this._dragDim];n=this._sb.ext.range(this._min,this._max,n),this._sb.ext.debug("Resizer::Drag",this.id(),this._dragDim,this._min,this._max,n,t.clientX,e.left),this.dim(this._dragDim,n)},_stopDrag:function(){this._sb.ext.debug("Resizer::DragDone",this.id(),this._dragDim),this.className("dragging",!0),this.dom().ownerDocument.body.removeEventListener("mousemove",this.bind("_drag")),this.dom().ownerDocument.body.removeEventListener("mouseup",this.bind("_stopDrag")),this.trigger("resize")}});return e}),define("widgets/pages/loginPage",["widgets/layoutWidget","widgets/formInput"],function(t,e){var n=t.extend({create:function(){this._name="widget::loginPage",this._super()},postCreate:function(){this._super(),this.dom().addEventListener("submit",this.bind("_handleSubmit"))},childrenLayout:function(){return[{id:this.cid("center_hack"),widget:"div",fringe:"49%",style:"display:none;"},{id:this.cid("form"),widget:"form",left:this.cidDim("center_hack",-300),right:this.cidDim("center_hack",-300),top:50,bottom:50,children:[{id:this.cid("title"),widget:"h3",text:"Welcome to StrategyBlocks",left:20,right:20,top:40,height:30,style:"text-align:center"},{id:this.cid("error"),widget:"p",left:20,right:20,top:this.cidDim("title","b",20),height:30},{id:this.cid("username"),widget:e,left:20,right:20,top:this.cidDim("error","b",20),height:30,value:"glenn.murphy@strategyblocks.com",label:"Email",error:""},{id:this.cid("password"),widget:e,left:20,right:20,top:this.cidDim("username","b",20),type:"password",value:"",height:30,label:"Password",error:""},{id:this.cid("submit"),widget:"button",type:"submit",width:80,left:"28%",height:25,top:this.cidDim("password","b",50),text:"Sign-In"}]}]},_handleSubmit:function(t){this._sb.events.stop(t);var e=this.child("username").value(),n=this.child("password").value();this._sb.state.login(e,n,this.bind("_handleSubmitResponse"),this.bind("_handleSubmitResponse"))},_handleSubmitResponse:function(t){var e=this._sb.ext.getResultMessages(t);e.errors&&t&&t.result&&t.result.errors&&result.errors.form&&(this.cid("username").error(t.result.errors.form.username),this.cid("password").error(t.result.errors.form.password)),this.child("error").text(e.errors?e.errors.message:e.warnings||e.notices||""),this.child("error").className("error",!e.errors),this.child("error").className("warning",e.errors||!e.warnings),this.child("error").className("notice",e.errors||!e.notices)}});return n}),define("widgets/main",["widgets/widget","widgets/layoutWidget","widgets/formInput","widgets/resizer","widgets/svg","widgets/pages/loginPage"],function(t,e,n,r,s,i){return{widget:t,layoutWidget:e,formInput:n,resizer:r,svg:s,login:i}}),define("sb_light/main",["sb_light/globals","sb_light/lib/moment","sb_light/utils/ext","sb_light/utils/svg","sb_light/utils/queue","sb_light/utils/events","sb_light/layout","sb_light/utils/consts","sb_light/utils/Class","sb_light/models","sb_light/controller","sb_light/api/state","sb_light/api/queries","sb_light/api/urls","sb_light/api/api","sb_light/api/ajax","widgets/main"],function(t,e,n,r,s,i,o,a,u,l,c,d,h,f,_,p,m){return t.debug=!0,t.moment=e,t.ext=n,t.svg=r,t.queue=s,t.events=i,t.layout=o,t.consts=a,t.models=l,t.controller=c,t.state=d,t.queries=h,t.urls=f,t.api=_,t.ajax=p,t.Class=u,t.widgets=m,d.host="https://app.strategyblocks.com",t.ext.debug("Loaded SB: ",t.state.host),t}),define("sb_light",["sb_light/main"],function(t){return t});