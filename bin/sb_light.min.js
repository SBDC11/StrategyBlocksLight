/**
 * @version 0.1.0
 * 
 */

// license : MIT

define("globals",["require"],function(){var e={version:(new Date).getTime()},t=function(){return e};return t()}),function(e){function t(e,t,r,n){var s=r.lang();return s[e].call?s[e](r,n):s[e][t]}function r(e,t){return function(r){return a(e.call(this,r),t)}}function n(e){return function(t){var r=e.call(this,t);return r+this.lang().ordinal(r)}}function s(e,t,r){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=r||!1}function o(e){var t=this._data={},r=e.years||e.y||0,n=e.months||e.M||0,s=e.weeks||e.w||0,o=e.days||e.d||0,a=e.hours||e.h||0,u=e.minutes||e.m||0,l=e.seconds||e.s||0,c=e.milliseconds||e.ms||0;this._milliseconds=c+1e3*l+6e4*u+36e5*a,this._days=o+7*s,this._months=n+12*r,t.milliseconds=c%1e3,l+=i(c/1e3),t.seconds=l%60,u+=i(l/60),t.minutes=u%60,a+=i(u/60),t.hours=a%24,o+=i(a/24),o+=7*s,t.days=o%30,n+=i(o/30),t.months=n%12,r+=i(n/12),t.years=r,this._lang=!1}function i(e){return 0>e?Math.ceil(e):Math.floor(e)}function a(e,t){for(var r=e+"";t>r.length;)r="0"+r;return r}function u(e,t,r){var n,s=t._milliseconds,o=t._days,i=t._months;s&&e._d.setTime(+e+s*r),o&&e.date(e.date()+o*r),i&&(n=e.date(),e.date(1).month(e.month()+i*r).date(Math.min(n,e.daysInMonth())))}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e,t){var r,n=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;n>r;r++)~~e[r]!==~~t[r]&&o++;return o+s}function d(e,t,r,n){var s,o,i=[];for(s=0;7>s;s++)i[s]=e[s]=null==e[s]?2===s?1:0:e[s];return e[7]=i[7]=t,null!=e[8]&&(i[8]=e[8]),e[3]+=r||0,e[4]+=n||0,o=new Date(0),t?(o.setUTCFullYear(e[0],e[1],e[2]),o.setUTCHours(e[3],e[4],e[5],e[6])):(o.setFullYear(e[0],e[1],e[2]),o.setHours(e[3],e[4],e[5],e[6])),o._a=i,o}function h(e,t){var r,n,s=[];for(!t&&C&&(t=require("./lang/"+e)),r=0;j.length>r;r++)t[j[r]]=t[j[r]]||P.en[j[r]];for(r=0;12>r;r++)n=T([2e3,r]),s[r]=RegExp("^"+(t.months[r]||t.months(n,""))+"|^"+(t.monthsShort[r]||t.monthsShort(n,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||s,P[e]=t,t}function p(e){var t="string"==typeof e&&e||e&&e._lang||null;return t?P[t]||h(t):T}function f(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function _(e){var t,r,n=e.match(R);for(t=0,r=n.length;r>t;t++)n[t]=tt[n[t]]?tt[n[t]]:f(n[t]);return function(s){var o="";for(t=0;r>t;t++)o+="function"==typeof n[t].call?n[t].call(s,e):n[t];return o}}function m(e,t){function r(t){return e.lang().longDateFormat[t]||t}for(var n=5;n--&&N.test(t);)t=t.replace(N,r);return X[t]||(X[t]=_(t)),X[t](e)}function g(e){switch(e){case"DDDD":return F;case"YYYY":return H;case"S":case"SS":case"SSS":case"DDD":return K;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return Y;case"Z":case"ZZ":return V;case"T":return G;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return U;default:return RegExp(e.replace("\\",""))}}function v(e,t,r,n){var s,o;switch(e){case"M":case"MM":r[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":for(s=0;12>s;s++)if(p().monthsParse[s].test(t)){r[1]=s,o=!0;break}o||(r[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(r[2]=~~t);break;case"YY":r[0]=~~t+(~~t>70?1900:2e3);break;case"YYYY":r[0]=~~Math.abs(t);break;case"a":case"A":n.isPm="pm"===(t+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":r[3]=~~t;break;case"m":case"mm":r[4]=~~t;break;case"s":case"ss":r[5]=~~t;break;case"S":case"SS":case"SSS":r[6]=~~(1e3*("0."+t));break;case"Z":case"ZZ":n.isUTC=!0,s=(t+"").match(Z),s&&s[1]&&(n.tzh=~~s[1]),s&&s[2]&&(n.tzm=~~s[2]),s&&"+"===s[0]&&(n.tzh=-n.tzh,n.tzm=-n.tzm)}null==t&&(r[8]=!1)}function y(e,t){var r,n,s=[0,0,1,0,0,0,0],o={tzh:0,tzm:0},i=t.match(R);for(r=0;i.length>r;r++)n=(g(i[r]).exec(e)||[])[0],n&&(e=e.slice(e.indexOf(n)+n.length)),tt[i[r]]&&v(i[r],n,s,o);return o.isPm&&12>s[3]&&(s[3]+=12),o.isPm===!1&&12===s[3]&&(s[3]=0),d(s,o.isUTC,o.tzh,o.tzm)}function b(e,t){var r,n,o,i,a,u=e.match(B)||[],l=99;for(o=0;t.length>o;o++)i=y(e,t[o]),n=m(new s(i),t[o]).match(B)||[],a=c(u,n),l>a&&(l=a,r=i);return r}function E(e){var t,r="YYYY-MM-DDT";if(z.exec(e)){for(t=0;4>t;t++)if(W[t][1].exec(e)){r+=W[t][0];break}return V.exec(e)?y(e,r+" Z"):y(e,r)}return new Date(e)}function S(e,t,r,n,s){var o=s.relativeTime[e];return"function"==typeof o?o(t||1,!!r,e,n):o.replace(/%d/i,t||1)}function k(e,t,r){var n=w(Math.abs(e)/1e3),s=w(n/60),o=w(s/60),i=w(o/24),a=w(i/365),u=45>n&&["s",n]||1===s&&["m"]||45>s&&["mm",s]||1===o&&["h"]||22>o&&["hh",o]||1===i&&["d"]||25>=i&&["dd",i]||45>=i&&["M"]||345>i&&["MM",w(i/30)]||1===a&&["y"]||["yy",a];return u[2]=t,u[3]=e>0,u[4]=r,S.apply({},u)}function D(e,t){T.fn[e]=function(e){var r=this._isUTC?"UTC":"";return null!=e?(this._d["set"+r+t](e),this):this._d["get"+r+t]()}}function O(e){T.duration.fn[e]=function(){return this._data[e]}}function M(e,t){T.duration.fn["as"+e]=function(){return+this/t}}for(var T,A,L="1.7.2",w=Math.round,P={},I="en",C="undefined"!=typeof module&&module.exports,j="months|monthsShort|weekdays|weekdaysShort|weekdaysMin|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),x=/^\/?Date\((\-?\d+)/i,R=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,N=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,B=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,U=/\d\d?/,K=/\d{1,3}/,F=/\d{3}/,H=/\d{1,4}/,Y=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,V=/Z|[\+\-]\d\d:?\d\d/i,G=/T/i,z=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,q="YYYY-MM-DDTHH:mm:ssZ",W=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],Z=/([\+\-]|\d\d)/gi,J="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),Q={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},X={},$="DDD w M D d".split(" "),et="M D H h m s w".split(" "),tt={M:function(){return this.month()+1},MMM:function(e){return t("monthsShort",this.month(),this,e)},MMMM:function(e){return t("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var e=new Date(this.year(),this.month(),this.date()),t=new Date(this.year(),0,1);return~~((e-t)/864e5+1.5)},d:function(){return this.day()},dd:function(e){return t("weekdaysMin",this.day(),this,e)},ddd:function(e){return t("weekdaysShort",this.day(),this,e)},dddd:function(e){return t("weekdays",this.day(),this,e)},w:function(){var e=new Date(this.year(),this.month(),this.date()-this.day()+5),t=new Date(e.getFullYear(),0,4);return~~((e-t)/864e5/7+1.5)},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return a(~~(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+a(~~(e/60),2)+":"+a(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+a(~~(10*e/6),4)}};$.length;)A=$.pop(),tt[A+"o"]=n(tt[A]);for(;et.length;)A=et.pop(),tt[A+A]=r(tt[A],2);for(tt.DDDD=r(tt.DDD,3),T=function(t,r){if(null===t||""===t)return null;var n,o;return T.isMoment(t)?new s(new Date(+t._d),t._isUTC,t._lang):(r?n=l(r)?b(t,r):y(t,r):(o=x.exec(t),n=t===e?new Date:o?new Date(+o[1]):t instanceof Date?t:l(t)?d(t):"string"==typeof t?E(t):new Date(t)),new s(n))},T.utc=function(e,t){return l(e)?new s(d(e,!0),!0):("string"!=typeof e||V.exec(e)||(e+=" +0000",t&&(t+=" Z")),T(e,t).utc())},T.unix=function(e){return T(1e3*e)},T.duration=function(e,t){var r,n=T.isDuration(e),s="number"==typeof e,i=n?e._data:s?{}:e;return s&&(t?i[t]=e:i.milliseconds=e),r=new o(i),n&&(r._lang=e._lang),r},T.humanizeDuration=function(e,t,r){return T.duration(e,t===!0?null:t).humanize(t===!0?!0:r)},T.version=L,T.defaultFormat=q,T.lang=function(e,t){var r;if(!e)return I;if((t||!P[e])&&h(e,t),P[e]){for(r=0;j.length>r;r++)T[j[r]]=P[e][j[r]];T.monthsParse=P[e].monthsParse,I=e}},T.langData=p,T.isMoment=function(e){return e instanceof s},T.isDuration=function(e){return e instanceof o},T.lang("en",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},meridiem:function(e,t,r){return e>11?r?"pm":"PM":r?"am":"AM"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"}}),T.fn=s.prototype={clone:function(){return T(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return""+this._d},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?null!=this._a[8]?!!this._a[8]:!c(this._a,(this._a[7]?T.utc(this._a):T(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return m(this,e?e:T.defaultFormat)},add:function(e,t){var r=t?T.duration(+t,e):T.duration(e);return u(this,r,1),this},subtract:function(e,t){var r=t?T.duration(+t,e):T.duration(e);return u(this,r,-1),this},diff:function(e,t,r){var n,s=this._isUTC?T(e).utc():T(e).local(),o=6e4*(this.zone()-s.zone()),i=this._d-s._d-o,a=this.year()-s.year(),u=this.month()-s.month(),l=this.date()-s.date();return n="months"===t?12*a+u+l/30:"years"===t?a+(u+l/30)/12:"seconds"===t?i/1e3:"minutes"===t?i/6e4:"hours"===t?i/36e5:"days"===t?i/864e5:"weeks"===t?i/6048e5:i,r?n:w(n)},from:function(e,t){return T.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(T(),e)},calendar:function(){var e=this.diff(T().sod(),"days",!0),t=this.lang().calendar,r=t.sameElse,n=-6>e?r:-1>e?t.lastWeek:0>e?t.lastDay:1>e?t.sameDay:2>e?t.nextDay:7>e?t.nextWeek:r;return this.format("function"==typeof n?n.apply(this):n)},isLeapYear:function(){var e=this.year();return 0===e%4&&0!==e%100||0===e%400},isDST:function(){return T([this.year()]).zone()>this.zone()||T([this.year(),5]).zone()>this.zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==e?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return T.utc([this.year(),this.month()+1,0]).date()},lang:function(t){return t===e?p(this):(this._lang=t,this)}},A=0;J.length>A;A++)D(J[A].toLowerCase(),J[A]);D("year","FullYear"),T.duration.fn=o.prototype={weeks:function(){return i(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(e){var t=+this,r=this.lang().relativeTime,n=k(t,!e,this.lang()),s=0>=t?r.past:r.future;return e&&(n="function"==typeof s?s(n):s.replace(/%s/i,n)),n},lang:T.fn.lang};for(A in Q)Q.hasOwnProperty(A)&&(M(A,Q[A]),O(A.toLowerCase()));M("Weeks",6048e5),"undefined"==typeof ender&&(this.moment=T),"function"==typeof define&&define.amd&&define("moment",[],function(){return T})}.call(this),define("utils/ext",["../globals"],function(e){var t={};return t.slice=function(e,t,r){return t=isNaN(t)?0:t,isNaN(r)?Array.prototype.slice.call(e,t):Array.prototype.slice.call(e,t,r)},t.debug=function(){if(e.debug){var r=[(new Date).toTimeString()].concat(t.slice(arguments)).join(" ");t.ti()?Ti.API.debug(r):"undefined"!=typeof console&&console.log(r)}},t.ti=function(){return"undefined"!=typeof Ti},t.map=function(e,r,n){var s=[];if(t.isArray(e))for(var o=0,i=e.length;i>o;++o)s.push(r.call(n||this,e[o],o,e));else for(var a in e)s.push(r.call(n||this,e[a],a,e));return s},t.each=function(e,r,n){if(t.isArray(e))e.forEach(r,n);else for(var s in e)r.call(n||e,e[s],s,e)},t.length=function(e){return t.isArray(e)?e.length:e?Object.keys(e).length:0},t.toObject=function(e,t){return e.reduce(function(e,r){return e[r[t]]=r,e},{})},t.values=function(e,r){return t.map(e,function(e,t){return r&&(e[r]=e[r]||t),e})},t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.isArr=function(e){return"[object Array]"==Object.prototype.toString.call(e)},t.isArray=t.isArr,t.isFunc=function(e){return"[object Function]"==Object.prototype.toString.call(e)},t.isFunction=t.isFunc,t.isStr=function(e){return"[object String]"==Object.prototype.toString.call(e)},t.isString=t.isStr,t.isBool=function(e){return"[object Boolean]"==Object.prototype.toString.call(e)},t.isBoolean=t.isBool,t.isNum=function(e){return"[object Number]"==Object.prototype.toString.call(e)},t.isNumber=t.isNum,t.isDate=function(e){return"[object Date]"==Object.prototype.toString.call(e)},t._getClass={}.toString,t.caps=function(e){return e=t.isArray(e)?e:[e],e.reduce(function(e,t){return e+" "+t.charAt(0).toUpperCase()+t.slice(1)},"")},t.capitalize=t.caps,t.replace=function(e,r){var n=e;return t.each(r,function(e,t){var r=RegExp("%"+t.toUpperCase()+"%");n=n.replace(r,e)}),n},t.parseDate=function(t){return e.moment(t).toDate()},t.daysDiff=function(t,r){return e.moment(r).diff(e.moment(t),"days")},t.today=function(){return new Date},t.minDate=function(){return t.parseDate(t.slice(arguments).sort(t.sortDate)[0])},t.maxDate=function(){return t.parseDate(t.slice(arguments).sort(t.sortDate).last())},t.serverFormat="YYYY/MM/DD",t.userFormat=function(){var r=e.state&&e.state.value("user");return r?r.date_format:t.serverFormat},t.serverDate=function(r){return e.moment(r).format(t.serverFormat)},t.userDate=function(r){return e.moment(r).format(t.userFormat())},t.dateFromNow=function(r,n,s){return s?"("+e.moment(r).fromNow()+") "+e.moment(r).format(n||t.userFormat()):e.moment(r).format(n||t.userFormat())+" ("+e.moment(r).fromNow()+")"},t.regEmail=RegExp("([\\w-\\.]+)@((?:[\\w]+\\.)+)([a-zA-Z]{2,4})"),t.regUrl=RegExp("^https?://"),t.sortFactory=function(e,t,r){return function(n,s){return t(n[e],s[e])*(r?-1:1)}},t.sortTime=function(e,r){return t.sortNumbers(t.parseDate(e).getTime(),t.parseDate(r).getTime())},t.sortNumber=function(e,t){return e-t},t.sortNumbers=t.sortNumber,t.sortDate=function(e,r){return t.daysDiff(r,e)},t.sortDates=t.sortDate,t.sortString=function(e,t){return e.localeCompare(t)},t.sortStrings=t.sortString,t.sortBool=function(e,r){return t.sortNumber(e?1:0,r?1:0)},t.sortDateValue=function(e,r){return t.sortDate(e.date,r.date)},t.sortUsers=function(e,t){return e.last_name.localeCompare(t.last_name)},t.sortFocus=function(e,t){return e.title.localeCompare(t.title)},t.sortName=function(e,t){return e.name.localeCompare(t.name)},t.sortBlocksByProgress=function(e,r){var n=e.closed,s=r.closed;if(n&&!s)return 1;if(!n&&s)return-1;var o="new"==e.ownership_state,i="new"==r.ownership_state;if(o&&!i)return 1;if(!o&&i)return-1;if(o&&i||n&&s)return t.sortString(e.title,r.title);var a=e.expected_progress,u=r.expected_progress;return!a&&u?1:a&&!u?-1:a||u?t.sortNumbers(e.percent_progress/a,r.percent_progress/u):0},t.px=function(e){return[e,"px"].join("")},t.pc=function(e){return[e,"%"].join("")},t.roundTo=function(e,t){var r=Math.pow(10,t);return Math.round(e*r)/r},t.to_i=function(e,t,r){var n=parseInt(e,t||10);return isNaN(n)?void 0===r?0:r:n},t.to_color=function(e){return"#"+("00000"+(0|e).toString(16)).substr(-6)},t.number=function(e,t){return isNaN(e)?t||0:e},t.max=function(){for(var e,t=Number.NEGATIVE_INFINITY,r=0;arguments.length>r;++r)e=this.number(arguments[r],Number.NEGATIVE_INFINITY),t=e>t?e:t;return t},t.min=function(){for(var e,t=Number.POSITIVE_INFINITY,r=0;arguments.length>r;++r)e=this.number(arguments[r],Number.POSITIVE_INFINITY),t=t>e?e:t;return t},t.healthColor=function(e){return["#D80000","#EACF00","#0FAD00"][e.status+1]},t.healthText=function(e){return["Bad","Warning","Good"][e.status+1]},t.blockProgressFill=function(e){switch(e.progress_color){case"green":return["#176717","url(#progressGood)"];case"yellow":return["#77771B","url(#progressWarning)"];case"red":return["#641717","url(#progressBad)"];default:return["#999","url(#progressNone)"]}},t.getResultMessages=function(e){var r={errors:null,warnings:null,notices:null};return e&&(t.isArray(e.result)?e.result.forEach(function(t){t&&t.errors&&(r.errors={form:e.result,message:JSON.stringify(e.result)})}):e.result&&e.result.errors&&(r.errors={form:e.result.errors,message:JSON.stringify(e.result)}),!r.errors&&e.flash&&e.flash.error&&(r.errors={message:e.flash.error}),!r.errors&&e.errors&&e.errors.error&&(r.errors={message:e.errors.error})),r.notices=e.flash.notice,r.warnings=e.flash.warning,r},t.massageTA=function(e){var r=[];e.values.forEach(function(e){e.date=t.parseDate(e.date),r.punique(e.date)}),e.values.sort(t.sortDateValue),e.target.forEach(function(n){n.date=t.parseDate(n.date),r.punique(n.date);var s=e.tolerance.range_start>e.tolerance.range_end?e.tolerance.range_start:e.tolerance.range_end,o=e.tolerance.range_start>e.tolerance.range_end?e.tolerance.range_end:e.tolerance.range_start;n.upper=n.value+(e.tolerance.percentage?n.value*s/100:s),n.lower=n.value+(e.tolerance.percentage?n.value*o/100:o)}),e.target.sort(t.sortDateValue),e.dates=r.sort(t.sortDate);var n=new Date;return e.dates[0].getTime()>n.getTime()&&e.dates.unshift(n),n.getTime()>e.dates.last().getTime()&&e.dates.put(n),e},t.massageHealth=function(e){var r=$.map(e.historical_values,function(e,r){return{date:t.parseDate(r),value:e}});return e.series=r.sort(t.sortDateValue),e.dates=e.series.map(function(e){return e.date}),e.dates.push(t.parseDate(e.end_date)),e},t.mixin=function(e,r,n){var s,o,i=n||{},e=e||{},r=r||{};for(s in r){o=r[s];var a=t.isArray(i)?i.indexOf(s)>=0:s in i;a||(e[s]=o)}return e},t.combine=function(e,r){return e=t.isArray(e)?e:[e],e.reduce(function(e,n){return t.mixin(e,n,r)},{})},t.merge=function(e,r,n){return t.combine([e,r],n)},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var r=0,n=this.length;n>r;++r)e.call(t||this,this[r],r,this)}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var r=t.slice(arguments,1),n=this,s=function(){},o=function(){return n.apply(this instanceof s?this:e,r.concat(t.slice(arguments)))};return s.prototype=this.prototype,o.prototype=new s,o}),Function.prototype.bindDelay||(Function.prototype.bindDelay=function(e,t){var r=this,n=e,s=Array.prototype.slice.call(arguments,2);return setTimeout(function(){r.apply(n,s)},t)}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var r=0,n=this.length;n>r;++r)e.call(t||this,this[r],r,this)}),Array.prototype.clone||(Array.prototype.clone=function(){return[].concat(this)}),Array.prototype.last||(Array.prototype.last=function(e){return e=this.length-1-(e||0),this.length>e&&e>=0?this[e]:null}),Array.prototype.reduce||(Array.prototype.reduce=function(e){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var t,r=0,n=this.length>>0;if("function"!=typeof e)throw new TypeError("First argument is not callable");if(2>arguments.length){if(0===n)throw new TypeError("Array length is 0 and no second argument");t=this[0],r=1}else t=arguments[1];for(;n>r;)r in this&&(t=e.call(void 0,t,this[r],r,this)),++r;return t}),Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],s=arguments[1],o=0;r>o;o++)if(o in t){var i=t[o];e.call(s,i,o,t)&&n.push(i)}return n}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var o=[];for(var i in s)e.call(s,i)&&o.push(i);if(t)for(var a=0;n>a;a++)e.call(s,r[a])&&o.push(r[a]);return o}}()),Array.prototype.find||(Array.prototype.find=function(e,t){for(var r=0;this.length>r;++r)if(this[r][e]==t)return{index:r,value:this[r]};return{index:0/0,value:null}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&1/0!=n&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var s=n>=0?n:Math.max(r-Math.abs(n),0);r>s;s++)if(s in t&&t[s]===e)return s;return-1}),Array.prototype.map||(Array.prototype.map=function(e,t){var r,n,s;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("[object Function]"!={}.toString.call(e))throw new TypeError(e+" is not a function");for(t&&(r=t),n=Array(i),s=0;i>s;){var a,u;s in o&&(a=o[s],u=e.call(r,a,s,o),n[s]=u),s++}return n}),Array.prototype.put||(Array.prototype.put=function(){for(var e=t.slice(arguments);e.length;)this[this.length]=e.shift();return this}),Array.prototype.punique||(Array.prototype.punique=function(){for(var e=t.slice(arguments);e.length;){var r=e.shift();0>this.indexOf(r)&&(this[this.length]=r)}return this}),Array.prototype.cloneExcept||(Array.prototype.cloneExcept=function(){var e=t.slice(arguments);return this.reduce(function(t,r){return 0>e.indexOf(r)?t.put(r):t},[])}),Date.prototype.getMonthName=function(e){return e=e&&e in Date.locale?e:"en",Date.locale[e].month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(e){return e=e&&e in Date.locale?e:"en",Date.locale[e].month_names_short[this.getMonth()]},Date.locale={en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},t}),define("utils/svg",["../globals"],function(){var e={};return e.gridPath=function(e,t,r,n,s,o){var i=[],a=this,u="number"==typeof s?d3.range(e+s,e+r,s):s;o=o||s;var l="number"==typeof o?d3.range(t+o,t+n,o):o;return u.forEach(function(e){i.put(a.M(e,t),a.v(n))}),l.forEach(function(t){i.put(a.M(e,t),a.h(r))}),i.join("")},e.popupPath=function(e,t,r,n,s){var o=10,i=2*o,a=15,u=2*a,l=15,c=this;s=s||"TM";var d=[];if("T"==s.charAt(0)){switch(d.put(c.M(e+o,t)),s.charAt(1)){case"L":d.put(c.l(a,-l),c.l(a,l),c.h(r-u-i));break;case"M":d.put(c.h((r-i-u)/2),c.l(a,-l),c.l(a,l),c.h((r-i-u)/2));break;case"R":d.put(c.h(r-u-i),c.l(a,-l),c.l(a,l))}d.put(c.q(o,0,o,o),c.v(n-i)),d.put(c.q(0,o,-o,o),c.h(i-r)),d.put(c.q(-o,0,-o,-o),c.v(i-n)),d.put(c.q(0,-o,o,-o))}else"R"==s.charAt(0)||"B"==s.charAt(0)||"L"==s.charAt(0);return d.join("")},e.transform=function(e){var t=[];return e.r&&t.put(this.rotate.apply(this,e.r)),e.s&&t.put(this.scale.apply(this,e.s)),e.t&&t.put(this.translate.apply(this,e.t)),t.join(" ")},e.translate=function(e,t){return(isNaN(t)?["translate(",e,")"]:["translate(",e,", ",t,")"]).join("")},e.scale=function(e,t){return(isNaN(t)?["scale(",e,")"]:["scale(",e,", ",t,")"]).join("")},e.rotate=function(e){return"rotate("+e+")"},e.viewBox=function(e,t,r,n){return[e,t,r,n].join(" ")},e.l=function(e,t){return["l",e,this._sep,t].join("")},e.L=function(e,t){return["L",e,this._sep,t].join("")},e.m=function(e,t){return["m",e,this._sep,t].join("")},e.M=function(e,t){return["M",e,this._sep,t].join("")},e.h=function(e){return["h",e].join("")},e.H=function(e){return["H",e].join("")},e.v=function(e){return["v",e].join("")},e.V=function(e){return["V",e].join("")},e.q=function(e,t,r,n){var s=this._sep;return["q",e,s,t,s,r,s,n].join("")},e.Q=function(e,t,r,n){var s=this._sep;return["Q",e,s,t,s,r,s,n].join("")},e.append=function(e,t,r){var n=e.select(t);if(n.empty()){n=e;var s=t.split(" ");s.forEach(function(e){if(e&&e.length>0)if(n.select(e).empty()){var t=e.split(".");n=n.append(t.shift()).attr("class",t.join(" "))}else n=n.select(e)}),null!=r&&r(n)}return n},e.remove=function(e,t){var r=e.select(t);r.empty()||r.remove()},e.dims=function(e,t,r,n,s){return s.attr("x",e).attr("y",t).attr("width",r).attr("height",n),s},e}),define("utils/consts",["../globals"],function(){var e={};return e.COLOR={BLOCK:{green:"#176717",yellow:"#77771B",red:"#641717"}},e.STATE={BLOCK:"block",BLOCK_TREE_ZOOM:"blockTreeZoom",BLOCK_MAP_ZOOM:"blockMapZoom",CHILD_BLOCK:"childBlock",BLOCK_SETTINGS_VIEW:"blockSettingsView",BLOCK_SETTINGS_COLLAPSE:"blockSettingsCollapse",BLOCKS_TREE_VIEW:"blocksTreeView",BLOCKS_MAP_VIEW:"blocksMapView",BLOCKS_TIMELINE_VIEW:"blocksTimelineView",MANAGE_BLOCK_VIEW:"manageBlockView",PAGE:"page",USER_ID:"userId",COMPANY_ID:"companyId",COMPANY:"company",USER:"user",SESSION:"session",PREV_PAGE:"previousPage",PREV_BLOCK:"previousBlock"},e.BLOCK_SETTINGS={VIEW:{DEFAULT:{name:"Default",key:"bd"},STATUS:{name:"Status",key:"bs"},PROGRESS:{name:"Progress",key:"bp"},HEALTH:{name:"Health",key:"bh"},KPI:{name:"Outputs",key:"bk"},RISK:{name:"Risk",key:"br"},NPV:{name:"Value",key:"bn"}},COLLAPSE:"c"},e.BLOCKS_MAP={VIEW:{RADIAL:"radial",HIERARCHY:"hierarchy"}},e.BLOCKS_TREE={VIEW:{STATUS:"status",PROGRESS:"progress",HEALTH:"health",KPI:"outputs",RISK:"risk",NPV:"value"}},e.BLOCKS_TIMELINE={VIEW:{CHART:"chart",TABLE:"table"}},e.MANAGE_BLOCK={VIEW:{BLOCK:"block",NEW_CHILD:"newChild",EDIT_CHILD:"editChild",CHILDREN_LIST:"childrenList",NEW_LINK:"newLink",EDIT_LINK:"editLink"}},e.SIZES={BLOCK_WIDTH:350,BLOCK_HEIGHT:185,BLOCK_HEIGHT_SMALL:150,BLOCK_PADDING_X:80,BLOCK_PADDING_Y:90},e}),define("utils/Class",[],function(){var e=!1,t=/xyz/.test(function(){})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(r){function n(){!e&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;e=!0;var o=new this;e=!1;for(var i in r)o[i]="function"==typeof r[i]&&"function"==typeof s[i]&&t.test(r[i])?function(e,t){return function(){var r=this._super;this._super=s[e];var n=t.apply(this,arguments);return this._super=r,n}}(i,r[i]):r[i];return n.prototype=o,n.prototype.constructor=n,n.extend=arguments.callee,n},Class}),define("models/_abstractModel",["../utils/Class"],function(e){var t=e.extend({name:null,_sb:null,_model:null,_modelArray:null,_urlDef:null,_selectQueue:null,_subscriptions:null,init:function(e,t,r){if(!t)throw Error("AbstractModel: Model name must be declared");if(!r)throw Error("AbstractModel: Model urlDef must be declared");this._sb=e,this.name=t,this._urlDef=r,this._selectQueue=[],this._subscriptions=[],this._sb.state.register(this,this._urlDef,this._handleUpdate.bind(this))},reset:function(e){this._model=null,this._modelArray=null,this._sb.state.resetTimestamp(this.name),e&&this._publish()},isValid:function(){return null!=this.get()},get:function(){return this._model?this._modelArray:(this._sb.ext.debug("Getting the "+this.name+" model."),this._sb.state.authorized()&&(this._sb.ext.debug("Forcing the update"),this._sb.state.forceModelUpdate(this)),null)},raw:function(){return this._model},rawArray:function(){return this._modelArray},subscribe:function(e){this._subscriptions.put(e);var t=this.get();t&&e(t)},unsubscribe:function(e){var t=this._subscriptions.indexOf(e);t>=0&&this._subscriptions.splice(t,1)},_publish:function(){var e=this.get();this._subscriptions.forEach(function(t){t.bindDelay(null,50,e)})},select:function(e,t,r){this._selectQueue.push({type:e,cb:t,func:r}),this._processQueue()},_handleUpdate:function(e){this._processResponse(e),this._model&&(this._publish(),this._processQueue())},_processQueue:function(){var e=this.get();if(e)for(;this._selectQueue.length;){var t=this._selectQueue.pop();switch(t.type){case"map":t.cb(this._model);break;case"all":t.cb(e);break;case"filter":t.cb(e.filter(t.func))}}},_processResponse:function(e){this._model=this._model||{},this._sb.ext.debug("Processin Model",this.name),this._addItems(e.added),this._updateItems(e.updated),this._deleteItems(e.deleted),this._massageUpdatedModel(),this._resetArrayCache()},_addItems:function(e){e=e||{};for(var t in e)this._model[t]=e[t]},_updateItems:function(e){e=e||{};for(var t in e)this._model[t]=e[t]},_deleteItems:function(e){var t=this._model;e=e||[];var r=this;e.forEach(function(e){t[e]&&r._sb.ext.debug("Deleting Model",r.name,e),delete t[e]})},_massageUpdatedModel:function(){},_resetArrayCache:function(){this._modelArray=this._sb.ext.map(this._model,function(e){return e})}});return t}),define("models/tagsModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"tags",e.urls.MODEL_TAGS)}});return t}),define("models/newsModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"news",e.urls.MODEL_NEWS)},_massageUpdatedModel:function(){this._super()}});return t}),define("models/usersModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"users",e.urls.MODEL_USERS)},_massageUpdatedModel:function(){this._super();for(var e in this._model){var t=this._model[e];t.name=t.first_name+" "+t.last_name}}});return t}),define("models/blocksModel",["./_abstractModel"],function(e){var t=e.extend({_progress:null,_health:null,_npv:null,_npv_queue:null,_progress_queue:null,_health_queue:null,_properties:null,_propertiesList:["comments","news","tags","documents","context","watching_users"],init:function(e){this._npv_queue=[],this._progress_queue=[],this._health_queue=[],this._properties={},this._super(e,"blocks",e.urls.MODEL_BLOCKS)},_handleUpdate:function(e){this._progress=null,this._health=null,this._npv=null,this._super(e)},_massageUpdatedModel:function(){this._super();var e=this._model[this._sb.state.value("company").root_block.id];this._massage(e,null,0,(new Date).getTime()),this._sb.ext.debug("Finished massaging blocks")},progress:function(e){this._data(e,"_progress",this._sb.urls.BLOCKS_PROGRESS)},health:function(e){this._data(e,"_health",this._sb.urls.BLOCKS_HEALTH)},npv:function(e){this._data(e,"_npv",this._sb.urls.BLOCKS_NPV)},comments:function(e,t,r){this._property(t,"comments",e,r)},news:function(e,t,r){this._property(t,"news",e,r)},tags:function(e,t,r){this._property(t,"tags",e,r)},documents:function(e,t,r){this._property(t,"documents",e,r)},context:function(e,t,r){this._property(t,"context",e,r)},watching:function(e,t,r){this._property(t,"watching_users",e,r)},_property:function(e,t,r,n){if(!(this._propertiesList.indexOf(t)>=0))throw Error("BlockModel property is not valid:"+t);this._properties[t]=this._properties[t]||{},!this._properties[t][r]||n?(this._properties[t][r]="waiting",this._properties[t+"_queue"]=this._properties[t+"_queue"]||{},this._properties[t+"_queue"][r]=this._properties[t+"_queue"][r]||[],this._properties[t+"_queue"][r].push(e),this._sb.controller.invoke(this._sb.urls.BLOCKS_PROPERTIES,{id:r,type:t},this._handleProperty.bind(this,t,r))):"waiting"==this._properties[t][r]?this._properties[t+"_queue"][r].push(e):e(this._properties[t][r])
},_data:function(e,t,r){var n=this._handleData.bind(this,t);this[t+"_queue"].push(e),this[t]?n():1==this[t+"_queue"].length&&sb.controller.invoke(r,null,n)},_handleData:function(e,t){for(this[e]=t?t.result:this[e];this[e+"_queue"].length;){var r=this[e+"_queue"].pop();r(this[e])}},_handleProperty:function(e,t,r){for(this._properties[e]=this._properties[e]||{},this._properties[e][t]=r?r.result:this._properties[e][t];this._properties[e+"_queue"][t].length;){var n=this._properties[e+"_queue"][t].pop();n(this._properties[e][t])}},_massage:function(e,t,r,n){var s=e._schema!=n;e._schema=s?n:e._schema,e.paths=!s&&e.paths||[],e.children=e.children||[];var o=t?this._model[t.last()]:null;if(o){var i=e.parents.find("parent_id",o.id).value,a=e.parents.find("linked_parent_id",null).value;i.position=o.children.indexOf(e.id),i.level=r,e.paths.put(t.concat([e.id])),o.id==a.parent_id&&(e.default_path=e.paths.last(),e.default_parent=o.id,e.default_level=r,e.default_position=i.position),o.is_owner&&(i.can_move_left=i.position>0,i.can_move_right=o.children.length-1>i.position&&o.children.length>1,i.can_delete=!0)}else e.default_path=[e.id],e.default_parent=null,e.paths.put([e.id]),e.default_position=0,e.default_level=0;for(var u=e.paths.last(),l=0;e.children.length>l;++l)this._massage(this._model[e.children[l]],u,r+1,n)},_resetArrayCache:function(){this._super(),this._modelArray.sort(this._sb.ext.sortBlocksByProgress)}});return t}),define("models/levelsModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"levels",e.urls.MODEL_LEVELS)}});return t}),define("models/focusModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"focus",e.urls.MODEL_FOCUS)}});return t}),define("models/risksModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"risks",e.urls.MODEL_RISKS)}});return t}),define("models/kpisModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"kpis",e.urls.MODEL_KPIS)}});return t}),define("models/groupsModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"levels",e.urls.MODEL_GROUPS)}});return t}),define("models/companiesModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"companies",e.urls.MODEL_COMPANIES)}});return t}),define("models/timezonesModel",["./_abstractModel"],function(e){var t=e.extend({init:function(e){this._super(e,"timezones",e.urls.MODEL_TIMEZONES)},_processResponse:function(e){this._sb.ext.debug("Handle Timezone response"),this._super(e),this._sb.ext.debug("Done Handle Timezone response",this._model)},get:function(){this._sb.ext.debug("Getting Timezones.");var e=this._super();return this._sb.ext.debug("Done Getting Timezones.",e),e}});return t}),define("models",["./globals","./models/tagsModel","./models/newsModel","./models/usersModel","./models/blocksModel","./models/levelsModel","./models/focusModel","./models/risksModel","./models/kpisModel","./models/groupsModel","./models/companiesModel","./models/timezonesModel"],function(e,t,r,n,s,o,i,a,u,l,c,d){function h(t){var r=p[t];if(!r)throw Error("sb.appModel.js: Model name not found: "+t);return r.model||(r.model=new r.klass(e)),r}var p={tags:{klass:t},news:{klass:r},users:{klass:n},blocks:{klass:s},levels:{klass:o},focus:{klass:i},risks:{klass:a},kpis:{klass:u},groups:{klass:l},companies:{klass:c},timezones:{klass:d}},f={};return f.reset=function(e){for(var t in p){var r=p[t]?p[t].model:null;r&&r.reset(e)}},f.get=function(e){var t=h(e);return t.model},f.subscribe=function(e,t){var r=h(e);r.model.subscribe(t)},f.unsubscribe=function(e,t){var r=h(e);r.model.unsubscribe(t)},f.rawArray=function(e){var t=h(e);return t.model?t.model.rawArray():void 0},f.raw=function(e){var t=h(e);return t.model?t.model.raw():void 0},f.select=function(t,r,n,s){var o=h(t);o.model&&(e.ext.debug("Doing a select on the model.",t),o.model.select(r,n,s))},f.isValid=function(e){var t=h(e),r=!1;return t.model&&(r=t.model.isValid()),r},f}),define("controller",["./globals"],function(e){var t={};return t.invoke=function(t,r,n,s,o){var i=e.urls.url(t,r),a={};t.deleteId&&delete r.id;var u=t.massageParamsFunc?e.urls[t.massageParamsFunc](r):r;null!=u&&(u instanceof Array?a.json=JSON.stringify(u):Object.keys(u).length>0&&(t.normalParams?a=u:a.json=JSON.stringify(u)));var l=t.post===void 0||t.post||!1;e.api.request(i,a,l,n,s,o||null)},t.forgotPassword=function(r,n,s){t.invoke(e.urls.LOGIN_FORGOT_PASSWORD,{username:r},n,s,e.state.invalid)},t.blockComment=function(r,n,s){t.invoke(e.urls.COMMENT_PROPERTIES_ADD,{id:r,body:n},s,s)},t.blockClose=function(r,n,s){t.invoke(e.urls.BLOCKS_CLOSE,e.ext.mixin({id:r},n),s,s)},t.blockPublish=function(r,n,s){t.invoke(e.urls.BLOCKS_MAKE_PUBLIC,{id:r,children:n},s,s)},t.changeDefaultCompany=function(r,n,s){t.invoke(e.urls.USERS_CHANGE_DEFAULT_COMPANY,{id:e.state.value("userId"),default_company_id:r},n,s)},t}),define("api/state",["../globals"],function(e){function t(t){if(t){var r=t.user?t.user.id:null,n=t.company?t.company.id:null;(r!=o.userId||n!=o.companyId)&&(o.userId=t.user?t.user.id:null,o.companyId=t.company?t.company.id:null),null==o.block&&null!=t.block&&(o.block=t.block+"")}else o.userId=o.companyId=null,o.user=o.company=null;null==s.value("userId")?(e.ext.debug("setting session to unauthorized"),s.unknown()&&(t.flash={notice:"Please enter your login credentials."}),o.session=s.session_invalid):(o.company=t.company,o.user=t.user,t.company&&t.company.license&&"expired"==t.company.license.status?(e.ext.debug("setting session to payment"),o.session=s.session_payment):(e.ext.debug("setting session to normal"),o.session=s.session_normal)),s.authorized()||e.models.reset(),s.value("flash",t.flash),s.value("errors",t.errors)}function r(e){for(var t in s.models)e&&e[t]&&(a[t]=i[t]=null,s.models[t].timestamp=e[t].timestamp,s.models[t].cb(e[t]))}function n(t,r){var n=r&&r.result,s=n[t.name]||n;null==t.raw()&&s&&(e.ext.isArray(s)&&(s=s.reduce(function(e,t){return e[t.id]=t,e},{})),t._handleUpdate({added:s})),a[t.name]=!1}var s={};s.stateKeys=["session_unknown","session_normal","session_payment","session_invalid","session_disconnected"],s.stateKeys.reduce(function(e,t,r){return e[t]=r,e},s);var o={page:"",block:null,news:null,kpi:null,risk:null,tag:null,userId:null,companyId:null,company:null,user:null,session:s.session_unknown,url:"",childBlock:null,blockTreeZoom:1,blockMapZoom:1,blockSettingsView:"",blockSettingsCollapse:"",blocksTreeView:"progress",blocksMapView:"radial",blocksTimelineView:"chart",manageBlockView:"block",previousBlock:null,previousPage:null},i={},a={},u={},l=["page","block","childBlock","blocksTreeView","blocksMapView","blocksTimelineView","manageBlockView"];return s.host="",s.models={},s.subscriptions={},s.session=s.session_unknown,s.url=function(t){return void 0!==t&&(t="string"==typeof t?e.url.url_to_o(t):t,e.ext.each(t,function(e,t){s.value(e,t,!1)}),s.publish("url")),"#"+l.reduce(function(e,t){return val=s.value(t),null!==val&&void 0!==val?e.put([t,s.value(t)].join("=")):e},[]).join(";")},s.register=function(e,t,r){s.models[e.name]||(s.models[e.name]={timestamp:0,cb:r,urlDef:t},!s.authorized()||i||i[e.name]||(i[e.name]=_forceModelUpdate.bindDelay(s,200,e)))},s.resetTimestamp=function(e){s.models[e]&&(s.models[e].timestamp=0)},s.login=function(t,r,n,o){var i=null;t&&r&&(i={username:t,password:r}),e.api.post(e.urls.url(e.urls.LOGIN),i,n,o,s.unauthorized)},s.logout=function(){e.api.post(e.urls.url(e.urls.LOGOUT)),s.session=s.session_unknown},s.changeCompany=function(t){s.session=s.session_unknown,e.models.reset(!1),e.api.post(e.urls.url(e.urls.LOGIN),{company_id:t})},s.forceModelUpdate=function(t){if(i[t.name]&&(clearTimeout(i[t.name]),i[t.name]=null),!a[t.name]&&s.authorized()){a[t.name]=!0;var r=s.models[t.name];r.timestamp=0;var o=e.urls.url(r.urlDef),u=n.bind(s,t);e.api.get(o,null,u)}},s.any=function(){return!0},s.known=function(){return o.session!=s.session_unknown},s.unknown=function(){return o.session==s.session_unknown},s.unauthorized=function(){return o.session==s.session_unknown||o.session==s.session_invalid},s.invalid=function(){return o.session==s.session_invalid},s.authorized=function(){return o.session==s.session_normal||o.session==s.session_payment},s.disconnected=function(){return o.session==s.session_disconnected},s.update=function(e){return t(e),r(e),s.publish.bindDelay(s,50,"session"),s.authorized()},s.value=function(e,t,r){if(void 0!==t&&o[e]!=t){var n=o[e],i=u[e],a=i?i(n||null,t):t;if("url"==e)throw"Please use State.url to change the url object directly.";o[e]=a,s.publish(e),l.indexOf(e)>-1&&(o.url=s.url(),r!==!1&&s.publish("url"))}return o[e]},s.clone=function(){return e.ext.mixin({},o)},s.getValueKey=function(t,r){var n=e.urls.s_to_o(s.value(t));return n[r]||null},s.setValueKey=function(t,r,n){var o=e.urls.s_to_o(s.value(t));null==n?delete o[r]:o[r]=n,s.value(t,e.urls.o_to_s(o))},s.subscribe=function(t,r){if(!e.ext.isFunc(r))throw"SB_LIGHT:State -- subscribing to an event with an invalid function.";e.ext.debug("subscribing to: ",t),s.subscriptions[t]=s.subscriptions[t]||[],s.subscriptions[t].push(r)},s.unsubscribe=function(e,t){var r=s.subscriptions[e].indexOf(t);r>-1&&s.subscriptions[e].splice(r,1)},s.publish=function(t){var r=s.subscriptions[t]||[],n=s.value(t),o=e.ext;r.forEach(function(e){t.indexOf("Zoom")>-1?(o.debug("Publish Zoom: ",t,n),e.bindDelay(null,0,n)):(o.debug("Publish: ",t,n),e.bindDelay(null,50,n))})},s.addTimestamps=function(t){e.ext.debug("Adding timestamp for ",Object.keys(s.models).join(","));for(var r in s.models)t[r+"_timestamp"]=s.models[r].timestamp},s}),define("api/queries",["../globals"],function(e){var t={};t.company=function(t){var r=e.models.raw("companies");return t=t||e.state.value("companyId"),r&&t&&r[t]||null},t.fullname=function(t){var r=e.models.raw("users");return r&&t&&r[t]?r[t].name:null},t.currentUser=function(){var t=e.models.raw("users");return t&&t[e.state.value("userId")]||null},t.user=function(t){var r=e.models.raw("users");return r[t]},t.companyMembership=function(){var e=t.currentUser();if(e.company_membership)return e.company_membership;var r=t.company();return e&&r&&e.companies[r.id]||null},t.userDate=function(r,n){var s=t.currentUser();return e.moment(r,n).format(s.date_format)};var r="YYYY/MM/DD";t.userToServerDate=function(n){var s=t.currentUser(),o=e.moment(n,s.date_format);return o.format(r)},t.authors=function(){var t=e.state.value("companyId");return e.models.rawArray("users").filter(function(e){var r=e.company_membership||e.companies&&e.companies[t]||null;return r&&r.active&&("Author"==r.role||"Administrator"==r.role)}).sort(e.ext.sortUsers)},t.focusArea=function(t){var r=e.models.raw("focus");return r&&r[t]?r[t].title:null},t.focusAreaDesc=function(t){var r=e.models.raw("focus");return r&&r[t]?r[t].description:null},t.levelColor=function(t){var r=e.models.raw("levels"),n=r&&r[t]?r[t].color:null;return n?e.ext.to_color(n):null},t.levelName=function(){var t=e.models.raw("levels");return t&&t[id]?t[id].title:null},t.levelPos=function(){var t=e.models.raw("levels");return t&&t[id]?t[id].title:null},t.currentNewsItem=function(){var t=e.state.value("news"),r=e.models.raw("news");return r&&t?r[t]:null};var n=/%(users|blocks)_(\d+)%/g;t.newsMessage=function(t){var r=n,s=e.models.raw("blocks"),o=e.models.raw("users");return t.msg.replace(r,function(e,t,r){return"blocks"==t?s[r]?s[r].title:"(unknown block)":"users"==t?o[r]?o[r].name:"(unknown user)":void 0})};var s=/%users_(\d+)%/g;t.newsUsers=function(e){var t=s,r=[],n=null;do n&&r.push(n[1]),n=t.exec(e.msg);while(n);return r};var o=/%blocks_(\d+)%/g;t.newsBlocks=function(e){var t=o,r=[],n=null;do n&&r.push(n[1]),n=t.exec(e.msg);while(n);return r},t.currentBlock=function(){return t.block(t.currentBlockId())},t.previousBlock=function(){return t.block(t.previousBlockId())},t.rootBlock=function(){var r=e.state.value("company");return r?t.block(r.root_block.id):null},t.currentBlockId=function(){var e=t.currentBlockPath();return e&&e.length?e.last():null},t.previousBlockId=function(){var e=t.previousBlockPath();return e&&e.length?e.last():null},t.currentBlockPath=function(r){return t.blockPath(e.state.value("block"),r)},t.currentBlockLevel=function(){return t.blockLevel(t.currentBlockPath())},t.previousBlockPath=function(r){var n=e.state.value("previousBlock")||e.state.value("company").root_block.id;return t.blockPath(n,r)},t.previousBlockLevel=function(){return t.blockLevel(t.previousBlockPath())},t.managedBlocks=function(){return e.models.rawArray("blocks").reduce(function(e,t){return t.is_manager?e.put(t):e},[])},t.parentPath=function(e,r){return e=t.blockPath(e),t.blockPath(e.slice(0,-1),r)},t.blockParentInfo=function(e){e=t.blockPath(e);var r=t.block(e);return r&&r.parents&&r.parents.length?r.parents.find("parent_id",e.last(1)).value:null},t.blockPath=function(e,r){e=i(e);var n=t.block(e);return n&&2>e.length&&n.parents.length>0&&(e=n.default_path),r?e.join("_"):e};var i=function(e){return"array"==typeof e?e:"number"==typeof e?[e+""]:"string"==typeof e?e.split("_"):e};t.blockId=function(e){return e=i(e),e&&e.length?e.last():null},t.block=function(r){var n=t.blockId(r),s=e.models.raw("blocks");return n&&s&&s[n]?s[n]:null},t.blockLevel=function(e){var r=t.blockParentInfo(e||t.currentBlockPath());return r?r.level:0},t.childrenPaths=function(e,r){e=t.blockPath(e);var n=t.block(e);return n?n.children.map(function(n){return t.blockPath(e.concat([n]),r)}):null},t.parentPaths=function(r,n){var s=t.block(r);return s.paths.reduce(function(t,r){var s=e.queries.parentPath(r,n);return s&&s.length?t.put(s):t},[])},t.siblingPaths=function(r,n){var s=t.block(r);return s.paths.reduce(function(t,s){var o=e.queries.childrenPaths(e.queries.parentPath(s),n);return o?(o=o.filter(function(t){return e.queries.blockPath(t,!0)!=e.queries.blockPath(r,!0)}),t.concat(o)):t},[])},t.arePathsEqual=function(e,r){return t.blockPath(e,!0)==t.blockPath(r,!0)},t.maxDate=function(){return e.ext.parseDate(t.rootBlock().end_date)},t.minDate=function(){return e.ext.parseDate(t.rootBlock().start_date)},t.dateRange=function(r){var n={minStart:e.moment(new Date(1980,1,1)),maxStart:e.moment(new Date(2038,12,31)),minEnd:e.moment(new Date(1980,1,1)),maxEnd:e.moment(new Date(2038,12,31))},s=t.block(r.default_parent),o=r.children.map(function(e){return t.block(e).start_date}).put(s?s.end_date:n.maxStart),i=r.children.map(function(e){return t.block(e).end_date}).put(s?s.start_date:n.minEnd);return n.maxStart=e.ext.minDate.apply(null,o),n.minStart=s?s.start_date:n.minStart,n.maxEnd=s&&!s.floating_end_date?s.end_date:n.maxEnd,n.minEnd=e.ext.maxDate.apply(null,i),n},t.is_link=function(e,t){return null!=a(e,t).linked_parent_id},t.custom_progress_weight=function(t,r){return e.ext.to_i(a(t,r).custom_progress_weight)};var a=function(t,r){var n=e.models.raw("blocks"),s=n[t],o=n[r];if(-1==s.children.indexOf(r))throw Error("Block("+r+") is not a parent of block("+t+")");return o.parents.reduce(function(e,r){return r.parent_id==t?e.put(r):e},[])[0]};return t.progressVariance=function(e){var r=t.block(e);if(r){var n=r.percent_progress||100,s=r.expected_progress||0;return s>0?Math.round(100*((n-s)/s)):100}return 0},t.blockFullTree=function(r,n,s){if(s=s||e.models.raw("blocks")){r=t.blockPath(r||t.rootBlock().default_path),n=n||[];var o=s[r.last()],i={name:o.title,data:o,path:r,children:[]},a=o.children.cloneExcept(n.last());a.map(function(e){return r.concat([e])});var u=r.last(1);u&&n.last()!=u&&a.unshift(r.slice(0,-1));var l=1;return a.forEach(function(e){var n=t.blockFullTree(e,r,s);l+=n.size,i.children.put(n)}),i.size=l,i}},t.buildStrategyTree=function(r){var n=t.currentBlockPath(),s=t.currentBlock(),o=e.models.raw("blocks");if(!n||!s||!o)return null;var i=n.reduce(function(e,t){var r=e.last()||[];return e.put(r.concat([t])),e},[]),a=-(i.length-1);if(s.children.length){var u=s.children.indexOf(r),l=s.children[0>u?0:u];i.push(i.last().concat([l]))}var c={},d=c;return i.forEach(function(t){var r=e.ext.slice(t,0,-1),n=r.last(),s=t.last(),i=n?o[n].children:[s],u=i.indexOf(s);d.children=i.map(function(t,n){var s=r.concat([t]).join("_"),i=e.state.value(e.consts.STATE.BLOCKS_TREE_VIEW),l=e.state.getValueKey(e.consts.STATE.BLOCK_SETTINGS_VIEW,s);return{path:s,dy:a,dx:n-u,data:o[t],viewType:l||i}}),a+=1,d=d.children[u]}),c.children[0]},t}),define("api/urls",["../globals"],function(e){var t={},r={MODEL_BLOCKS:{url:"/blocks.js",post:!1},MODEL_COMPANIES:{url:"/companies.js",post:!1},MODEL_CAPABILITIES:{url:"/company_settings.js",post:!1},MODEL_EXPORTS:{url:"/exports.js",post:!1},MODEL_FOCUS:{url:"/focus.js",post:!1},MODEL_GROUPS:{url:"/groups.js",post:!1},MODEL_KPIS:{url:"/kpis.js",post:!1},MODEL_RISKS:{url:"/risks.js",post:!1},MODEL_LEVELS:{url:"/levels.js",post:!1},MODEL_NEWS:{url:"/news.js",post:!1},MODEL_LICENSES:{url:"/licenses.js",post:!1},MODEL_PROGRESS:{url:"/blocks/progress.js",post:!1},MODEL_HEALTH:{url:"/health_calculations.js",post:!1},MODEL_NPV:{url:"/blocks/npv.js",post:!1},MODEL_RISK:{url:"/blocks/risk.js",post:!1},MODEL_USERS:{url:"/users.js",post:!1},MODEL_TAGS:{url:"/tags.js",post:!1},MODEL_TIMEZONES:{url:"/companies/timezones.js",post:!1},MODEL_DASHBOARD:{url:"/reports/dashboard_layout.js",post:!1},BLOCKS_CONTEXT:{url:"/blocks/context/%id%.js"},BLOCKS_CLOSE:{url:"/blocks/close/%id%.js",deleteId:!0},BLOCKS_MANAGE_CHILDREN:{url:"/blocks/manage_children/%id%.js",deleteId:!0},BLOCKS_DELETE:{url:"/blocks/%type%/%id%.js",normalParams:!0},BLOCKS_DOCUMENTS:{url:"/blocks/documents/%id%.js"},BLOCKS_IMPORT:{url:"/blocks/import/%id%.js"},BLOCKS_INVITE:{url:"/blocks/invite/%id%.js"},BLOCKS_MAKE_PUBLIC:{url:"/blocks/make_public/%id%.js",normalParams:!0},BLOCKS_MOVE:{url:"/blocks/move/%id%.js",normalParams:!0},BLOCKS_PROPERTIES:{url:"/blocks/%type%/%id%.js"},BLOCKS_RELOCATE:{url:"/blocks/reassign_parent/%id%.js",normalParams:!0},BLOCKS_UPDATE:{url:"/blocks/update/%id%.js",massageParamsFunc:"massageParamsForBlockUpdate"},BLOCKS_UNWATCH:{url:"/blocks/unwatch/%id%.js"},BLOCKS_WATCHING_USERS:{url:"/blocks/watching_users/%id%.js"},BLOCKS_TAGGED:{url:"/blocks_for_tag/%name%.js"},BLOCKS_UPDATE_GROUPS:{url:"/blocks/update_group_expression/%id%.js",normalParams:!0},BLOCKS_CHANGE_CHARTED_KPI:{url:"/blocks/set_default_kpi/%id%.js"},BLOCKS_UPDATE_CASHFLOWS:{url:"/blocks/update_net_cashflows/%id%.js"},BLOCKS_HEALTH:{url:"/blocks/health.js",normalParams:!0},BLOCKS_PROGRESS:{url:"/blocks/progress.js",normalParams:!0},BLOCK_FILES_UPLOAD_URL:{url:"/blocks/%id%/documents/create.js"},BLOCK_FILES_DOWNLOAD_URL:{url:"/blocks/%id%/documents/show/%doc_id%.js"},BLOCK_FILES_DELETE:{url:"/blocks/%id%/documents/destroy/%doc_id%.js"},BOOKMARKS:{url:"/saved_client_states/index.js"},BOOKMARK_CREATE_DYNAMIC:{url:"/saved_client_states/create_dynamic.js"},BOOKMARK_SAVE_DYNAMIC:{url:"/saved_client_states/%id%/save_dynamic.js",normalParams:!0},BOOKMARK_CREATE:{url:"/saved_client_states/create.js",normalParams:!0},BOOKMARK_UPDATE:{url:"/saved_client_states/%id%/update.js",normalParams:!0},BOOKMARK_DELETE:{url:"/saved_client_states/%id%/delete.js"},COMMENT_PROPERTIES_ADD:{url:"/blocks/%id%/comment.js",normalParams:!0,deleteId:!0},COMPANIES_CREATE:{url:"/companies/create.js"},COMPANIES_UPDATE:{url:"/companies/update.js"},COMPANIES_HEALTH:{url:"/health_calculations.js"},COMPANIES_HEALTH_CREATE:{url:"/health_calculations/create.js"},COMPANIES_HEALTH_UPDATE:{url:"/health_calculations/%id%/update.js"},COMPANIES_HEALTH_DELETE:{url:"/health_calculations/%id%/destroy.js"},COMPANIES_HEALTH_DEFAULT:{url:"/health_calculations/%id%/set_default.js"},COMPANIES_LOGO_PREVIEW_URL:{url:"/upload/company_logo_preview.js"},COMPANIES_REMOVE_PREVIEW_LOGO:{url:"/upload/remove_company_logo_preview.js"},CAPABILITIES_UPDATE:{url:"/company_settings/update.js"},EXPORTS_CREATE:{url:"/exports/%id%/create.js"},EXPORTS_REPORT:{url:"/exports/%id%/create.js"},EXPORTS_DELETE:{url:"/exports/%id%/destroy.js"},FOCUS_CREATE:{url:"/focus/create.js"},FOCUS_UPDATE:{url:"/focus/update/%id%.js",deleteId:!0},FOCUS_DELETE:{url:"/focus/destroy/%id%.js",deleteId:!0},FOCUS_REPARENT:{url:"/focus/reparent/%id%.js"},GROUPS_CREATE:{url:"/groups/create.js"},GROUPS_DELETE:{url:"/groups/%id%/destroy.js",deleteId:!0},GROUPS_UPDATE:{url:"/groups/%id%/update.js",deleteId:!0},GROUPS_ADD:{url:"/groups/%id%/add.js"},GROUPS_REMOVE:{url:"/groups/%id%/remove.js"},RISKS_CREATE:{url:"/risks/create.js"},RISKS_DESTROY:{url:"/risks/%id%/destroy.js"},RISKS_UPDATE:{url:"/risks/%id%/update.js"},RISKS_UPDATE_STATUS:{url:"/risks/%id%/update_status.js"},RISKS_ADD_IMPACT:{url:"/risks/%id%/add_impact.js"},RISKS_REMOVE_IMPACT:{url:"/risks/%id%/remove_impact.js"},RISKS_ATTACH_DOC:{url:"/risks/%id%/attach_document.js"},RISKS_SHOW_DOC:{url:"/risks/%id%/show_document/%doc_id%.js"},RISKS_DESTROY_DOC:{url:"/risks/%id%/destroy_document.js"},RISKS_DUMMY_REFRESH:{url:"/risks/%id%/refresh_risk.js"},RISKS_SETTINGS:{url:"/risk_profiles/update_risk_settings.js"},RISKS_MATRIX_SIZE:{url:"/risk_profiles/set_matrix_size.js"},RISKS_PROFILES_UPDATE:{url:"/risk_profiles/update_batch.js"},KPIS_CREATE:{url:"/kpis/create.js"},KPIS_DESTROY:{url:"/kpis/%id%/destroy.js"},KPIS_UPDATE:{url:"/kpis/%id%/update.js"},KPIS_ATTACH_BLOCK:{url:"/kpis/%id%/attach.js"},KPIS_DETACH_BLOCK:{url:"/kpis/%id%/detach.js"},LEVELS_UPDATE:{url:"/levels/update.js"},MEASURES_BLOCKS:{url:"/blocks/measure_values/%id%.js"},USERS_CREATE:{url:"/users/create.js"},USERS_CREATE_BATCH:{url:"/users/create_batch.js"},USERS_ADD_GROUP:{url:"/users/%id%/add_group.js",normalParams:!0},USERS_REMOVE_GROUP:{url:"/users/%id%/remove_group.js",normalParams:!0},USERS_ACTIVATE:{url:"/users/%id%/activate.js"},USERS_DEACTIVATE:{url:"/users/%id%/deactivate.js"},USERS_UPDATE:{url:"/users/%id%/update.js",deleteId:!0},USERS_REMOVE_MEMBERSHIP:{url:"/users/%id%/delete_membership.js"},USERS_CHANGE_MEMBERSHIP:{url:"/users/%id%/update_membership.js",deleteId:!0},USERS_CHANGE_DEFAULT_COMPANY:{url:"/users/%id%/change_default_company.js",normalParams:!0},REGISTER_COMPANY:{url:"/registration/register_company.js"},LOGIN:{url:"/login/auth.js"},LOGOUT:{url:"/login/logout.js"},LOGIN_FORGOT_PASSWORD:{url:"/login/forgot_password.js",normalParams:!0},LOGIN_REMEMBER_ME:{url:"/login/remember_me.js"},URL_SAVE_BOOKMARK:{url:"/users/save_bookmark.js"},PAYMENTS:{url:"/purchases/index.js"},PAYMENTS_QUOTE:{url:"/purchases/quote.js"},PAYMENTS_CREATE:{url:"/purchases/create.js"},ADMIN_RAISE:{url:"/admin/log_client_error.js"}};r.url=function(t,r){if(!t||!t.url)throw Error("Url does not exist: "+t);r=r||{};var s=t.url;for(var o in r)s=s.replace(n(o),r[o]);if(s.indexOf("%")>-1)throw Error("Bad url."+s);return e.state.host+s};var n=function(e){return t[e]=t[e]||RegExp("%"+e+"%"),t[e]};return r.massageParamsForBlockUpdate=function(e){return delete e.id,e},r.s_to_o=function(e){var t={};return e.split("-").reduce(function(e,t){if(""!=t){var r=t.split("!");return e[r[0]]=r[1],e}},t),t},r.o_to_s=function(t){var r=[];return e.ext.each(t,function(e,t){r.put([e,t].join("!"))}),r.join("-")},r.url_to_o=function(t){var r="string"==typeof t?t.split(";"):t;return r=e.ext.isArray(r)?r:r.reduce(function(r,n){if(n="string"==typeof n?n.split("="):n,e.ext.isArray(n))r[n[0]]=n[1];else{if(!n.key)throw"URL Cannot be parsed: "+JSON.stringify(t);r[n.key]=n.value}return r},{})},r}),define("api/api",["../globals"],function(e){function t(t,s,o){if(e.ext.debug("Sending request to ",t,o,JSON.stringify(s)),!i.ajax)throw"Error: sb.api.ajax has not been inititalized. Please set this value to one of the functions available in sb.ajax";e.state.addTimestamps(s||{}),i.ajax({url:t,type:o?"POST":"GET",data:s,dataType:"json",context:i,success:r.bind(null,e.ext.slice(arguments)),error:n.bind(null,e.ext.slice(arguments))})}function r(t,r){e.ext.debug("SUCCESS: SB_Api",t,r),u=l;var n=e.state.authorized();if(e.state.update(r)){var s=e.ext.getResultMessages(r).errors;!s&&t[3]&&(t[3](r),o()),s&&t[4]&&(t[4](r),o())}else n&&(c.length=0),t[4]&&t[4](r)}function n(t,r){e.ext.debug("FAILURE SB_Api",JSON.stringify(r)),e.state.value("session",e.state.session_disconnected)}function s(t){var r=t.url+(JSON.stringify(t.params)||"");e.ext.debug("Pushing request on the queue: ",r),0==c.filter(function(e){return e.key==r}).length&&c.push({key:r,data:t})}function o(){if(a)e.ext.debug("Running Error Request"),t.apply(this,this._errorData);else if(c.length>0){var r=c.shift().data;r.state()?t.call(null,r.url,r.params,r.post,r.success,r.failure):(r.count+=1,this._maxRetries>r.count&&s.bindDelay(null,_retryDelay,r),o())}}var i={},a=null,u=50,l=50,c=[];return i.get=function(e,t,r,n,s){i.request(e,t,!1,r,n,s)},i.post=function(e,t,r,n,s){i.request(e,t,!0,r,n,s)},i.request=function(r,n,s,o,i,a){var u=a||e.state.authorized;u.call(e.state)&&t(r,n,s,o,i)},i}),define("api/ajax",["../globals"],function(e){var t={};return t.jquery=function(t){return function(r){r.url=r.url.replace(/^(https?:\/\/)?.+?\//,"/"),e.ext.debug("jquery",r.type,r.url),t.ajax({type:r.type,url:r.url,data:r.data,dataType:r.dataType}).done(r.success).fail(r.error)}},t.node=function(t){return function(r){e.ext.debug("Request Agent: ",t);var n="POST"==r.type?t.post(r.url).send(r.data):t.get(r.url).query(r.data);n.set("Accept","application/json").end(function(t){t.ok?(e.ext.debug("Sweet!",t.text),r.success&&r.success(JSON.parse(t.text))):(e.ext.debug("Dam",t.text),r.error&&r.error(t.text))})}},t.titanium=function(){return function(t){if(e.ext.ti()){var r=e.ext.merge({type:"GET",url:null,data:!1,contentType:"application/json",async:!0,autoEncodeUrl:!0,success:null,error:null,beforeSend:null,complete:null},t),n=Ti.Network.createHTTPClient({autoEncodeUrl:r.autoEncodeUrl,async:r.async});if("GET"==r.type&&r.data){var s=[];for(var o in r.data)s.put(o+"="+encodeURIComponent(r.data[o]));r.url+="?"+s.join("&"),delete r.data}return n.open(r.type,r.url),n.setRequestHeader("Content-Type",r.contentType),r.beforeSend&&r.beforeSend(n),n.setTimeout(1e4),n.onerror=function(){return null!==r.error?r.error(this):void 0},n.onload=function(){if(400>this.status)try{if(null!==r.success){var e=JSON.parse(this.responseText);return r.success(e)}}catch(t){return Ti.API.error("XHR success function threw Exception: "+t+""),void 0}else if(null!==r.error)return r.error(this)},r.data?(n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(r.data)):n.send(),null!==r.complete?r.complete(this):void 0}}},t}),define("sb_light",["./globals","moment","./utils/ext","./utils/svg","./utils/consts","./utils/Class","./models","./controller","./api/state","./api/queries","./api/urls","./api/api","./api/ajax"],function(e,t,r,n,s,o,i,a,u,l,c,d,h){return e.debug=!0,e.moment=t,e.ext=r,e.svg=n,e.consts=s,e.models=i,e.controller=a,e.state=u,e.queries=l,e.urls=c,e.api=d,e.ajax=h,e.Class=o,u.host="https://app.strategyblocks.com",e.ext.debug("Loaded SB: ",e.state.host),e});