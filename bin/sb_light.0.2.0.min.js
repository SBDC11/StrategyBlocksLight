/**
 * @version 0.2.0
 * 
 */

// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

define("sb_light/globals",["require"],function(){var t={version:(new Date).getTime()},e=function(){return t};return e()}),function(t){function e(t,e){return function(n){return u(t.call(this,n),e)}}function n(t){return function(e){return this.lang().ordinal(t.call(this,e))}}function r(){}function s(t){a(this,t)}function i(t){var e=this._data={},n=t.years||t.year||t.y||0,r=t.months||t.month||t.M||0,s=t.weeks||t.week||t.w||0,i=t.days||t.day||t.d||0,a=t.hours||t.hour||t.h||0,u=t.minutes||t.minute||t.m||0,l=t.seconds||t.second||t.s||0,c=t.milliseconds||t.millisecond||t.ms||0;this._milliseconds=c+1e3*l+6e4*u+36e5*a,this._days=i+7*s,this._months=r+12*n,e.milliseconds=c%1e3,l+=o(c/1e3),e.seconds=l%60,u+=o(l/60),e.minutes=u%60,a+=o(u/60),e.hours=a%24,i+=o(a/24),i+=7*s,e.days=i%30,r+=o(i/30),e.months=r%12,n+=o(r/12),e.years=n}function a(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function o(t){return 0>t?Math.ceil(t):Math.floor(t)}function u(t,e){for(var n=t+"";n.length<e;)n="0"+n;return n}function l(t,e,n){var r,s=e._milliseconds,i=e._days,a=e._months;s&&t._d.setTime(+t+s*n),i&&t.date(t.date()+i*n),a&&(r=t.date(),t.date(1).month(t.month()+a*n).date(Math.min(r,t.daysInMonth())))}function c(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t,e){var n,r=Math.min(t.length,e.length),s=Math.abs(t.length-e.length),i=0;for(n=0;r>n;n++)~~t[n]!==~~e[n]&&i++;return i+s}function h(t,e){return e.abbr=t,I[t]||(I[t]=new r),I[t].set(e),I[t]}function f(t){return t?(!I[t]&&N&&require("./lang/"+t),I[t]):P.fn._lang}function _(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function p(t){var e,n,r=t.match(F);for(e=0,n=r.length;n>e;e++)r[e]=ie[r[e]]?ie[r[e]]:_(r[e]);return function(s){var i="";for(e=0;n>e;e++)i+="function"==typeof r[e].call?r[e].call(s,t):r[e];return i}}function m(t,e){function n(e){return t.lang().longDateFormat(e)||e}for(var r=5;r--&&Y.test(e);)e=e.replace(Y,n);return ne[e]||(ne[e]=p(e)),ne[e](t)}function g(t){switch(t){case"DDDD":return q;case"YYYY":return H;case"YYYYY":return z;case"S":case"SS":case"SSS":case"DDD":return K;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return G;case"X":return J;case"Z":case"ZZ":return W;case"T":return V;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return U;default:return new RegExp(t.replace("\\",""))}}function b(t,e,n){var r,s=n._a;switch(t){case"M":case"MM":s[1]=null==e?0:~~e-1;break;case"MMM":case"MMMM":r=f(n._l).monthsParse(e),null!=r?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=e&&(s[2]=~~e);break;case"YY":s[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~e;break;case"a":case"A":n._isPm="pm"===(e+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":s[3]=~~e;break;case"m":case"mm":s[4]=~~e;break;case"s":case"ss":s[5]=~~e;break;case"S":case"SS":case"SSS":s[6]=~~(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,r=(e+"").match($),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&"+"===r[0]&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}null==e&&(n._isValid=!1)}function y(t){var e,n,r=[];if(!t._d){for(e=0;7>e;e++)t._a[e]=r[e]=null==t._a[e]?2===e?1:0:t._a[e];r[3]+=t._tzh||0,r[4]+=t._tzm||0,n=new Date(0),t._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),t._d=n}}function v(t){var e,n,r=t._f.match(F),s=t._i;for(t._a=[],e=0;e<r.length;e++)n=(g(r[e]).exec(s)||[])[0],n&&(s=s.slice(s.indexOf(n)+n.length)),ie[r[e]]&&b(r[e],n,t);t._isPm&&t._a[3]<12&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),y(t)}function w(t){var e,n,r,i,o,u=99;for(i=t._f.length;i>0;i--){if(e=a({},t),e._f=t._f[i-1],v(e),n=new s(e),n.isValid()){r=n;break}o=d(e._a,n.toArray()),u>o&&(u=o,r=n)}a(t,r)}function x(t){var e,n=t._i;if(Z.exec(n)){for(t._f="YYYY-MM-DDT",e=0;4>e;e++)if(Q[e][1].exec(n)){t._f+=Q[e][0];break}W.exec(n)&&(t._f+=" Z"),v(t)}else t._d=new Date(n)}function k(e){var n=e._i,r=R.exec(n);n===t?e._d=new Date:r?e._d=new Date(+r[1]):"string"==typeof n?x(e):c(n)?(e._a=n.slice(0),y(e)):e._d=n instanceof Date?new Date(+n):new Date(n)}function D(t,e,n,r,s){return s.relativeTime(e||1,!!n,t,r)}function E(t,e,n){var r=C(Math.abs(t)/1e3),s=C(r/60),i=C(s/60),a=C(i/24),o=C(a/365),u=45>r&&["s",r]||1===s&&["m"]||45>s&&["mm",s]||1===i&&["h"]||22>i&&["hh",i]||1===a&&["d"]||25>=a&&["dd",a]||45>=a&&["M"]||345>a&&["MM",C(a/30)]||1===o&&["y"]||["yy",o];return u[2]=e,u[3]=t>0,u[4]=n,D.apply({},u)}function S(t,e,n){var r=n-e,s=n-t.day();return s>r&&(s-=7),r-7>s&&(s+=7),Math.ceil(P(t).add("d",s).dayOfYear()/7)}function M(t){var e=t._i,n=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=f().preparse(e)),P.isMoment(e)?(t=a({},e),t._d=new Date(+e._d)):n?c(n)?w(t):v(t):k(t),new s(t))}function O(t,e){P.fn[t]=P.fn[t+"s"]=function(t){var n=this._isUTC?"UTC":"";return null!=t?(this._d["set"+n+e](t),this):this._d["get"+n+e]()}}function T(t){P.duration.fn[t]=function(){return this._data[t]}}function A(t,e){P.duration.fn["as"+t]=function(){return+this/e}}for(var P,L,j="2.0.0",C=Math.round,I={},N="undefined"!=typeof module&&module.exports,R=/^\/?Date\((\-?\d+)/i,B=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,F=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,Y=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,U=/\d\d?/,K=/\d{1,3}/,q=/\d{3}/,H=/\d{1,4}/,z=/[+\-]?\d{1,6}/,G=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,W=/Z|[\+\-]\d\d:?\d\d/i,V=/T/i,J=/[\+\-]?\d+(\.\d{1,3})?/,Z=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,X="YYYY-MM-DDTHH:mm:ssZ",Q=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],$=/([\+\-]|\d\d)/gi,te="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ee={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ne={},re="DDD w W M D d".split(" "),se="M D H h m s w W".split(" "),ie={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return u(this.year()%100,2)},YYYY:function(){return u(this.year(),4)},YYYYY:function(){return u(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return u(~~(this.milliseconds()/10),2)},SSS:function(){return u(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(~~(t/60),2)+":"+u(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+u(~~(10*t/6),4)},X:function(){return this.unix()}};re.length;)L=re.pop(),ie[L+"o"]=n(ie[L]);for(;se.length;)L=se.pop(),ie[L+L]=e(ie[L],2);for(ie.DDDD=e(ie.DDD,3),r.prototype={set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,r;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=P([2e3,e]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(r.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,r;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=P([2e3,1]).day(e),r="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,r){var s=this._relativeTime[n];return"function"==typeof s?s(t,e,n,r):s.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return S(t,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},P=function(t,e,n){return M({_i:t,_f:e,_l:n,_isUTC:!1})},P.utc=function(t,e,n){return M({_useUTC:!0,_isUTC:!0,_l:n,_i:t,_f:e})},P.unix=function(t){return P(1e3*t)},P.duration=function(t,e){var n,r,s=P.isDuration(t),a="number"==typeof t,o=s?t._data:a?{}:t,u=B.exec(t);return a?e?o[e]=t:o.milliseconds=t:u&&(n="-"===u[1]?-1:1,o={y:0,d:~~u[2]*n,h:~~u[3]*n,m:~~u[4]*n,s:~~u[5]*n,ms:~~u[6]*n}),r=new i(o),s&&t.hasOwnProperty("_lang")&&(r._lang=t._lang),r},P.version=j,P.defaultFormat=X,P.lang=function(t,e){return t?(e?h(t,e):I[t]||f(t),P.duration.fn._lang=P.fn._lang=f(t),void 0):P.fn._lang._abbr},P.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),f(t)},P.isMoment=function(t){return t instanceof s},P.isDuration=function(t){return t instanceof i},P.fn=s.prototype={clone:function(){return P(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return P(this).utc().format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!d(this._a,(this._isUTC?P.utc(this._a):P(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(t){var e=m(this,t||P.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t?P.duration(+e,t):P.duration(t,e),l(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t?P.duration(+e,t):P.duration(t,e),l(this,n,-1),this},diff:function(t,e,n){var r,s,i=this._isUTC?P(t).utc():P(t).local(),a=6e4*(this.zone()-i.zone());return e&&(e=e.replace(/s$/,"")),"year"===e||"month"===e?(r=432e5*(this.daysInMonth()+i.daysInMonth()),s=12*(this.year()-i.year())+(this.month()-i.month()),s+=(this-P(this).startOf("month")-(i-P(i).startOf("month")))/r,"year"===e&&(s/=12)):(r=this-i-a,s="second"===e?r/1e3:"minute"===e?r/6e4:"hour"===e?r/36e5:"day"===e?r/864e5:"week"===e?r/6048e5:r),n?s:o(s)},from:function(t,e){return P.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(P(),t)},calendar:function(){var t=this.diff(P().startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return 0===t%4&&0!==t%100||0===t%400},isDST:function(){return this.zone()<P([this.year()]).zone()||this.zone()<P([this.year(),5]).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(this._d["set"+e+"Month"](t),this):this._d["get"+e+"Month"]()},startOf:function(t){switch(t=t.replace(/(.)s$/,"$1")){case"year":case"y":this.month(0);case"month":case"M":this.date(1);case"week":case"w":case"day":case"d":this.hours(0);case"hour":case"h":this.minutes(0);case"minute":case"m":this.seconds(0);case"second":case"s":this.milliseconds(0)}return("week"===t||"w"===t)&&this.day(0),this},endOf:function(t){return this.startOf(t).add(t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+P(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+P(t).startOf(e)},isSame:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)===+P(t).startOf(e)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return P.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=C((P(this).startOf("day")-P(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},isoWeek:function(t){var e=S(this,1,4);return null==t?e:this.add("d",7*(t-e))},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},lang:function(e){return e===t?this._lang:(this._lang=f(e),this)}},L=0;L<te.length;L++)O(te[L].toLowerCase().replace(/s$/,""),te[L]);O("year","FullYear"),P.fn.days=P.fn.day,P.fn.months=P.fn.month,P.fn.weeks=P.fn.week,P.fn.isoWeeks=P.fn.isoWeek,P.duration.fn=i.prototype={weeks:function(){return o(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,n=E(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},get:function(t){return this[t.toLowerCase()]()},as:function(t){var e=t.toLowerCase();return this["as"+e.charAt(0).toUpperCase()+e.slice(1)]()},lang:P.fn.lang};for(L in ee)ee.hasOwnProperty(L)&&(A(L,ee[L]),T(L.toLowerCase()));A("Weeks",6048e5),P.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},P.lang("en",{ordinal:function(t){var e=t%10,n=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),N&&(module.exports=P),"undefined"==typeof ender&&(this.moment=P),"function"==typeof define&&define.amd&&define("sb_light/lib/moment",[],function(){return P})}.call(this),define("sb_light/utils/ext",["sb_light/globals"],function(t){var e={};return e.pi=Math.PI,e.rad0=0,e.rad90=e.pi/2,e.rad180=e.pi,e.rad270=e.rad180+e.rad90,e._unique=0,e.unique=function(){return++e._unique},e.noop=function(){},e.global=function(t){return"undefined"!=typeof window?void 0!==window[t]:"undefined"!=typeof Ti?Ti[t]:"undefined"!=typeof window&&void 0!==window[t]},e.deprecated=function(t,e,n){console.log("Warning: ",t," is deprecated. Please use ",e," instead."),n&&console.log("Warning(2): ",n)},e.slice=function(t,e,n){return e=isNaN(e)?0:e,isNaN(n)?Array.prototype.slice.call(t,e):Array.prototype.slice.call(t,e,n)},e.debug=function(){if(t.debug){var n=[(new Date).toTimeString()].concat(e.slice(arguments)).join(" ");e.global("API")?Ti.API.debug(n):e.global("console")&&console.log(n)}},e.warn=function(){var t=[(new Date).toTimeString(),"WARNING:"].concat(e.slice(arguments)).join(" ");e.global("Ti")?Ti.API.warn(t):e.global("console")&&console.log(t)},e.warning=e.warn,e.map=function(t,n,r){var s,i,a,o=[];if(e.isArray(t))for(s=0,i=t.length;i>s;++s)o.push(n.call(r||this,t[s],s,t));else for(a in t)o.push(n.call(r||this,t[a],a,t));return o},e.each=function(t,n,r){var s;if(e.isArray(t))t.forEach(n,r);else for(s in t)n.call(r||t,t[s],s,t)},e.reduce=function(t,n,r,s){if(e.isArray(t))return t.reduce(n,r);for(var i in t)r=n.call(s||t,r,t[i],i,t);return r},e.set=function(t,e,n){return t[e]=n,t},e.length=function(t){var n=0;return e.isArray(t)?n=t.length:t&&(n=Object.keys(t).length),n},e.toObject=function(t,e){return t.reduce(function(t,n){return t[n[e]]=n,t},{})},e.values=function(t,n){return e.map(t,function(t){return n?t[n]:t})},e.keys=function(t){return t?Object.keys(t):[]},e.firstKey=function(t){if(!t)return null;var e;for(e in t)return e},e.deepClone=function(t){return JSON.parse(JSON.stringify(t))},e.valid=function(t,n){switch(n||"object"){case"object":return null!==t&&void 0!==t;case"arr":case"array":return e.isArr(t);case"func":case"function":return e.isFunc(t);case"str":case"string":return e.isStr(t)&&""!==t;case"num":case"number":return e.isNum(t)&&!isNaN(t)}},e.isArr=function(t){return"[object Array]"==Object.prototype.toString.call(t)},e.isArray=e.isArr,e.isFunc=function(t){return"[object Function]"==Object.prototype.toString.call(t)},e.isFunction=e.isFunc,e.isStr=function(t){return"[object String]"==Object.prototype.toString.call(t)},e.isString=e.isStr,e.isBool=function(t){return"[object Boolean]"==Object.prototype.toString.call(t)},e.isBoolean=e.isBool,e.isNum=function(t){return"[object Number]"==Object.prototype.toString.call(t)},e.isNumber=e.isNum,e.isDate=function(t){return"[object Date]"==Object.prototype.toString.call(t)},e._getClass={}.toString,e.caps=function(t){return t=e.isArray(t)?t:[t],t.reduce(function(t,e){return e?(t?t+" ":"")+e.charAt(0).toUpperCase()+e.slice(1):t},null)},e.capitalize=e.caps,e.replace=function(t,n){var r=t;return e.each(n,function(t,e){var n=new RegExp("%"+e.toUpperCase()+"%");r=r.replace(n,t)}),r},e.time=function(){return Date.now?function(){return Date.now()}:function(){return(new Date).getTime()}}(),e.parseDate=function(){e.deprecated("ext.parseDate","ext.moment")},e.moment=function(e){return t.moment(e)},e.dateNumber=function(t){return e.moment(t).valueOf()},e.date=function(t){return e.moment(t).toDate()},e.daysDiff=function(t,n){return e.moment(t).diff(e.moment(n),"days")},e.today=function(){return new Date},e.minDate=function(){return e.moment(e.slice(arguments).sort(e.sortDate)[0])},e.maxDate=function(){return e.moment(e.slice(arguments).sort(e.sortDate).last())},e.serverFormat="YYYY/MM/DD",e.userFormat=function(){var n=t.queries.user();return n?n.date_format:e.serverFormat},e.serverDate=function(n){return t.moment(n||new Date).format(e.serverFormat)},e.userDate=function(n){return t.moment(n||new Date).format(e.userFormat())},e.dateFromNow=function(n,r,s){return s?"("+t.moment(n).fromNow()+")&nbsp;"+t.moment(n).format(r||e.userFormat()):t.moment(n).format(r||e.userFormat())+"&nbsp;("+t.moment(n).fromNow()+")"},e.fromNow=function(e){return t.moment(e).fromNow()},e.regEmail=new RegExp("([\\w-\\.]+)@((?:[\\w]+\\.)+)([a-zA-Z]{2,4})"),e.regUrl=new RegExp("^https?://"),e.sortFactory=function(t,e,n){return function(r,s){var i=r?r[t]:null,a=s?s[t]:null;return e(i,a)*(n?-1:1)}},e.sortTime=function(t,n){return e.sortNumbers(e.parseDate(t).getTime(),e.parseDate(n).getTime())},e.sortNumber=function(t,e){return t-e},e.sortNumbers=e.sortNumber,e.sortDay=function(t,n){return e.daysDiff(t,n)},e.sortDays=e.sortDay,e.sortDate=function(t,n){return e.sortNumber(e.dateNumber(t),e.dateNumber(n))},e.sortDates=e.sortDate,e.sortString=function(t,e){return String(t).localeCompare(String(e))},e.sortStrings=e.sortString,e.sortBool=function(t,n){return e.sortNumber(t?1:0,n?1:0)},e.sortBoolean=e.sortBool,e.sortDateValue=function(t,n){return e.sortDate(t.date,n.date)},e.sortUsers=function(t,n){return e.sortFactory("last_name",e.sortString)(t,n)},e.sortFocus=function(t,n){return e.sortFactory("title",e.sortString)(t,n)},e.sortName=function(t,n){return e.sortFactory("name",e.sortString)(t,n)},e.sortBlocksByProgress=function(t,n){var r=t.closed,s=n.closed;if(r&&!s)return 1;if(!r&&s)return-1;var i="new"==t.ownership_state,a="new"==n.ownership_state;if(i&&!a)return 1;if(!i&&a)return-1;if(i&&a||r&&s)return e.sortString(t.title,n.title);var o=t.expected_progress,u=n.expected_progress;return!o&&u?1:o&&!u?-1:o||u?e.sortNumbers(t.percent_progress/o,n.percent_progress/u):0},e.px=function(t){return[t,"px"].join("")},e.pc=function(t){return[t,"%"].join("")},e.roundTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.round(t*r)/r},e.floorTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.floor(t*r)/r},e.ceilTo=function(t,n){var r=Math.pow(10,e.number(n,0));return Math.ceil(t*r)/r},e.to_i=function(t,n,r){var s=parseInt(t,n||10);return isNaN(s)?e.number(r,0):s},e.to_f=function(t,n){var r=parseFloat(t);return isNaN(r)?e.number(n,0):r},e.rand=function(t,n,r){return e.floorTo(Math.random()*(n-t+1),r)+t},e.to_color=function(t){return"#"+("00000"+(0|t).toString(16)).substr(-6)},e.number=function(t,n){return t=e.isFunc(t)?t():t,t=e.isArr(t)&&e.isFunc(t[0])?t[0].apply(null,t.slice(1)):t,isNaN(t)?n||0:t},e.max=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.NEGATIVE_INFINITY)}),n=t.reduce(function(t,e){return t>e?t:e},Number.NEGATIVE_INFINITY);return n},e.min=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.POSITIVE_INFINITY)}),n=t.reduce(function(t,e){return e>t?t:e},Number.POSITIVE_INFINITY);return n},e.first=function(){var t,n=e.slice(arguments);for(t=0;t<n.length;++t)if(!isNaN(n[t]))return n[t];return 0/0},e.range=function(t,n,r){return e.max(t,e.min(n,r))},e.snapto=function(t,e){var n,r=Math.abs(t[0]-e),s=t[0];for(n=1;n<t.length;++n)Math.abs(t[n]-e)<r&&(r=Math.abs(t[n]-e),s=t[n]);return s},e.sum=function(){var t=e.slice(arguments).map(function(t){return e.number(t)}),n=t.reduce(function(t,n){return t+e.number(n)},0);return n},e.diff=function(){var t=e.number(arguments[0]),n=e.slice(arguments,1).map(function(t){return e.number(t)}),r=n.reduce(function(t,n){return t-e.number(n)},t);return r},e.prod=function(){var t=e.slice(arguments).map(function(t){return e.number(t,1)}),n=t.reduce(function(t,n){return t*e.number(n)},1);return n},e.compareInt=function(t,n,r){return r=e.number(r,0),Math.abs(t-n)<=r},e.absDiff=function(t,e){return Math.abs(t-e)},e.healthColor=function(t){return["#D80000","#EACF00","#0FAD00"][t.status+1]},e.healthText=function(t){return["Bad","Warning","Good"][t.status+1]},e.blockProgressFill=function(t){switch(t.progress_color||t){case"green":return["#176717","url(#progressGood)","url(#progressHatchGood)",["#67b41f","#508121"]];case"yellow":return["#77771B","url(#progressWarning)","url(#progressHatchWarning)",["#d3a900","#95780d"]];case"red":return["#641717","url(#progressBad)","url(#progressHatchBad)",["#b41f27","#812127"]];default:return["#999","url(#progressNone)","url(#progressHatchNone)"]}},e.getResultMessages=function(t){var n={errors:null,warnings:null,notices:null};return t&&(e.isArray(t.result)?t.result.forEach(function(e){e&&e.errors&&(n.errors={form:t.result.errors,message:JSON.stringify(t.result)})}):t.result&&t.result.errors&&(n.errors={form:t.result.errors,message:JSON.stringify(t.result)}),!n.errors&&t.flash&&t.flash.error&&(n.errors={message:t.flash.error}),!n.errors&&t.errors&&t.errors.error&&(n.errors={message:t.errors.error})),n.notices=t.flash?t.flash.notice:"",n.warnings=t.flash?t.flash.warning:"",n},e.massageTA=function(t){var n=[e.today()];t.values=t.values&&t.values.length?t.values:[{date:n[0],value:0,comment:"(today, interpolated)",interpolated:!0}],t.target=t.target&&t.target.length?t.target:[{date:n[0],value:0,comment:"(today, interpolated)",interpolated:!0}],t.values.forEach(function(t){t.date=e.date(t.date),n[n.length]=t.date}),t.values.sort(e.sortDateValue),e.daysDiff(t.values[0].date,n[0])>0?t.values.push({date:n[0],value:t.values[0].value,comment:"(today, interpolated)",interpolated:!0}):e.daysDiff(t.values.last().date,n[0])<0&&t.values.push({date:n[0],value:t.values.last().value,comment:"(today,interpolated)",interpolated:!0}),t.target.forEach(function(r){r.date=e.date(r.date),n[n.length]=r.date;var s=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_start:t.tolerance.range_end,i=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_end:t.tolerance.range_start;r.upper=r.value+(t.tolerance.percentage?r.value*s/100:s),r.lower=r.value+(t.tolerance.percentage?r.value*i/100:i)}),t.target.sort(e.sortDateValue),e.daysDiff(t.target[0],n[0])>0?t.target.push({date:n[0],value:t.target[0],comment:"(today, interpolated)",interpolated:!0}):e.daysDiff(t.target.last(),n[0])>0&&t.target.push({date:n[0],value:t.target.last(),comment:"(today,interpolated)",interpolated:!0}),t.dates=n.sort(e.sortDate);for(var r=t.values,s=t.target,i=0,a=0,o=Math.min(s.length-1,1);i<r.length;){var u=r[i],l=s[a],c=s[o];if(e.daysDiff(u.date,l.date)<=0)u.target=l.value,i++;else if(e.daysDiff(u.date,c.date)>0){if(o==s.length-1){u.target=c.value,i++;continue}a++,o++}else if(e.daysDiff(u.date,c.date)<=0){var d=e.dateNumber(l.date),h=e.dateNumber(c.date),f=e.dateNumber(u.date);u.target=l.value+(h-f)/(h-d)*(c.value-l.value),i++}}return t},e.massageKpi=function(t){t=e.massageTA(t);var n=t.values,r=t.target;Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,n.length&&r.length&&(e.daysDiff(t.dates[0],r[0].date)<0&&r.unshift({value:r[0].value,upper:r[0].upper,lower:r[0].lower,date:t.dates[0],comment:"(First value, interpolated)"}),e.daysDiff(t.dates.last(),r.last().date)>0&&r.push({value:r.last().value,upper:r.last().upper,lower:r.last().lower,date:t.dates.last(),comment:"(Last value, interpolated)"})),t.tolerance.percentage=t.tolerance.percentage||!1,t.tolerance.inverse=t.tolerance.inverse||!1;var s=t.tolerance.percentage,i=n[0].value,a=n[0].value;e.each(n,function(t){i=e.min(t.value,i),a=e.max(t.value,a),t.id=t.id||"actual_"+e.unique()});var o=r[0].value,u=r[0].value;e.each(r,function(t){o=e.min(t.value,o),u=e.max(t.value,u),t.id=t.id||"target_"+e.unique()});var l,c,d=e.max(t.tolerance.range_end,t.tolerance.range_start)/(s?100:1),h=e.min(t.tolerance.range_end,t.tolerance.range_start)/(s?100:1);s?(l=o+h*o,c=u+d*u):(l=o+h,c=u+d),l=e.min(l,o)-.02*e.absDiff(o,l),c=e.max(c,u)+.02*e.absDiff(u,c),t.minY=e.min(i,o,l),t.maxY=e.max(a,u,c);var f=.05*e.absDiff(t.maxY,t.minY)||10;return t.minY-=f,t.maxY+=f,t},e.massageHealth=function(t){var n=e.map(t.historical_values,function(t,n){return{date:e.date(n),value:t}});return t.series=n.sort(e.sortDateValue),t.dates=e.values(t.series,"date"),t.dates.push(Date.parse(t.end_date)),t},e.mixin=function(t,n,r){var s=r||{};t=t||{},n=n||{};var i,a;for(i in n){a=n[i];var o=e.isArray(s)?s.indexOf(i)>=0:s.hasOwnProperty(i);o||(t[i]=a)}return t},e.combine=function(t,n){t=e.isArray(t)?t.concat(e.slice(arguments,1)):e.slice(arguments);var r=t.reduce(function(t,r){var s=e.mixin(t,r,n);return s},{});return r},e.merge=function(t,n,r){return e.combine([t,n],r)},e.cherryPick=function(t,n){if(!n)return e.mixin(null,t);e.isStr(n)&&(n=n.split(","));var r={};return n.forEach(function(e){r[e]=t[e]}),r},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var n=0,r=this.length;r>n;++n)t.call(e||this,this[n],n,this)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var n=e.slice(arguments,1),r=this,s=function(){},i=function(){return r.apply(this instanceof s?this:t,n.concat(e.slice(arguments)))};return s.prototype=this.prototype,i.prototype=new s,i}),Function.prototype.bindDelay||(Function.prototype.bindDelay=function(t,n){var r=e.slice(arguments);r.splice(1,1);var s=this.bind.apply(this,r);return setTimeout(s,n)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var n=0,r=this.length;r>n;++n)t.call(e||this,this[n],n,this)}),Array.prototype.clone||(Array.prototype.clone=function(){return[].concat(this)}),Array.prototype.last||(Array.prototype.last=function(t){return t=this.length-1-(t||0),this.length>t&&t>=0?this[t]:null}),Array.prototype.reduce||(Array.prototype.reduce=function(t){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var e,n=0,r=this.length>>0;if("function"!=typeof t)throw new TypeError("First argument is not callable");if(arguments.length<2){if(0===r)throw new TypeError("Array length is 0 and no second argument");e=this[0],n=1}else e=arguments[1];for(;r>n;)n in this&&(e=t.call(void 0,e,this[n],n,this)),++n;return e}),Array.prototype.filter||(Array.prototype.filter=function(t){if(null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],s=arguments[1],i=0;n>i;i++)if(i in e){var a=e[i];t.call(s,a,i,e)&&r.push(a)}return r}),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var i=[];for(var a in s)t.call(s,a)&&i.push(a);if(e)for(var o=0;r>o;o++)t.call(s,n[o])&&i.push(n[o]);return i}}()),Array.prototype.findKey||(Array.prototype.findKey=function(t,e){for(var n=0;n<this.length;++n)if(this[n][t]==e)return{index:n,value:this[n]};return{index:0/0,value:null}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var r=0;if(arguments.length>0&&(r=Number(arguments[1]),r!=r?r=0:0!==r&&1/0!==r&&r!==-1/0&&(r=(r>0||-1)*Math.floor(Math.abs(r)))),r>=n)return-1;for(var s=r>=0?r:Math.max(n-Math.abs(r),0);n>s;s++)if(s in e&&e[s]===t)return s;return-1}),Array.prototype.map||(Array.prototype.map=function(t,e){var n,r,s;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),a=i.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(n=e),r=new Array(a),s=0;a>s;){var o,u;s in i&&(o=i[s],u=t.call(n,o,s,i),r[s]=u),s++}return r}),Array.prototype.every||(Array.prototype.every=function(t){if(null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],s=0;n>s;s++)if(s in e&&!t.call(r,e[s],s,e))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){if(null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],s=0;n>s;s++)if(s in e&&t.call(r,e[s],s,e))return!0;return!1}),Array.prototype.put||(Array.prototype.put=function(){for(var t=e.slice(arguments);t.length;)this[this.length]=t.shift();return this}),Array.prototype.punique||(Array.prototype.punique=function(){for(var t=e.slice(arguments);t.length;){var n=t.shift();this.indexOf(n)<0&&(this[this.length]=n)}return this}),Array.prototype.cloneExcept||(Array.prototype.cloneExcept=function(){var t=e.slice(arguments);
return this.reduce(function(e,n){return t.indexOf(n)<0?e.put(n):e},[])}),Array.prototype.remove||(Array.prototype.remove=function(){for(var t=e.slice(arguments);t.length;){var n=this.indexOf(t.pop());n>=0&&this.splice(n,1)}return this}),Date.prototype.getMonthName=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names_short[this.getMonth()]},Date.locale={en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},e}),define("sb_light/utils/dom",["sb_light/globals"],function(){var t={};return t.empty=function(t){for(var e=t?t.firstChild:null;e;)t.removeChild(e),e=t.firstChild},t}),define("sb_light/utils/subman",["sb_light/globals"],function(t){var e={},n=[];return e.subscribe=function(e,r){var s=n.findKey("element",e);s.value||n.push({element:e,subs:[]});var i=s.value||n.last(),a=!1;"model"==r.type?(a=i.subs.some(function(t){return t.name==r.name}),a||i.subs.push({type:r.type,name:r.name,key:t.models.subscribe(r.type,r.name,r.handler)})):"state"==r.type&&(a=i.subs.some(function(t){return r.group==t.group&&t.name==r.name}),a||i.subs.push({type:r.type,group:r.group,name:r.name,key:t.state.watch(r.group,r.name,r.handler)}))},e.unsubscribe=function(e){var r=n.findKey("element",e).value;r&&r.subs.forEach(function(e){"model"==e.type?t.models.unsubscribe(e.name,e.key):"state"==e.type&&t.state.unwatch(e.group,e.name,e.key)})},e}),define("sb_light/utils/svg",["sb_light/globals","sb_light/utils/ext"],function(t,e){var n={},r=e.global("d3")&&r||{__missing:!0};n.ZERO=1e-6,n.initD3=function(e){var s=r.__cached||{};r=e,t.ext.each(s,function(t,e){n.extendD3(e,t)})},n.extendD3=function(t,e){return r.__missing?(r.__cached=r.__cached||{},r.__cached[t]=e,void 0):(r.selection.prototype[t]=r.transition.prototype[t]=r.selection.enter.prototype[t]=e,void 0)},n.extendD3("isD3",function(){return!0}),n.extendD3("rect",function(){var e=this,n=t.ext.slice(arguments);return n.length?(["x","y","width","height"].forEach(function(t,r){null!==n[r]&&e.dim(t,n[r])}),e):["x","y","width","height"].reduce(function(n,r){return t.ext.set(n,r,e.dim(r))},{})}),n.extendD3("subscribe",function(e){var n=this;return n.each(function(){t.subman.subscribe(this,e)}),n}),n.extendD3("cleanup",function(){var e=this;return e.each(function(){t.subman.unsubscribe(this)}),e.remove(),e}),n.extendD3("dim",function(e,r){return arguments.length>1?(n.isSvg(this.node())?this.attr(e,r):("x"==e&&(e="left"),"y"==e&&(e="top"),this.style(e,t.ext.isFunc(r)||t.ext.isString(r)?r:t.ext.px(r))),this):t.ext.to_f(n.isSvg(this.node())?this.attr(e):this.style(e))}),n.extendD3("corners",function(t,e){return arguments.length?(this.dim("rx",t),this.dim("ry",e),this):{rx:this.dim("rx"),ry:this.dim("ry")}}),n.extendD3("class",function(){var e=t.ext.slice(arguments);return e.length?(this.attr("class",e.join(" ")),this):this.attr("class")}),n.extendD3("title",function(e){var n=t.ext.slice(arguments);return n.length?this.attr("title",e):this.attr("title")}),n.extendD3("radius",function(e){var n=t.ext.slice(arguments);return n.length?this.attr("rx",e).attr("ry",e):this.attr("rx")}),n._anchorMap={left:"start",start:"start",l:"start",s:"start",center:"middle",middle:"middle",c:"middle",m:"middle",right:"end",end:"end",r:"end",e:"end"},n.extendD3("align",function(e){var r=t.ext.slice(arguments);return r.length?this.style("text-anchor",n._anchorMap[e]):this.style("text-anchor")}),n.extendD3("circle",function(t,e,n){return arguments.length?(this.dim("r",t),this.dim("cx",e),this.dim("cy",n),this):{r:this.dim("r"),cx:this.dim("cx"),cy:this.dim("cy")}}),n.extendD3("line",function(t,e,n,r){return arguments.length?(this.dim("x1",t),this.dim("x2",n),this.dim("y1",e),this.dim("y2",r),this):{x1:this.dim("x1"),y1:this.dim("y1"),x2:this.dim("x2"),y2:this.dim("y2")}}),n.d3=function(t){var e=t&&t.isD3&&t.isD3();return e?t:r.select(t)},n.isSvg=function(t){return t&&t.namespaceURI.match(/svg/)},n.multiline=function(e,r,s,i){if(r){e=n.d3(e);var a=e.attr("width"),o=r.split(" "),u=e.append("tspan");u.text(o[0]);for(var l=1;l<o.length;l++){var c=u.text();c.length,u.text(c+" "+o[l]),u.node().getComputedTextLength()>a&&(u.text(c),u=e.append("tspan").attr("x",t.ext.number(s,10)).attr("dy",t.ext.number(i,18)).text(o[l]))}return e}},n.gridPath=function(t,e,n,s,i,a){var o=[],u=this,l="number"==typeof i?r.range(t+i,t+n,i):i;a=a||i;var c="number"==typeof a?r.range(e+a,e+s,a):a;return l.forEach(function(t){o.put(u.M(t,e),u.v(s))}),c.forEach(function(e){o.put(u.M(t,e),u.h(n))}),o.join("")},n.popupPath=function(t,e,n,r,s){var i=10,a=2*i,o=15,u=2*o,l=15,c=this;s=s||"TM";var d=[];if("T"==s.charAt(0)){switch(d.put(c.M(t+i,e)),s.charAt(1)){case"L":d.put(c.l(o,-l),c.l(o,l),c.h(n-u-a));break;case"M":d.put(c.h((n-a-u)/2),c.l(o,-l),c.l(o,l),c.h((n-a-u)/2));break;case"R":d.put(c.h(n-u-a),c.l(o,-l),c.l(o,l))}d.put(c.q(i,0,i,i),c.v(r-a)),d.put(c.q(0,i,-i,i),c.h(a-n)),d.put(c.q(-i,0,-i,-i),c.v(a-r)),d.put(c.q(0,-i,i,-i))}else"R"==s.charAt(0)||"B"==s.charAt(0)||"L"==s.charAt(0);return d.join("")},n.transformMap={r:"rotate",s:"scale",t:"translate"},n.transform=function(t){var e=t.order||["r","s","t"],r=[];return e.forEach(function(e){if(t[e]){var s=n[n.transformMap[e]];r.put(s.apply(n,t[e]))}}),r.join(" ")};var s=",";n.translate=function(t,e){return(isNaN(e)?["translate(",t,")"]:["translate(",t,", ",e,")"]).join("")},n.scale=function(t,e){return(isNaN(e)?["scale(",t,")"]:["scale(",t,", ",e,")"]).join("")},n.rotate=function(t){return"rotate("+t+")"},n.viewBox=function(t,e,n,r){return[t,e,n,r].join(" ")},n.l=function(t,e){return["l",t,s,e].join("")},n.L=function(t,e){return["L",t,s,e].join("")},n.m=function(t,e){return["m",t,s,e].join("")},n.M=function(t,e){return["M",t,s,e].join("")},n.h=function(t){return["h",t].join("")},n.H=function(t){return["H",t].join("")},n.v=function(t){return["v",t].join("")},n.V=function(t){return["V",t].join("")},n.q=function(t,e,n,r){var i=s;return["q",t,i,e,i,n,i,r].join("")},n.Q=function(t,e,n,r){var i=s;return["Q",t,i,e,i,n,i,r].join("")},n.path=function(){return t.ext.slice(arguments).join("")},n.append=function(t,e,r){t=n.d3(t);var s=t.select(e);if(s.empty()){s=t;var i=e.split(" ");i.forEach(function(t){if(t&&t.length>0)if(s.select(t).empty()){var e=t.split(".");s=s.append(e.shift()).attr("class",e.join(" "))}else s=s.select(t)}),r&&r(s)}return s},n.remove=function(t,e){t=n.d3(r);var r=t.select(e);r.empty()||r.remove()},n.dims=function(t,e,n,r,s){return s.attr("x",t).attr("y",e).attr("width",n).attr("height",r),s},n.dim=function(e,n,r){return 3==arguments.length?e.attr(n,r):t.ext.to_f(e.attr(n))},n.style=function(t){for(var e=1;e<arguments.length;e+=2){var n=arguments[e];n=i[n]||n,t.style(n,arguments[e+1])}return t};var i={t:"font",f:"fill",fo:"fill-opacity",s:"stroke",so:"stroke-opacity",sw:"stroke-width",slc:"stroke-linecap",slj:"stroke-linejoin",sda:"stroke-dasharray",ta:"text-anchor"};return n}),define("sb_light/utils/queue",["sb_light/globals"],function(t){var e={},n=[],r=[],s={},i=0,a=function(){e.next(),a=function(){}};e.interval=function(t){return arguments.length&&(i=t),i},e.buffer=function(t,n,r,i){i=i||!1;var a=s[n];a?!a.started&&i?(clearTimeout(a.id),delete s[n],e.buffer.apply(e,[t,n,r,i])):i&&(a.queued={func:t,delay:r}):(a=s[n]={},a.func=function(){var r=s[n];if(r&&(r.started=!0,t(),delete s[n],r.queued)){var i=[r.queued.func,n,r.queued.delay,!0];e.buffer.apply(e,i)}},a.delay=r,r?a.id=setTimeout(a.func,r):a.func())},e.add=function(e,r,s,i){s=t.ext.number(s,0),r=r||"queued_"+t.ext.unique();var o=n.findKey("name",r).value;o?i&&(o.time=t.ext.time(),o.delay=s):(n.push({name:r,func:e,time:t.ext.time(),delay:s}),a())},e.high=function(e,n,s,i){s=t.ext.number(s,0),n=n||"queued_"+t.ext.unique();var o=r.findKey("name",n).value;o?i&&(o.time=t.ext.time(),o.delay=s):(r.push({name:n,func:e,time:t.ext.time(),delay:s}),a())},e.cancel=function(t){if(s[t])return delete s[t],void 0;var e=n.findKey("name",t).index;if(e>=0)return n.splice(e,1),void 0;var i=r.findKey("name",t).index;return i>=0?(r.splice(i,1),void 0):void 0},e.next=function(){o(r)||o(n),e.next.bindDelay(e,i)};var o=function(e){for(var n=t.ext.time(),r=e.length,s=0,i=!1,a=[];r>s&&!i;){var o=e.shift();n-o.time>o.delay?(o.func(),i=!0):a.push(o),s+=1}return e.unshift.apply(e,a),i};return e.report=function(){r.map(function(t){return t.name}).join(" "),n.map(function(t){return t.name}).join(" ")},e}),define("sb_light/utils/events",["sb_light/globals"],function(){var t={};return t.stop=function(t){t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),t&&t.preventDefault&&t.preventDefault()},t}),define("sb_light/utils/Class",[],function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(n){function r(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var i=new this;t=!1;for(var a in n)i[a]="function"==typeof n[a]&&"function"==typeof s[a]&&e.test(n[a])?function(t,e){return function(){var n=this._super;this._super=s[t];var r=e.apply(this,arguments);return this._super=n,r}}(a,n[a]):n[a];return r.prototype=i,r.prototype.constructor=r,r.extend=arguments.callee,r},Class}),define("widgets/widget",["sb_light/utils/Class"],function(t){var e={b:"bottom",l:"left",r:"right",t:"top",h:"height",w:"width",f:"fringe"},n=/left|right|top|bottom|height|width|fringe/,r=t.extend({_sb:null,_dom:null,_def:null,_domFuncs:null,_sizeFuncs:null,_sizeDefs:null,_classList:null,_parent:null,_name:null,_binds:null,_props:null,_animate:0,_created:!1,_visible:!1,_listeners:null,_watching:null,_layout:null,_rootElement:null,_childrenLayout:null,_defaultLayout:null,_delay:50,init:function(t,e,n){this._sb=t,this._rootElement=this._rootElement||"div",this._props=this._buildPropsList(),this._binds={},this._sizeFuncs={},this._sizeDefs={},this._parent=e,this._def=n,this._classList={},this._listeners={},this._watchers={state:{},context:{},data:{}},this._models={},this._domFuncs=this._propertyOverrides(),Object.defineProperties(this,{created:{get:function(){return this._created}},widget:{get:function(){return!0}},dom:{get:function(){return this._dom}},id:{get:function(){return this._def&&this._def.id||this._dom&&this._dom.id}},name:{get:function(){return this._name||this._def&&this._def.widget}},parent:{get:function(){return this._parent||null}},parentId:{get:function(){return this._parent?this._parent.id:null}},parentDom:{get:function(){return this._parent&&this._parent.widget?this.parent.dom:this.parent||null}},parentWidget:{get:function(){return this._parent&&this._parent.widget&&this.parent||null}},parentLayout:{get:function(){return this.parentWidget?this.parentWidget.layout:null}},widgets:{get:function(){return this.layout&&this.layout.widgets||null}},children:{get:function(){return this._layout&&this._layout.widgets||null}},layout:{get:function(){return this._layout||this.parentLayout||null}},visible:{get:function(){return this._visible},set:function(t){t=t?!0:!1,this._visible!=t&&(this._visible=t,$(this.dom).toggle(t),this.invalidate())}}});try{this.create(),this.postCreate()}catch(r){throw console.log("Failed to create widget "+n.id+" "+JSON.stringify(r.message?r.message+"\n"+r.source:r)),new Error("Failed to create widget "+n.id+" "+JSON.stringify(r.message?r.message+"\n"+r.source:r))}},cid:function(t,e){return(e?"#":"")+[this.id,t].join("_")},cidDim:function(t,r,s){var i=["@",this.cid(t)],a=String(e[r]||r||"");a=a.match(n)?a:null;var o=2!=arguments.length||a?s||0:r;return a&&i.put("#",a),i.put("#",o),i.join("")},child:function(t){return this.widgets?this.widgets[t]||this.widgets[this.cid(t)]:null},childDom:function(t){var e=this.child(t);return e?e.dom:null},create:function(){this._name=this._name||"widget::"+this._rootElement,this._dom=this.createDom(this._def),this.className("sb_light_widget"),this.createLayout(),this.parentDom.appendChild(this._dom),this._created=!0},destroy:function(){if(this._created){this._created=!1,this._sb.queue.cancel("_buffer"+this.id);var t=this._sb.ext.each;this._layout&&t(this.children,function(t){t.created&&t.destroy()});var e=this.dom;t(this._listeners,function(t,n){t.forEach(function(t){e.removeEventListener(n,t)})}),this._sb.dom.empty(this.dom);var n=this._watchers,r=this._sb.state;t(n,function(e){var s=n[e];t(s,function(t){r.unwatch(e,n[e],t)})});var s=this._sb.models;t(this._models,function(t,e){s.unsubscribe(e,t)});for(var i in this)"_"==i.charAt(0)&&(this[i]=null)}},bind:function(t){if(!this._binds[t]){if(!this[t])throw new Error("SB_Light Widget ("+t+") is not a function of : "+this.id);this._binds[t]=this[t].bind(this)}return this._binds[t]},listen:function(t,e){this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this.dom.addEventListener(t,e)},models:function(){var t=this._sb.ext.slice(arguments,0),e=this._sb.models,n=this._models,r=this.bind("dirty");t.forEach(function(t){n[t]=e.subscribe(t,r)})},watch:function(t,e){var n=this._sb.ext.slice(arguments,1),r=this._sb.state,s=this._watchers[e],i=this.bind(t);n.forEach(function(t){s[t]=r.watch(e,t,i)})},modelsValid:function(){var t=this._sb.models,e=!0;return this._sb.ext.each(this._models,function(n,r){e=e&&null!==t.raw(r)}),e},_buildPropsList:function(){var t=[];for(var e in this)t.push(e);return t.join(",")},has:function(t){var e=new RegExp("(^|,)_?"+t+"(,|$)");return this._props.match(e)},createLayout:function(){var t=this.childrenLayout();t&&t.length&&(this._layout=this._sb.layout.parse(this,t))},postCreate:function(){this.applyProperties()},addChild:function(t,e){var n=this.children;n&&!n[t]&&(n[t]=e,this.invalidate())},removeChild:function(t){var e=this.children;if(e[t]){var n=e[t];this.dom&&this.dom.removeChild(n.dom),delete e[t],n.destroy(),this.invalidate()}},replaceClass:function(t,e){return delete this._classList[t],e&&this.className(e),this},_noop:function(){},_propertyOverrides:function(){return{"default":this.bind("attr"),css:this.bind("cssText"),style:this.bind("cssText"),widget:this._noop,animate:this.bind("prop"),visible:this.bind("prop"),"widget-name":this.bind("dataProperty"),"class":this.deprecated.bind(this,'Please use "klass" instead.'),klass:this.bind("className"),children:this.bind("childrenLayout"),domNode:this._noop,text:this.bind("text"),left:this._noop,right:this._noop,top:this._noop,bottom:this._noop,x:this._noop,y:this._noop,height:this._noop,width:this._noop,fringe:this._noop}},appendChild:function(t){this._dom&&t&&this._dom.appendChild(t)},createDom:function(t){if(t.widget=this._sb.ext.isStr(t.widget)?t.widget:this._rootElement,!t.widget)throw new Error("The 'widget' option must be specified, and be the name of a valid HTML element.");return t.domNode||document.createElement(t.widget)},childrenLayout:function(t){var e=this._sb.ext.slice(arguments,arguments.length>1?1:0);return e.length?(this._childrenLayout=t,this):(this._defaultLayout||[]).concat(this._childrenLayout||[])},applyProperties:function(){this._def["widget-name"]=this.name;for(var t in this._def){var e=this._domFuncs[t]||this._domFuncs["default"];e(t,this._def[t])}},prop:function(t,e){var n;if(n=this.has("_"+t)?"_"+t:t,!this.has(n))throw new Error("SB_Light Widget ("+t+") is not a property of : "+this._name);return arguments.length>1?(this[n]=e,this):this[n]},source:function(t,e){return arguments.length>1?(this._def[t]=e,this):void 0===this._def[t]?null:this._def[t]},deprecated:function(t,e){var n='Deprecation Warning: "'+t+'": '+e;if(this._sb.debug)throw n;this._sb.ext.warn(n)},className:function(){var t=this._sb.ext.slice(arguments,"klass"==arguments[0]?1:0),e=this.dom,n=this;if(t.length){var r=t[0],s=t[1]||!1;return r.split(" ").forEach(function(t){s?delete n._classList[t]:n._classList[t]=!0}),e.className=this._sb.ext.keys(this._classList).join(" "),this}return e.className},_attrMap:{fer:"for"},attr:function(t,e){return t=t&&this._attrMap[t]||t,arguments.length>1?(this._dom.setAttribute(t,e),this):this._dom.getAttribute(t)},dataProperty:function(t,e){this.attr.call(this,"data-"+t,e)},cssText:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.style.cssText=t[0],this):this._dom.style.cssText},text:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.textContent=t[0],this):this._dom.textContent},sizeDefs:function(t,e){return arguments.length>1?(this._sizeDefs[t]=e,this):this._sizeDefs[t]},sizeFuncs:function(t,e){return arguments.length>1?(this._sizeFuncs[t]=e,this):this._sizeFuncs[t]},invalidate:function(){this&&this._sb&&this._sb.queue.buffer(this.bind("_beforeApplyLayout"),"_buffer"+this.id,this._delay,!0)},dirty:function(){this&&this._sb&&this._sb.queue.buffer(this.bind("_beforeDraw"),"_buffer"+this.id,this._delay,!0)},canDraw:function(){return this.created&&this.visible&&this.modelsValid()},_beforeApplyLayout:function(){this.canDraw()?(this.showChildren(),this.applyLayout(),this._afterApplyLayout()):(this.showChildren(),this.cleanup())},_afterApplyLayout:function(){this.dirty()},showChildren:function(){var t=this.canDraw(),e=this.children||{};this._sb||console.log("wtf"),this._sb.ext.each(e,function(e){e.visible=t})},applyLayout:function(){this.dom;var t=this.bind("dim");this._sb.ext.px;var e=this.bind("sizeFuncs");["left","top","width","height"].forEach(function(n){var r=e(n);if(r){var s=r();("width"!=n&&"height"!=n||0!=s)&&t(n,s)}})},_beforeDraw:function(){if(this.canDraw()){if(d3.select(this.dom).style("visibility","visible"),this._layout){var t=this._dom.getBoundingClientRect();this._layout.rootWidth=t.width,this._layout.rootHeight=t.height,this._sb.layout.resize(this._layout)}this.draw(),this._afterDraw()}else d3.select(this.dom).style("visibility","hidden")},_afterDraw:function(){},draw:function(){},cleanup:function(){},dim:function(t,e){var n=this._sb.ext;return arguments.length>1?(this.dom.style[t]=n.isStr(e)?e:n.px(e),this):this._sb.ext.to_i(this.dom.style[t])},rect:function(){return{x:this.dim("left"),y:this.dim("top"),width:this.dim("width"),height:this.dim("height")}}});return r}),define("widgets/svg",["widgets/widget"],function(t){var e=t.extend({_d3:null,_pd3:null,_svgDiv:null,_children:null,_rootElement:null,_dispatcher:null,_width:null,_height:null,_left:null,_top:null,init:function(t,e,n,r){if(!d3)throw"You need to load the d3.js library to use SVG widgets";this._rootElement=r||(t.ext.isStr(n.widget)?n.widget:"svg"),Object.defineProperties(this,{d3:{get:function(){this._d3}},pd3:{get:function(){this._pd3}}}),this._super(t,e,n)},create:function(){this._name=this._name||this._rootElement+" "+this.id,this._children={},this._dispatches=this._dispatches||{},this._pd3=d3.select(this.parentDom),this._d3=this.createDom(this._def),this._dom=this._d3.node(),this.createChildren(this.childrenLayout())},postCreate:function(){var t=this._sb.ext.keys(this._def.dispatches);t.length&&(this._dispatcher=d3.dispatch.apply(d3,t)),this._super()},_propertyOverrides:function(){var t=this._super(),e=this;return t["default"]=this.bind("attr"),t.style=this.bind("css"),t.dispatches=this.bind("dispatches"),this._sb.ext.mixin(t,["stroke","stroke-width","stroke-linecap","stroke-opacity","stroke-linejoin","stroke-dasharray","fill","fill-opacity","text-anchor"].reduce(function(t,n){return t[n]=e.bind("style"),t},{})),this._sb.ext.mixin(t,["left","top","width","height"].reduce(function(t,n){return t[n]=e.bind("prop"),t},{})),t},childrenLayout:function(){return null},createChildren:function(t){try{var n,r;for(t=this._sb.ext.isArr(t)?t:t?[t]:[],r=0;r<t.length;++r)n=t[r],n.id=this._sb.layout.uniqueId(n),this._children[n.id]=this._sb.ext.isString(n.widget)?new e(this._sb,this.dom,n):new n.widget(this._sb,this.dom,n),n.children&&this._children[n.id].createChildren(n.children)}catch(s){throw["SB_Light::SVG::create ",s.message,n.id].join(" -- ")}},child:function(t){return this._children[t]||this._children[this.cid(t)]||null},appendChild:function(){},createDom:function(t){if(!t.widget)throw"The 'widget' option must be specified, and be the name of a valid HTML element.";return"svg"!=this._rootElement||this.parentDom.ownerSVGElement||(this._svgDiv=this.pd3.append("div").attr("class","sb_light_widget")),this._svgDiv||this.pd3.append(this._rootElement)},attr:function(){return this.d3.attr.apply(this._d3,arguments)},style:function(){return this.d3.style.apply(this._d3,arguments)},css:function(){return this._svgDiv?this.cssText.apply(this,arguments):this.style.apply(this,arguments)},text:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);return this.d3.text.apply(this.d3,t)},className:function(){var t=this._sb.ext.slice(arguments,"class"==arguments[0]||"className"==arguments[0]?1:0),e=this._svgDiv||this._d3;if(t.length){var n=t[0].split(/\s/);return n.forEach(function(n){e.classed(n,t[1]!==!0)}),this}return e.attr("class")},dispatches:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);if(t.length){var e,n=t[0];for(e in n)this._dispatcher.on(e,n[e]);return this}return this._dispatches},dispatch:function(t,e,n,r){this._dispatcher&&this._dispatcher[t]&&this._dispatcher[t].apply(e,[n,r])},dispatcher:function(){return this._dispatcher},dims:function(t,e,n,r){this.dim("left",t),this.dim("top",e),this.dim("width",n),this.dim("height",r),this.invalidate()},dim:function(t,e){if(t.match(/left|top|width|height/)&&this.prop.apply(this,this._sb.ext.slice(arguments)),this._svgDiv){if(arguments.length>1)return this._svgDiv.style(t,this._sb.ext.px(e)),t.match(/width|height/)&&this.d3.attr(t,e),this}else if(arguments.length>1)return this.d3.attr(t,e),this;return this.prop(t)},rect:function(){return this._super()}});return e}),define("sb_light/layout",["sb_light/globals","widgets/widget","widgets/svg"],function(t,e,n){var r={};r.init=function(){},r.create=function(r,s){try{var i;if(t.ext.isStr(s.widget))i="svg"==s.widget?new n(t,r,s):new e(t,r,s);else{var a=s.widget;i=new a(t,r,s)}return i}catch(o){throw console.log(["SB_Light::Layout::create ",JSON.stringify(o),s.id].join(" -- ")),new Error(["SB_Light::Layout::create ",JSON.stringify(o),s.id].join(" -- "))}},r.parse=function(t,e,n){var i=t.ownerDocument?t.getBoundingClientRect():t.rect(),a={root:t,widgets:{},rootWidth:i.width,rootHeight:i.height};return s(null,e,a),n||r.resize(a),a},r.resize=function(t){t&&(l(t),d(t),_(t))},r.change=function(t,e,n,s,i){var a=t.widgets[e],o=a.source(n);o!=s&&(a.source(n,s),i||r.resize(t))},r.uniqueId=function(e){return e.id||(e.id="unknown_"+t.ext.unique()),e.id};var s=function(e,n,s){var i=e?s.widgets[e]:s.root;if(!i)throw new Error("Warning: missing parent id",e);n=t.ext.isArray(n)?n:[n];var a=r.createWidget.bind(r,s,i);n.forEach(a)};r.createWidget=function(t,e,n,i){n.id=r.uniqueId(n),n.style=n.style||"",n.style=(n.style.match("/z-index/")?"":"z-index:"+i+";")+n.style;var a=r.create(e,n);return t.widgets[n.id]=a,e.created&&e.created&&e.addChild(n.id,a),n.children&&n.children.length&&("svg"==n.widget?a.createChildren(n.children):s(n.id,n.children,t)),a};var i=/^@(.+?)(#(left|right|top|bottom|height|width))?(#(-?\d+))?$/,a=/^(-?[\d\.]+)([^0-9]+)?$/,o=["left","right","top","bottom","height","width"],u=["top","bottom","height"],l=function(e){e&&t.ext.each(e.widgets,function(n){e.widgets[n.parentId]||null;var r=n.sizeDefs.bind(n),s=t.ext.valid;o.forEach(function(t){r(t,n.source(t))}),s(r("left"))&&s(r("width"))&&s(r("right"))&&r("right",null),s(r("top"))&&s(r("bottom"))&&s(r("height"))&&r("bottom",null);var i=s(n.source("fringe"))?n.source("fringe"):0;s(r("left"))||s(r("width"))&&s(r("right"))||r("left",i),s(r("right"))||s(r("width"))&&s(r("left"))||r("right",i),s(r("top"))||s(r("height"))&&s(r("bottom"))||r("top",i),s(r("bottom"))||s(r("height"))&&s(r("top"))||r("bottom",i)})},c=function(t){return u.indexOf(t)>-1},d=function(e){t.ext.each(e.widgets,function(n,r){var s=n.sizeFuncs.bind(n),u=e.widgets[n.parentId]||null,l=n.parentId||"_root",d=u&&u.sizeFuncs.bind(u)||null,_=d?[d,"width",l+"@width"]:e.rootWidth,p=d?[d,"height",l+"@height"]:e.rootHeight,m=t.ext.valid;o.forEach(function(o){var u=String(n.sizeDefs(o)),l=u?u.match(i):null,d=u.match(a);if(d)3==d.length&&"%"==d[2]?(d=t.ext.to_f(d[1])/100,s(o,h(r,o,t.ext.prod,c(o)?p:_,d))):2!=d.length&&m(d[2])||(d=t.ext.to_f(d[1]),s(o,h(r,o,t.ext.sum,d)));else if("auto"==u)s(o,f(r,o,n,e));else{if(!l)return"width"==o?s(o,h(r,o,t.ext.diff,_,[s,"left",r+"@left"],[s,"right",r+"@right"])):"height"==o?s(o,h(r,o,t.ext.diff,p,[s,"top",r+"@top"],[s,"bottom",r+"@bottom"])):"left"==o?s(o,h(r,o,t.ext.diff,_,[s,"width",r+"@width"],[s,"right",r+"@right"])):"top"==o?s(o,h(r,o,t.ext.diff,p,[s,"height",r+"@height"],[s,"bottom",r+"@bottom"])):"right"==o?s(o,h(r,o,t.ext.diff,_,[s,"width",r+"@width"],[s,"left",r+"@left"])):"bottom"==o&&s(o,h(r,o,t.ext.diff,p,[s,"height",r+"@height"],[s,"top",r+"@top"])),void 0;var g=l[1]&&e.widgets[l[1]]?l[1]:null,b=m(l[3])?l[3]:o,y=m(l[5])?t.ext.to_f(l[5],0):0,v=e.widgets[g];if(!v)throw new Error("SB_LIGHT::Layout: No element found matching the definition:"+u+". Please check your layout definition.");var w=v.sizeFuncs.bind(v);"right"==b&&"left"==o?s(o,h(r,o,t.ext.sum,[w,"left",g+"@left"],[w,"width",g+"@width"],y)):"left"==b&&"right"==o?s(o,h(r,o,t.ext.sum,[w,"right",g+"@right"],[w,"width",g+"@width"],y)):"bottom"==b&&"top"==o?s(o,h(r,o,t.ext.sum,[w,"top",g+"@top"],[w,"height",g+"@height"],y)):"top"==b&&"bottom"==o?s(o,h(r,o,t.ext.sum,[w,"bottom",g+"@bottom"],[w,"height",g+"@height"],y)):s(o,h(r,o,t.ext.sum,[w,b,g+"@"+b],y))}})})},h=function(e,n,r){var s=e+":"+n,i=t.ext.slice(arguments,3);return function(e){if(e=e||"Chain: ",e.match(s))throw new Error("sb_light::utils::layout Error -- Circular dependancy ("+e+") "+s);var n=i.map(function(n){return t.ext.isArr(n)?[n[0](n[1]),e+"_"+s+(n[2]?"("+n[2]+")":"")]:n}),a=r.apply(r,n);return a}},f=function(e,n,r,s){var i=e+":"+n;return function(e){if(e=e||"Chain: ",e.match(i))throw new Error("sb_light::utils::layout Error -- Circular dependancy ("+e+") "+i);var a,o,u,l=[],c=r.children;for(a in c)o=c[a],u=o.sizeFuncs.bind(o),l.push(function(){if("width"==n)return u("left")(e+"_"+i+"_"+a+"@"+n)+u("width")(e+"_"+i+"_"+a+"@"+n);if("height"==n)return u("top")(e+"_"+i+"_"+a+"@"+n)+u("height")(e+"_"+i+"_"+a+"@"+n);if("left"==n)return u("left")(e+"_"+i+"_"+a+"@"+n);if("top"==n)return u("top")(e+"_"+i+"_"+a+"@"+n);throw"Dim Unknown:"+n});if(l.length)return"width"==n||"height"==n?t.ext.max.apply(null,l):t.ext.min.apply(null,l);var d=r.parentId,h=s.widgets[d]||null,f=h?h.dom:s.root.dom||s.root||null,_=r.dom.getBoundingClientRect(),p=f?f.getBoundingClientRect():{left:0,top:0,bottom:0,right:0,width:0,height:0},m=h?h.sizeFuncs("height")(e+"_"+i):s.rootHeight,g=h?h.sizeFuncs("width")(e+"_"+i):s.rootWidth;return"bottom"!==n&&"right"!=n?_[n]:"bottom"==n?m-_.height-(_.top-p.top):g-_.width-(_.left-p.left)}},_=function(t){for(var e in t.widgets)t.widgets[e].invalidate()};return r}),define("sb_light/utils/consts",["sb_light/globals"],function(){var t={};return t.blockWidth=function(){return 350},t.blockHeight=function(t){return t?185:150},t.blockTreePadding=function(t){return t?80:90},t.blockTypes=function(t){t=t||{};var e=[{name:"Status",shortkey:"bs",key:"status"},{name:"Progress",shortkey:"bp",key:"progress"},{name:"Health",shortkey:"bh",key:"health"},{name:"Outputs",shortkey:"bk",key:"outputs"},{name:"Risk",shortkey:"br",key:"risks"}];return t.def&&e.unshift({name:"Default",shortkey:"bd",key:"default"}),t.key&&(e=e.map(function(e){return e[t.key]})),e},t}),define("sb_light/models/_abstractModel",["sb_light/utils/Class"],function(t){var e=t.extend({name:null,_sb:null,_model:null,_modelArray:null,_urlDef:null,_selectQueue:null,_subscriptions:null,init:function(t,e,n){if(!e)throw new Error("AbstractModel: Model name must be declared");if(!n)throw new Error("AbstractModel: Model urlDef must be declared");this._sb=t,this.name=e,this._urlDef=n,this._selectQueue=[],this._subscriptions={},this._sb.state.registerModel(this,this._urlDef,this._handleUpdate.bind(this)),this._sb.state.watchContext("session",this._handleSession.bind(this))},reset:function(t){this._model=null,this._modelArray=null,this._sb.state.resetTimestamp(this.name),t&&this._publish()},isValid:function(){return null!=this.get()},get:function(){if(!this._model){if(this._sb.ext.debug("Getting the "+this.name+" model."),this._sb.state.authorized())this._sb.ext.debug("Forcing the update"),this._sb.state.forceModelUpdate(this);else var t=this,e=this._sb.state.watchContext("session",function(){t._sb.state.unwatchContext("session",e),t.get()});return null}return this._modelArray},raw:function(){return this._model},rawArray:function(){return this._modelArray},subscribe:function(t){var e="Sub_"+this.name+"_"+this._sb.ext.unique();this._subscriptions[e]=t;var n=this.get();return n&&this._sb.queue.add(t,e,0),e},unsubscribe:function(t){var e=this._sb.ext,n=[],r=this._subscriptions;e.each(r,function(e,r){(e==t||r==t)&&n.push(r)}),n.forEach(function(t){delete r[t]})},_publish:function(){this.get();var t=this._sb.queue;this._sb.ext.each(this._subscriptions,function(e,n){t.add(e,n,0)})},select:function(t,e,n){this._selectQueue.push({type:t,cb:e,func:n}),this._processQueue()},_handleSession:function(){this._sb.state.authorized()?this.get():this.reset()},_handleUpdate:function(t){this._processResponse(t),this._model&&(this._publish(),this._processQueue())},_processQueue:function(){var t=this.get();if(t)for(;this._selectQueue.length;){var e=this._selectQueue.pop();switch(e.type){case"map":e.cb(this._model);break;case"all":e.cb(t);break;case"filter":e.cb(t.filter(e.func))}}},_processResponse:function(t){this._model=this._model||{},this._sb.ext.debug("Processing Model",this.name),this._addItems(t.added),this._updateItems(t.updated),this._deleteItems(t.deleted),this._resetArrayCache(),this._massageUpdatedModel()},_addItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_updateItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_deleteItems:function(t){var e=this._model;t=t||[];var n=this;t.forEach(function(t){e[t]&&n._sb.ext.debug("Deleting Model",n.name,t),delete e[t]})},_massageUpdatedModel:function(){var t=this._sb.state.getTimestamp(this.name);this._modelArray.forEach(function(e){e.__timestamp=t})},_resetArrayCache:function(){this._modelArray=this._sb.ext.map(this._model,function(t){return t})}});return e}),define("sb_light/models/tagsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"tags",t.urls.MODEL_TAGS)}});return e}),define("sb_light/models/newsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"news",t.urls.MODEL_NEWS)},_massageUpdatedModel:function(){this._super()}});return e}),define("sb_light/models/usersModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"users",t.urls.MODEL_USERS)},_massageUpdatedModel:function(){this._super();for(var t in this._model){var e=this._model[t];e.name=e.first_name+" "+e.last_name}}});return e}),define("sb_light/models/blocksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({_progress:null,_health:null,_npv:null,_npv_queue:null,_progress_queue:null,_health_queue:null,_properties:null,_propertiesList:["comments","news","tags","documents","context","watching_users"],init:function(t){this._npv_queue=[],this._progress_queue=[],this._health_queue=[],this._properties={},this._dataHandlers={_health:this._massageHealth,_progress:this._massageProgress,_npv:this._massageNpv},this._super(t,"blocks",t.urls.MODEL_BLOCKS)},_handleUpdate:function(t){this._progress=null,this._health=null,this._npv=null,this._super(t)},_massageUpdatedModel:function(){this._super();var t=this._model[this._sb.queries.rootBlockId()];t||(t=this._modelArray.filter(function(t){return!t.parents||!t.parents.length
})[0]),this._massage(t,null,0,(new Date).getTime()),this._sb.queries.currentBlock()||this._sb.state.state("block",t.id),this._sb.ext.debug("Finished massaging blocks")},rawPaths:function(){var t=this.rawArray()||[],e={};return t.forEach(function(t){t.paths.forEach(function(n){e[n]=t})}),e},rawArrayPaths:function(){return this._sb.ext.map(this.rawPaths(),function(t,e){return{path:e,block:t}})},progress:function(t){this._data(t,"_progress",this._sb.urls.BLOCKS_PROGRESS)},health:function(t){this._data(t,"_health",this._sb.urls.BLOCKS_HEALTH)},npv:function(t){this._data(t,"_npv",this._sb.urls.BLOCKS_NPV)},comments:function(t,e,n){this._property(e,"comments",t,n)},news:function(t,e,n){this._property(e,"news",t,n)},tags:function(t,e,n){this._property(e,"tags",t,n)},documents:function(t,e,n){this._property(e,"documents",t,n)},context:function(t,e,n){this._property(e,"context",t,n)},watching:function(t,e,n){this._property(e,"watching_users",t,n)},_property:function(t,e,n,r){if(!(this._propertiesList.indexOf(e)>=0))throw new Error("BlockModel property is not valid:"+e);this._properties[e]=this._properties[e]||{},!this._properties[e][n]||r?(this._properties[e][n]="waiting",this._properties[e+"_queue"]=this._properties[e+"_queue"]||{},this._properties[e+"_queue"][n]=this._properties[e+"_queue"][n]||[],this._properties[e+"_queue"][n].push(t),this._sb.controller.invoke(this._sb.urls.BLOCKS_PROPERTIES,{id:n,type:e},this._handleProperty.bind(this,e,n))):"waiting"==this._properties[e][n]?this._properties[e+"_queue"][n].push(t):t(this._properties[e][n])},_data:function(t,e,n){var r=this._handleData.bind(this,e);this[e+"_queue"].push(t),this[e]?r():1==this[e+"_queue"].length&&this._sb.controller.invoke(n,null,r)},_handleData:function(t,e){for(this[t]=e?e.result:this[t],this._dataHandlers[t]&&e&&e.result&&this._dataHandlers[t].call(this,this[t]);this[t+"_queue"].length;){var n=this[t+"_queue"].pop();n(this[t])}},_handleProperty:function(t,e,n){for(this._properties[t]=this._properties[t]||{},this._properties[t][e]=n?n.result:this._properties[t][e];this._properties[t+"_queue"][e].length;){var r=this._properties[t+"_queue"][e].pop();r(this._properties[t][e])}},_massageHealth:function(t){var e=this._sb.ext.massageHealth;this._sb.ext.each(t,function(t){e(t)})},_massageProgress:function(t){var e=this._sb.ext.massageTA;this._sb.ext.each(t,function(t){e(t)})},_massageNpv:function(){},_massage:function(t,e,n,r){var s=t._schema!=r;t._schema=s?r:t._schema,t.paths=!s&&t.paths||[],t.children=t.children||[];var i=e?this._model[e.last()]:null;if(i){var a=t.parents.findKey("parent_id",i.id).value,o=t.parents.findKey("linked_parent_id",null).value;a.position=i.children.indexOf(t.id),a.level=n,t.paths.put(e.concat([t.id])),i.id==o.parent_id&&(t.default_path=t.paths.last(),t.default_parent=i.id,t.default_level=n,t.default_position=a.position),i.is_owner&&(a.can_move_left=a.position>0,a.can_move_right=a.position<i.children.length-1&&i.children.length>1,a.can_delete=!0)}else t.default_path=[t.id],t.default_parent=null,t.paths.put([t.id]),t.default_position=0,t.default_level=0;for(var u=t.paths.last(),l=0;l<t.children.length;++l)this._massage(this._model[t.children[l]],u,n+1,r)},_resetArrayCache:function(){this._super(),this._modelArray.sort(this._sb.ext.sortBlocksByProgress)}});return e}),define("sb_light/models/levelsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"levels",t.urls.MODEL_LEVELS)}});return e}),define("sb_light/models/focusModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"focus",t.urls.MODEL_FOCUS)}});return e}),define("sb_light/models/risksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"risks",t.urls.MODEL_RISKS)}});return e}),define("sb_light/models/kpisModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"kpis",t.urls.MODEL_KPIS)},_massageUpdatedModel:function(){this._super();var t=this._sb;t.ext.each(this._model,function(e){t.ext.massageKpi(e)})}});return e}),define("sb_light/models/companiesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"companies",t.urls.MODEL_COMPANIES)}});return e}),define("sb_light/models/timezonesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"timezones",t.urls.MODEL_TIMEZONES)}});return e}),define("sb_light/models/capabilities",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"timezones",t.urls.MODEL_CAPABILITIES)}});return e}),define("sb_light/models",["sb_light/globals","sb_light/models/tagsModel","sb_light/models/newsModel","sb_light/models/usersModel","sb_light/models/blocksModel","sb_light/models/levelsModel","sb_light/models/focusModel","sb_light/models/risksModel","sb_light/models/kpisModel","sb_light/models/companiesModel","sb_light/models/timezonesModel","sb_light/models/capabilities"],function(t,e,n,r,s,i,a,o,u,l,c,d){function h(e){var n=f[e];if(!n)throw new Error("sb.appModel.js: Model name not found: "+e);return n.model||(n.model=new n.klass(t)),n}var f={tags:{klass:e},news:{klass:n},users:{klass:r},blocks:{klass:s},levels:{klass:i},focus:{klass:a},risks:{klass:o},kpis:{klass:u},companies:{klass:l},timezones:{klass:c},capabilities:{klass:d}},_={};return _.reset=function(t){for(var e in f){var n=f[e]?f[e].model:null;n&&n.reset(t)}},_.get=function(t){var e=h(t);return e.model},_.subscribe=function(t,e,n){var r=h(t);return r.model.subscribe(e,n)},_.unsubscribe=function(t,e){var n=h(t);return n.model.unsubscribe(e)},_.rawArray=function(t){var e=h(t);return e.model?e.model.rawArray():void 0},_.raw=function(t){var e=h(t);return e.model?e.model.raw():void 0},_.select=function(e,n,r,s){var i=h(e);i.model&&(t.ext.debug("Doing a select on the model.",e),i.model.select(n,r,s))},_.isValid=function(t){var e=h(t),n=!1;return e.model&&(n=e.model.isValid()),n},_}),define("sb_light/controller",["sb_light/globals"],function(t){var e={};return e.invoke=function(e,n,r,s,i){var a=t.urls.url(e,n),o={};e.deleteId&&delete n.id;var u=e.massageParamsFunc?t.urls[e.massageParamsFunc](n):n;null!=u&&(u instanceof Array?o.json=JSON.stringify(u):Object.keys(u).length>0&&(e.normalParams?o=u:o.json=JSON.stringify(u)));var l=void 0===e.post||e.post||!1;t.api.request(a,o,l,r,s,i||null)},e.forgotPassword=function(n,r,s){e.invoke(t.urls.LOGIN_FORGOT_PASSWORD,{username:n},r,s,t.state.invalid)},e.blockComment=function(n,r,s){e.invoke(t.urls.COMMENT_PROPERTIES_ADD,{id:n,body:r},s,s)},e.blockClose=function(n,r,s){e.invoke(t.urls.BLOCKS_CLOSE,t.ext.mixin({id:n},r),s,s)},e.blockPublish=function(n,r,s){e.invoke(t.urls.BLOCKS_MAKE_PUBLIC,{id:n,children:r},s,s)},e.changeDefaultCompany=function(n,r,s){e.invoke(t.urls.USERS_CHANGE_DEFAULT_COMPANY,{id:t.state.state("user_id"),default_company_id:n},r,s)},e}),define("sb_light/api/state",["sb_light/globals","sb_light/utils/consts","sb_light/utils/ext"],function(t,e,n){function r(e){if(e){var n=e.user?e.user.id:null,r=e.company?e.company.id:null;(n!=o.state.user_id||r!=o.state.company_id)&&(o.state.user_id=e.user?e.user.id:null,o.state.company_id=e.company?e.company.id:o.state.company_id,t.queue.add(a.publish.bind(a,"state","user_id"),"sb_state_publish_state_user_id",100),t.queue.add(a.publish.bind(a,"state","company_id"),"sb_state_publish_state_company_id",100)),o.context.user=e.user||null,o.context.company=e.company||null,e.block&&(!o.state.block||t.models.raw("blocks")&&!t.queries.currentBlock())&&(o.state.block=String(e.block),t.queue.add(a.publish.bind(a,"state","block"),"sb_state_publish_state_block",100))}else o.state.user_id=null;o.state.user_id?e.company&&e.company.license&&"expired"==e.company.license.status?(t.ext.debug("setting session to payment"),o.context.session=a.session_payment):(t.ext.debug("setting session to normal"),o.context.session=a.session_normal):(t.ext.debug("setting session to unauthorized"),(a.unknown()||a.startup())&&(e.flash={notice:"Please enter your login credentials."}),o.context.session=a.session_invalid),a.authorized()||t.models.reset(),a.context("flash",e.flash),a.context("errors",e.errors)}function s(t){for(var e in u)t&&t[e]&&(d[e]=c[e]=null,u[e].timestamp=t[e].timestamp,u[e].cb(t[e]))}function i(e,n){var r=n&&n.result,s=r[e.name]||r;null===e.raw()&&s&&(t.ext.isArray(s)&&(s=s.reduce(function(t,e){return t[e.id]=e,t},{})),e._handleUpdate({added:s})),d[e.name]=!1}var a={};a.stateKeys=["session_unknown","session_normal","session_payment","session_invalid","session_disconnected","session_startup"],a.stateKeys.reduce(function(t,e,n){return t[e]=n,t},a);var o={state:{block:null,news:null,kpi:null,risk:null,tag:null,user_id:null,company_id:null},context:{flash:null,session:a.session_startup,errors:null,company:null,user:null},data:{}},u={},l={state:{},context:{},data:{}},c={},d={};a.host="",a.registerModel=function(t,e,n){var r=u;r[t.name]||(r[t.name]={timestamp:0,cb:n,urlDef:e},!a.authorized()||c||c[t.name]||(c[t.name]=a.forceModelUpdate.bindDelay(a,200,t)))},a.state=function(t,e,n){return h("state",t,e,n)},a.context=function(t,e,n){return h("context",t,e,n)},a.data=function(t,e,n){return h("data",t,e,n)},a.initState=function(t,e){return f("state",t,e)},a.initContext=function(t,e){return f("context",t,e)},a.initData=function(t,e){return f("data",t,e)},a.watchState=function(t,e,n,r){return a.watch("state",t,e,n,r)},a.watchContext=function(t,e,n,r){return a.watch("context",t,e,n,r)},a.watchData=function(t,e,n,r){return a.watch("data",t,e,n,r)},a.unwatchState=function(t,e){return a.unwatch("state",t,e)},a.unwatchContext=function(t,e){return a.unwatch("context",t,e)},a.unwatchData=function(t,e){return a.unwatch("data",t,e)},a.publish=function(e,n){var r=l[e],s=a[e](n),i=t.ext;i.debug("Publish: ",n,s),i.each(r[n],function(t){t.callback.bindDelay(null,0,s,n)}),i.each(r["*"],function(t){t.callback.bindDelay(null,0,s,n)})};var h=function(t,e,n,r){var s=o[t];if(!s.hasOwnProperty(e))throw"SBLIGHT::State - Trying to access a state property that hasn't been initialized. "+t+"::"+e;return void 0!==n?((r||s[e]!=n)&&(s[e]=n,a.publish(t,e)),a):s[e]||s["_default_"+e]||null},f=function(t,e,n){var r=o[t];"*"!==e&&(r.hasOwnProperty(e)||(r[e]=n||null),void 0!==n&&(r["_default_"+e]=n))};return a.watch=function(e,n,r,s,i){if(!r)throw"Error: callback is not defined: "+e+" "+n;f(e,n,s);var a=l[e];a[n]=a[n]||{};var o=["watch_state",e,n,t.ext.unique()].join("_");return a[n][o]={callback:r,urgent:i||!1},o},a.unwatch=function(t,e,r){var s=[],i=l[t];n.each(i[e],function(t,e){(t.callback==r||e==r)&&s.push(e)}),s.forEach(function(t){delete i[e][t]})},a.getTimestamp=function(t){var e=u;return e[t]?e[t].timestamp||0:0},a.resetTimestamp=function(t){var e=u;e[t]&&(e[t].timestamp=0)},a.login=function(e,n,r,s){var i={};e&&n&&(i.username=e,i.password=n),o.state.company_id&&(i.company_id=o.state.company_id),a.context("session",a.session_unknown);var u=t.urls.url(t.urls.LOGIN);t.queue.add(t.api.post.bind(t.api,u,i,r,s,a.unauthorized),"sblight_state_login")},a.reset=function(e){o.context.session=a.session_startup,o.context.flash=null,e&&(o.state.company_id=e),o.state.block=null,o.state.news=null,o.state.kpi=null,o.state.risk=null,o.state.tag=null,t.queue.add(t.models.reset.bind(t.models),"sblight_models_reset")},a.logout=function(){t.api.post(t.urls.url(t.urls.LOGOUT)),a.reset()},a.changeCompany=function(e){a.reset(e),t.queue.add(a.publish.bind(a,"context","session"),"sblight_state_publish_context"),t.queue.add(a.publish.bind(a,"state","company_id"),"sblight_state_publish_state")},a.forceModelUpdate=function(e){if(c[e.name]&&(clearTimeout(c[e.name]),c[e.name]=null),!d[e.name]&&a.authorized()){d[e.name]=!0;var n=u[e.name];n.timestamp=0;var r=t.urls.url(n.urlDef),s=i.bind(a,e);t.api.get(r,null,s)}},a.any=function(){return!0},a.startup=function(){return o.context.session==a.session_startup},a.known=function(){return o.context.session!=a.session_unknown},a.unknown=function(){return o.context.session==a.session_unknown||o.context.session==a.session_startup},a.unauthorized=function(){return o.context.session==a.session_unknown||o.context.session==a.session_invalid||o.context.session==a.session_startup},a.invalid=function(){return o.context.session==a.session_invalid},a.authorized=function(){return o.context.session==a.session_normal||o.context.session==a.session_payment},a.disconnected=function(){return o.context.session==a.session_disconnected},a.update=function(e){return r(e),s(e),t.queue.add(a.publish.bind(a,"context","session"),"sb_state_publish_context_session"),a.authorized()},a.getStateKey=function(e,n){var r=t.urls.s_to_o(a.state(e));return r[n]||null},a.setStateKey=function(e,n,r){var s=t.urls.s_to_o(a.state(e));null===r?delete s[n]:s[n]=r,a.state(e,t.urls.o_to_s(s))},a.addTimestamps=function(e){t.ext.debug("Adding timestamp for ",Object.keys(u).join(","));for(var n in u)e[n+"_timestamp"]=u[n].timestamp},a}),define("sb_light/api/queries",["sb_light/globals"],function(t){var e={};e.company=function(e){var n=t.models.raw("companies"),r=t.state.state("company_id");return e=e||r,e==r?t.state.context("company")||null:n&&e&&n[e]||null},e.fullname=function(t){var n=e.user(t);return n?n.name:"<removed>"},e.firstname=function(t){var n=e.user(t);return n?n.first_name:"<removed>"},e.user=function(e){var n=t.state.state("user_id");e=e||n;var r=t.models.raw("users");return r&&e&&r[e]||e==n&&t.state.context("user")||null},e.companyMembership=function(){var t=e.user();if(t.company_membership)return t.company_membership;var n=e.company();return t&&n&&t.companies[n.id]||null},e.userDate=function(n,r){var s=e.user();return t.moment(n,r).format(s.date_format)};var n="YYYY/MM/DD";e.userToServerDate=function(r){var s=e.user(),i=t.moment(r,s.date_format);return i.format(n)},e.authors=function(){var e=t.state.state("company_id");return t.models.rawArray("users").filter(function(t){var n=t.company_membership||t.companies&&t.companies[e]||null;return n&&n.active&&("Author"==n.role||"Administrator"==n.role)}).sort(t.ext.sortUsers)},e.focusArea=function(e){var n=t.models.raw("focus");return n&&n[e]||null},e.focusTitle=function(t){var n=e.focusArea(t);return n?n.title:null},e.focusDesc=function(t){var n=e.focusArea(t);return n?n.description:null},e.focusList=function(t){for(var n=[],r=e.focusArea(t);r;)n.put(r),r=e.focusArea(r.parent_id);return n},e.focusPath=function(t){var n=e.focusList(t);return n.reverse().map(function(t){return t.title}).join(" / ")},e.levelColor=function(e){var n=t.models.raw("levels"),r=n&&n[e]?n[e].color:null;return r?t.ext.to_color(r):null},e.levelName=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.levelPos=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.currentNewsItem=function(){var e=t.state.state("news"),n=t.models.raw("news");return n&&e?n[e]:null};var r=/%(users|blocks)_(\d+)%/g;e.newsMessage=function(e){var n=r,s=t.models.raw("blocks"),i=t.models.raw("users");return e.msg.replace(n,function(t,e,n){return"blocks"==e?s[n]?s[n].title:"(unknown block)":"users"==e?i[n]?i[n].name:"(unknown user)":void 0})};var s=/%users_(\d+)%/g;e.newsUsers=function(t){var e=s,n=[],r=null;do r&&n.push(r[1]),r=e.exec(t.msg);while(r);return n};var i=/%blocks_(\d+)%/g;e.newsBlocks=function(t){var e=i,n=[],r=null;do r&&n.push(r[1]),r=e.exec(t.msg);while(r);return n},e.kpi=function(e){e=e||t.state.state("kpi");var n=t.models.raw("kpis");return e&&n?n[e]:null},e.risk=function(e){e=e||t.state.state("risk");var n=t.models.raw("risks");return e&&n?n[e]:null},e.currentBlock=function(){var t=e.currentBlockPath();return t?e.block(t):null},e.previousBlock=function(){var t=e.previousBlockPath();return t?e.block(t):null},e.rootBlock=function(){var t=e.rootBlockId();return t?e.block(t):null},e.rootBlockId=function(){var t=e.company();return t&&t.root_block?t.root_block.id:null},e.currentBlockId=function(){var t=e.currentBlockPath();return t&&t.length?t.last():null},e.previousBlockId=function(){var t=e.previousBlockPath();return t&&t.length?t.last():null},e.currentBlockPath=function(n){return e.blockPath(t.state.state("block"),n)},e.currentBlockLevel=function(){return e.blockLevel(e.currentBlockPath())},e.previousBlockPath=function(n){var r=t.state.context("previousBlocks"),s=e.rootBlock(),i=r&&r.length&&r[0]||s&&s.id||null;return i?e.blockPath(i,n):null},e.previousBlockLevel=function(){return e.blockLevel(e.previousBlockPath())},e.managedBlocks=function(){return t.models.rawArray("blocks").reduce(function(t,e){return e.is_manager?t.put(e):t},[])},e.parentPath=function(t,n){return t=e.blockPath(t),t?e.blockPath(t.slice(0,-1),n):null},e.blockParentInfo=function(t){t=e.blockPath(t);var n=t?e.block(t):null;return n&&n.parents&&n.parents.length?n.parents.findKey("parent_id",t.last(1)).value:null},e.blockPath=function(t,n){if(!t)return null;t=a(t);var r=e.block(t);return r&&t.length<2&&r.parents.length>0&&(t=r.default_path),n?t.join("_"):t};var a=function(t){return"array"==typeof t?t:"number"==typeof t?[String(t)]:"string"==typeof t?t.split("_"):t};e.blockId=function(t){return t=t?a(t):null,t&&t.length?t.last():null},e.block=function(n){var r=e.blockId(n),s=t.models.raw("blocks");return r&&s&&s[r]?s[r]:null},e.blockLevel=function(t){var n=e.blockParentInfo(t||e.currentBlockPath());return n?n.level:0},e.childrenPaths=function(t,n){t=e.blockPath(t);var r=e.block(t);return r?r.children.map(function(r){return e.blockPath(t.concat([r]),n)}):null},e.parentPaths=function(n,r){var s=e.block(n);return s.paths.reduce(function(e,n){var s=t.queries.parentPath(n,r);return s&&s.length?e.put(s):e},[])},e.siblingPaths=function(n,r){var s=e.block(n);return s.paths.reduce(function(e,s){var i=t.queries.childrenPaths(t.queries.parentPath(s),r);return i?(i=i.filter(function(e){return t.queries.blockPath(e,!0)!=t.queries.blockPath(n,!0)}),e.concat(i)):e},[])},e.arePathsEqual=function(t,n){return e.blockPath(t,!0)==e.blockPath(n,!0)},e.isCenterPath=function(t){return e.currentBlockPath(!0).indexOf(e.blockPath(t,!0))>-1},e.isCurrentPath=function(t){return e.arePathsEqual(t,e.currentBlockPath())},e.maxDate=function(){return t.ext.date(e.rootBlock().end_date)},e.minDate=function(){return t.ext.date(e.rootBlock().start_date)},e.blockTarget=function(e){return e=t.ext.isStr(e)||t.ext.isArr(e)?block(e):e,e&&"new"!=e.ownership_state?e.expected_progress:0},e.blockProgress=function(e){return e=t.ext.isStr(e)||t.ext.isArr(e)?block(e):e,e&&"new"!=e.ownership_state?e.percent_progress:0},e.blockVariance=function(t){var n=e.blockProgress(t),r=e.blockTarget(t);return r>0?Math.floor(100*((n-r)/r)):100},e.dateRange=function(n){var r={minStart:t.moment(new Date(1980,1,1)),maxStart:t.moment(new Date(2038,12,31)),minEnd:t.moment(new Date(1980,1,1)),maxEnd:t.moment(new Date(2038,12,31))},s=e.block(n.default_parent),i=n.children.map(function(t){return e.block(t).start_date}).put(s?s.end_date:r.maxStart),a=n.children.map(function(t){return e.block(t).end_date}).put(s?s.start_date:r.minEnd);return r.maxStart=t.ext.minDate.apply(null,i),r.minStart=s?s.start_date:r.minStart,r.maxEnd=s&&!s.floating_end_date?s.end_date:r.maxEnd,r.minEnd=t.ext.maxDate.apply(null,a),r},e.is_link=function(t,e){return null!=o(t,e).linked_parent_id},e.custom_progress_weight=function(e,n){return t.ext.to_i(o(e,n).custom_progress_weight)};var o=function(e,n){var r=t.models.raw("blocks"),s=r[e],i=r[n];if(-1==s.children.indexOf(n))throw new Error("Block("+n+") is not a parent of block("+e+")");return i.parents.reduce(function(t,n){return n.parent_id==e?t.put(n):t},[])[0]};return e.progressVariance=function(t){var n=e.block(t);if(n){var r=n.percent_progress||100,s=n.expected_progress||0;return s>0?Math.round(100*((r-s)/s)):100}return 0},e.blockFullTree=function(n,r,s){if(s=s||t.models.raw("blocks")){t.ext.isStr(n)&&t.ext.isArr(r)&&(n=r.concat([n])),n=e.blockPath(n||e.rootBlock().default_path),r=r||[];var i=s[n.last()],a={name:i.title,data:i,path:n,children:[]},o=i.children.cloneExcept(r.last());o.map(function(t){return n.concat([t])});var u=n.last(1);u&&r.last()!=u&&o.unshift(n.slice(0,-1));var l=1;return o.forEach(function(t){var r=e.blockFullTree(t,n,s);l+=r.size,a.children.put(r)}),a.size=l,a}},e.buildStrategyTree=function(n){var r=e.currentBlockPath(),s=e.currentBlock(),i=t.models.raw("blocks");if(!r||!s||!i)return null;var a=r.reduce(function(t,e){var n=t.last()||[];return t.put(n.concat([e])),t},[]),o=-(a.length-1);if(s.children.length){var u=s.children.indexOf(n),l=s.children[0>u?0:u];a.push(a.last().concat([l]))}var c={},d=c;return a.forEach(function(n){var r=t.ext.slice(n,0,-1),s=r.last(),a=n.last(),u=s?i[s].children:[a],l=u.indexOf(a);d.children=u.map(function(t,n){var s=r.concat([t]).join("_"),a=e.blockType(s);return{path:s,dy:o,dx:n-l,data:i[t],viewType:a}}),o+=1,d=d.children[l]}),c.children[0]},e.defaultBlockType=function(e){var n=e||null,r=t.consts.blockTypes(),s=r.findKey("key",t.state.state("blockType")).value;return s=s||r[0],n?s[n]:s},e.blockType=function(n){t.state.initState("blockType","status"),t.state.initState("blockSettings",""),t.consts.blockTypes({key:"shortkey"});var r=e.defaultBlockType("shortkey"),s=t.state.getStateKey("blockSettings",n);return s&&(s=s.match(/b\w/)[0]),s||r},e}),define("sb_light/api/urls",["sb_light/globals"],function(t){var e={},n={MODEL_BLOCKS:{url:"/blocks.js",post:!1},MODEL_COMPANIES:{url:"/companies.js",post:!1},MODEL_CAPABILITIES:{url:"/company_settings.js",post:!1},MODEL_EXPORTS:{url:"/exports.js",post:!1},MODEL_FOCUS:{url:"/focus.js",post:!1},MODEL_GROUPS:{url:"/groups.js",post:!1},MODEL_KPIS:{url:"/kpis.js",post:!1},MODEL_RISKS:{url:"/risks.js",post:!1},MODEL_LEVELS:{url:"/levels.js",post:!1},MODEL_NEWS:{url:"/news.js",post:!1},MODEL_LICENSES:{url:"/licenses.js",post:!1},MODEL_PROGRESS:{url:"/blocks/progress.js",post:!1},MODEL_HEALTH:{url:"/health_calculations.js",post:!1},MODEL_NPV:{url:"/blocks/npv.js",post:!1},MODEL_RISK:{url:"/blocks/risk.js",post:!1},MODEL_USERS:{url:"/users.js",post:!1},MODEL_TAGS:{url:"/tags.js",post:!1},MODEL_TIMEZONES:{url:"/companies/timezones.js",post:!1},MODEL_DASHBOARD:{url:"/reports/dashboard_layout.js",post:!1},BLOCKS_CONTEXT:{url:"/blocks/context/%id%.js"},BLOCKS_CLOSE:{url:"/blocks/close/%id%.js",deleteId:!0},BLOCKS_MANAGE_CHILDREN:{url:"/blocks/manage_children/%id%.js",deleteId:!0},BLOCKS_DELETE:{url:"/blocks/%type%/%id%.js",normalParams:!0},BLOCKS_DOCUMENTS:{url:"/blocks/documents/%id%.js"},BLOCKS_IMPORT:{url:"/blocks/import/%id%.js"},BLOCKS_INVITE:{url:"/blocks/invite/%id%.js"},BLOCKS_MAKE_PUBLIC:{url:"/blocks/make_public/%id%.js",normalParams:!0},BLOCKS_MOVE:{url:"/blocks/move/%id%.js",normalParams:!0},BLOCKS_PROPERTIES:{url:"/blocks/%type%/%id%.js"},BLOCKS_RELOCATE:{url:"/blocks/reassign_parent/%id%.js",normalParams:!0},BLOCKS_UPDATE:{url:"/blocks/update/%id%.js",massageParamsFunc:"massageParamsForBlockUpdate"},BLOCKS_UNWATCH:{url:"/blocks/unwatch/%id%.js"},BLOCKS_WATCHING_USERS:{url:"/blocks/watching_users/%id%.js"},BLOCKS_TAGGED:{url:"/blocks_for_tag/%name%.js"},BLOCKS_UPDATE_GROUPS:{url:"/blocks/update_group_expression/%id%.js",normalParams:!0},BLOCKS_CHANGE_CHARTED_KPI:{url:"/blocks/set_default_kpi/%id%.js"},BLOCKS_UPDATE_CASHFLOWS:{url:"/blocks/update_net_cashflows/%id%.js"},BLOCKS_HEALTH:{url:"/blocks/health.js",normalParams:!0},BLOCKS_PROGRESS:{url:"/blocks/progress.js",normalParams:!0},BLOCK_FILES_UPLOAD_URL:{url:"/blocks/%id%/documents/create.js"},BLOCK_FILES_DOWNLOAD_URL:{url:"/blocks/%id%/documents/show/%doc_id%.js"},BLOCK_FILES_DELETE:{url:"/blocks/%id%/documents/destroy/%doc_id%.js"},BOOKMARKS:{url:"/saved_client_states/index.js"},BOOKMARK_CREATE_DYNAMIC:{url:"/saved_client_states/create_dynamic.js"},BOOKMARK_SAVE_DYNAMIC:{url:"/saved_client_states/%id%/save_dynamic.js",normalParams:!0},BOOKMARK_CREATE:{url:"/saved_client_states/create.js",normalParams:!0},BOOKMARK_UPDATE:{url:"/saved_client_states/%id%/update.js",normalParams:!0},BOOKMARK_DELETE:{url:"/saved_client_states/%id%/delete.js"},COMMENT_PROPERTIES_ADD:{url:"/blocks/%id%/comment.js",normalParams:!0,deleteId:!0},COMPANIES_CREATE:{url:"/companies/create.js"},COMPANIES_UPDATE:{url:"/companies/update.js"},COMPANIES_HEALTH:{url:"/health_calculations.js"},COMPANIES_HEALTH_CREATE:{url:"/health_calculations/create.js"},COMPANIES_HEALTH_UPDATE:{url:"/health_calculations/%id%/update.js"},COMPANIES_HEALTH_DELETE:{url:"/health_calculations/%id%/destroy.js"},COMPANIES_HEALTH_DEFAULT:{url:"/health_calculations/%id%/set_default.js"},COMPANIES_LOGO_PREVIEW_URL:{url:"/upload/company_logo_preview.js"},COMPANIES_REMOVE_PREVIEW_LOGO:{url:"/upload/remove_company_logo_preview.js"},CAPABILITIES_UPDATE:{url:"/company_settings/update.js"},EXPORTS_CREATE:{url:"/exports/%id%/create.js"},EXPORTS_REPORT:{url:"/exports/%id%/create.js"},EXPORTS_DELETE:{url:"/exports/%id%/destroy.js"},FOCUS_CREATE:{url:"/focus/create.js"},FOCUS_UPDATE:{url:"/focus/update/%id%.js",deleteId:!0},FOCUS_DELETE:{url:"/focus/destroy/%id%.js",deleteId:!0},FOCUS_REPARENT:{url:"/focus/reparent/%id%.js"},GROUPS_CREATE:{url:"/groups/create.js"},GROUPS_DELETE:{url:"/groups/%id%/destroy.js",deleteId:!0},GROUPS_UPDATE:{url:"/groups/%id%/update.js",deleteId:!0},GROUPS_ADD:{url:"/groups/%id%/add.js"},GROUPS_REMOVE:{url:"/groups/%id%/remove.js"},RISKS_CREATE:{url:"/risks/create.js"},RISKS_DESTROY:{url:"/risks/%id%/destroy.js"},RISKS_UPDATE:{url:"/risks/%id%/update.js"},RISKS_UPDATE_STATUS:{url:"/risks/%id%/update_status.js"},RISKS_ADD_IMPACT:{url:"/risks/%id%/add_impact.js"},RISKS_REMOVE_IMPACT:{url:"/risks/%id%/remove_impact.js"},RISKS_ATTACH_DOC:{url:"/risks/%id%/attach_document.js"},RISKS_SHOW_DOC:{url:"/risks/%id%/show_document/%doc_id%.js"},RISKS_DESTROY_DOC:{url:"/risks/%id%/destroy_document.js"},RISKS_DUMMY_REFRESH:{url:"/risks/%id%/refresh_risk.js"},RISKS_SETTINGS:{url:"/risk_profiles/update_risk_settings.js"},RISKS_MATRIX_SIZE:{url:"/risk_profiles/set_matrix_size.js"},RISKS_PROFILES_UPDATE:{url:"/risk_profiles/update_batch.js"},KPIS_CREATE:{url:"/kpis/create.js"},KPIS_DESTROY:{url:"/kpis/%id%/destroy.js"},KPIS_UPDATE:{url:"/kpis/%id%/update.js"},KPIS_ATTACH_BLOCK:{url:"/kpis/%id%/attach.js"},KPIS_DETACH_BLOCK:{url:"/kpis/%id%/detach.js"},LEVELS_UPDATE:{url:"/levels/update.js"},MEASURES_BLOCKS:{url:"/blocks/measure_values/%id%.js"},USERS_CREATE:{url:"/users/create.js"},USERS_CREATE_BATCH:{url:"/users/create_batch.js"},USERS_ADD_GROUP:{url:"/users/%id%/add_group.js",normalParams:!0},USERS_REMOVE_GROUP:{url:"/users/%id%/remove_group.js",normalParams:!0},USERS_ACTIVATE:{url:"/users/%id%/activate.js"},USERS_DEACTIVATE:{url:"/users/%id%/deactivate.js"},USERS_UPDATE:{url:"/users/%id%/update.js",deleteId:!0},USERS_REMOVE_MEMBERSHIP:{url:"/users/%id%/delete_membership.js"},USERS_CHANGE_MEMBERSHIP:{url:"/users/%id%/update_membership.js",deleteId:!0},USERS_CHANGE_DEFAULT_COMPANY:{url:"/users/%id%/change_default_company.js",normalParams:!0},REGISTER_COMPANY:{url:"/registration/register_company.js"},LOGIN:{url:"/login/auth.js"},LOGOUT:{url:"/login/logout.js"},LOGIN_FORGOT_PASSWORD:{url:"/login/forgot_password.js",normalParams:!0},LOGIN_REMEMBER_ME:{url:"/login/remember_me.js"},URL_SAVE_BOOKMARK:{url:"/users/save_bookmark.js"},PAYMENTS:{url:"/purchases/index.js"},PAYMENTS_QUOTE:{url:"/purchases/quote.js"},PAYMENTS_CREATE:{url:"/purchases/create.js"},ADMIN_RAISE:{url:"/admin/log_client_error.js"}};n.url=function(e,n){if(!e||!e.url)throw new Error("Url does not exist: "+e);n=n||{};var s=e.url;for(var i in n)s=s.replace(r(i),n[i]);if(s.indexOf("%")>-1)throw new Error("Bad url."+s);return t.state.host+s};var r=function(t){return e[t]=e[t]||new RegExp("%"+t+"%"),e[t]};return n.massageParamsForBlockUpdate=function(t){return delete t.id,t},n.s_to_o=function(e){return e?e.split("-").reduce(function(e,n){return n?t.ext.set.apply(Object,[e].concat(n.split("!"))):e},{}):{}},n.o_to_s=function(e){return t.ext.map(e,function(t,e){return[e,t].join("!")}).join("-")},n.url_to_o=function(e){var n="string"==typeof e?e.split(";"):e;return n=t.ext.isArray(n)?n:n.reduce(function(n,r){if(r="string"==typeof r?r.split("="):r,t.ext.isArray(r))n[r[0]]=r[1];else{if(!r.key)throw"URL Cannot be parsed: "+JSON.stringify(e);n[r.key]=r.value}return n},{})},n.o_to_params=function(e){return t.ext.map(e,function(t,e){return e+"="+encodeURIComponent(t)}).join("&")},n}),define("sb_light/api/api",["sb_light/globals"],function(t){function e(e,s,i){if(t.ext.debug("Sending request to ",e,i,JSON.stringify(s)),!a.ajax)throw"Error: sb.api.ajax has not been inititalized. Please set this value to one of the functions available in sb.ajax";s=s||{},t.state.addTimestamps(s),a.ajax({url:e,type:i?"POST":"GET",data:s,dataType:"json",context:a,success:n.bind(null,t.ext.slice(arguments)),error:r.bind(null,t.ext.slice(arguments))})}function n(e,n){t.ext.debug("SUCCESS: SB_Api",e,n),u=l;var r=t.state.authorized();if(t.state.update(n)){var s=t.ext.getResultMessages(n).errors;!s&&e[3]&&(e[3](n),i()),s&&e[4]&&(e[4](n),i())}else r&&(c.length=0),e[4]&&e[4](n)}function r(e,n){t.ext.debug("FAILURE SB_Api",JSON.stringify(n)),t.state.context("session",t.state.session_disconnected)}function s(e){var n=e.url+(JSON.stringify(e.params)||"");t.ext.debug("Pushing request on the queue: ",n),0==c.filter(function(t){return t.key==n}).length&&c.push({key:n,data:e})}function i(){if(o)t.ext.debug("Running Error Request"),e.apply(this,this._errorData);else if(c.length>0){var n=c.shift().data;n.state()?e.call(null,n.url,n.params,n.post,n.success,n.failure):(n.count+=1,n.count<this._maxRetries&&s.bindDelay(null,_retryDelay,n),i())}}var a={},o=null,u=50,l=50,c=[];return a.get=function(t,e,n,r,s){a.request(t,e,!1,n,r,s)},a.post=function(t,e,n,r,s){a.request(t,e,!0,n,r,s)},a.request=function(n,r,s,i,a,o){var u=o||t.state.authorized;u.call(t.state)&&e(n,r,s,i,a)},a}),define("sb_light/api/ajax",["sb_light/globals"],function(t){var e={};return e.d3=function(e){return function(n){var r=n.url.replace(/^(https?:\/\/)/,"//"),s=t.urls.o_to_params(n.data);"POST"!==n.type&&s&&(r+="?"+s);var i=e.json(r).on("load",function(t){n.success(t)}).on("error",function(t){n.error(t)});t.state.host!==window.location.host&&i.header("Access-Control-Request-Method",n.type),"POST"!==n.type?i.get():(i.header("Content-type","application/x-www-form-urlencoded"),i.post(s))}},e.dojo=function(e){return function(n){n.url=n.url.replace(/^(https?:\/\/)/,"//"),t.ext.debug("dojo ajax",n.type,n.url),e(n.url,{method:n.type,data:n.data}).then(n.success,n.error)}},e.jquery=function(e){return function(n){var r=t.state.host!=window.location.host;n.url=r?n.url.replace(/^(https?:\/\/)/,"//"):n.url.replace(/^(https?:\/\/)?.+?\//,"/"),t.ext.debug("jquery ajax",n.type,n.url),e.ajax({type:n.type,url:n.url,data:n.data,dataType:n.dataType,crossDomain:r}).done(n.success).fail(n.error)}},e.node=function(e){return function(n){t.ext.debug("Request Agent: ",e);var r="POST"===n.type?e.post(n.url).send(n.data):e.get(n.url).query(n.data);r.set("Accept","application/json").end(function(e){e.ok?(t.ext.debug("Node Ajax success!",e.text),n.success&&n.success(JSON.parse(e.text))):(t.ext.debug("Node Ajax Error",e.text),n.error&&n.error(e.text))})}},e.titanium=function(){return function(e){var n,r,s=t.ext.merge({type:"GET",url:null,data:!1,contentType:"application/json",async:!0,autoEncodeUrl:!0,success:null,error:null,beforeSend:null,complete:null},e),i=Ti.Network.createHTTPClient({autoEncodeUrl:s.autoEncodeUrl,async:s.async});if("GET"===s.type&&s.data){r=[];for(n in s.data)r.put(n+"="+encodeURIComponent(s.data[n]));s.url+="?"+r.join("&"),delete s.data}return i.open(s.type,s.url),i.setRequestHeader("Content-Type",s.contentType),s.beforeSend&&s.beforeSend(i),i.setTimeout(1e4),i.onerror=function(){return null!==s.error?s.error(this):void 0},i.onload=function(){if(this.status<400)try{if(null!==s.success){var t=JSON.parse(this.responseText);return s.success(t)}}catch(e){return Ti.API.error("XHR success function threw Exception: "+e),void 0
}else if(null!==s.error)return s.error(this)},s.data?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(s.data)):i.send(),null!==s.complete?s.complete(this):void 0}},e}),define("widgets/formInput",["widgets/widget"],function(t){var e=t.extend({create:function(){this._name="widget::formInput",this._super()},postCreate:function(){this.className("formInput"),this._super()},_propertyOverrides:function(){var t=this._super();return t.type=this.bind("type"),t.value=this.bind("value"),t.label=this.bind("label"),t.error=this.bind("error"),t},type:function(t,e){var n=this._sb.ext.slice(arguments,"type"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("input")].attr("type",e),this):this._layout.widgets[this.cid("input")].attr("type")},label:function(t,e){var n=this._sb.ext.slice(arguments,"label"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("label")].text(e),this):this._layout.widgets[this.cid("label")].text()},value:function(t,e){var n=this._sb.ext.slice(arguments,"value"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("input")].dom.value=e,this):this._layout.widgets[this.cid("input")].dom.value},error:function(t,e){var n=this._sb.ext.slice(arguments,"error"==arguments[0]?1:0);return n.length?(this._layout.widgets[this.cid("error")].text(e),this):this._layout.widgets[this.cid("error")].text()},createLayout:function(){this._defaultLayout=[{id:this.cid("center_hack"),widget:"div",fringe:"49%",style:"display:none;"},{id:this.cid("label"),widget:"label",left:0,right:this.cidDim("input","l"),height:40,top:0,text:"Test Form Widget",style:"text-align:right;padding:10px 8px;"},{id:this.cid("input"),widget:"input",left:this.cidDim("center_hack","l",-150),width:300,height:40,top:0,tabindex:1,value:"Test Input Widget",size:40,style:"padding:10px 8px"},{id:this.cid("error"),widget:"div",left:this.cidDim("input","r"),height:40,top:0,right:0,text:""}],this._super()}});return e}),define("widgets/resizer",["widgets/widget"],function(t){var e=t.extend({_dragPos:null,_dragDim:"",_dataKey:"",_min:0,_max:0,create:function(){this._name="widget::resizer",this._super()},postCreate:function(){this._super(),this.dom.addEventListener("mousedown",this.bind("_startDrag"))},_propertyOverrides:function(){var t=this._super();return t.min=this.bind("prop"),t.max=this.bind("prop"),t.dragDim=this.bind("prop"),t.dataKey=this.bind("prop"),t},createLayout:function(){this._defaultLayout=[{id:this.cid("mainBar"),widget:"div",fringe:2,style:"background-color:#FFF;border:solid 1px black;"},{id:this.cid("ghostBar"),widget:"div",fringe:3,left:4,style:"background-color:#000"}],this._super()},applyProperties:function(){this._super();var t=this.dom.getBoundingClientRect();this._dragDim=this.dragDim||(t.width>t.height?"top":"left"),this.className("left"==this.dragDim?"resizer-v":"resizer-h")},_startDrag:function(t){this._sb.events.stop(t),this._dragging=this.dim(this._dragDim),this.className("dragging"),this.dom.ownerDocument.body.addEventListener("mousemove",this.bind("_drag")),this.dom.ownerDocument.body.addEventListener("mouseup",this.bind("_stopDrag"))},_drag:function(t){var e=this.parentDom.getBoundingClientRect(),n=("left"==this._dragDim?t.clientX:t.clientY)-e[this._dragDim];n=this._sb.ext.range(this._min,this._max,n),this._sb.ext.debug("Resizer::Drag",this.id,this._dragDim,this._min,this._max,n,t.clientX,e.left),this.dim(this._dragDim,n)},_stopDrag:function(){this._sb.ext.debug("Resizer::DragDone",this.id,this._dragDim),this.className("dragging",!0),this.dom.ownerDocument.body.removeEventListener("mousemove",this.bind("_drag")),this.dom.ownerDocument.body.removeEventListener("mouseup",this.bind("_stopDrag")),this.dataKey&&this._sb.state.data(this._dataKey,this.dim(this._dragDim))}});return e}),define("widgets/pages/loginPage",["widgets/widget","widgets/formInput"],function(t,e){var n=t.extend({create:function(){this._name="widget::loginPage",this._super()},postCreate:function(){this._super(),this.dom.addEventListener("submit",this.bind("_handleSubmit"))},createLayout:function(){this._defaultLayout=[{id:this.cid("center_hack"),widget:"div",fringe:"49%",style:"display:none;"},{id:this.cid("form"),widget:"form",left:this.cidDim("center_hack",-300),right:this.cidDim("center_hack",-300),top:50,bottom:50,children:[{id:this.cid("title"),widget:"h3",text:"Welcome to StrategyBlocks",left:20,right:20,top:40,height:30,style:"text-align:center"},{id:this.cid("error"),widget:"p",left:20,right:20,top:this.cidDim("title","b",20),height:30},{id:this.cid("username"),widget:e,left:20,right:20,top:this.cidDim("error","b",20),height:30,value:"glenn.murphy@strategyblocks.com",label:"Email",error:""},{id:this.cid("password"),widget:e,left:20,right:20,top:this.cidDim("username","b",20),type:"password",value:"",height:30,label:"Password",error:""},{id:this.cid("submit"),widget:"button",type:"submit",width:80,left:"28%",height:25,top:this.cidDim("password","b",50),text:"Sign-In"}]}],this._super()},_handleSubmit:function(t){this._sb.events.stop(t);var e=this.child("username").value(),n=this.child("password").value();this._sb.state.login(e,n,this.bind("_handleSubmitResponse"),this.bind("_handleSubmitResponse"))},_handleSubmitResponse:function(t){var e=this._sb.ext.getResultMessages(t);e.errors&&t&&t.result&&t.result.errors&&result.errors.form&&(this.cid("username").error(t.result.errors.form.username),this.cid("password").error(t.result.errors.form.password)),this.child("error").text(e.errors?e.errors.message:e.warnings||e.notices||""),this.child("error").className("error",!e.errors),this.child("error").className("warning",e.errors||!e.warnings),this.child("error").className("notice",e.errors||!e.notices)}});return n}),define("widgets/main",["widgets/widget","widgets/formInput","widgets/resizer","widgets/svg","widgets/pages/loginPage"],function(t,e,n,r,s){return{widget:t,formInput:e,resizer:n,svg:r,login:s}}),define("sb_light/main",["sb_light/globals","sb_light/lib/moment","sb_light/utils/ext","sb_light/utils/dom","sb_light/utils/subman","sb_light/utils/svg","sb_light/utils/queue","sb_light/utils/events","sb_light/layout","sb_light/utils/consts","sb_light/utils/Class","sb_light/models","sb_light/controller","sb_light/api/state","sb_light/api/queries","sb_light/api/urls","sb_light/api/api","sb_light/api/ajax","widgets/main"],function(t,e,n,r,s,i,a,o,u,l,c,d,h,f,_,p,m,g,b){if(t.debug=!0,t.moment=e||this.moment||window.moment,!t.moment&&!t.moment.version)throw"Moment JS has not been loaded properly.";return t.ext=n,t.dom=r,t.subman=s,t.svg=i,t.queue=a,t.events=o,t.layout=u,t.consts=l,t.models=d,t.controller=h,t.state=f,t.queries=_,t.urls=p,t.api=m,t.ajax=g,t.Class=c,t.widgets=b,f.host="https://app.strategyblocks.com",t.ext.debug("Loaded SB: ",t.state.host),t}),define("sb_light",["sb_light/main"],function(t){return t});