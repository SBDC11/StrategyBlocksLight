/**
 * @version 0.1.0
 * 
 */

/**
 * almond 0.2.3 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

(function(){var t;(function(){if(t===void 0){t={};var e,r,n;(function(t){function s(t,e){return y.call(t,e)}function i(t,e){var r,n,s,i,o,a,u,l,c,d,h=e&&e.split("/"),f=b.map,p=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(e){for(h=h.slice(0,h.length-1),t=h.concat(t.split("/")),l=0;t.length>l;l+=1)if(d=t[l],"."===d)t.splice(l,1),l-=1;else if(".."===d){if(1===l&&(".."===t[2]||".."===t[0]))break;l>0&&(t.splice(l-1,2),l-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((h||p)&&f){for(r=t.split("/"),l=r.length;l>0;l-=1){if(n=r.slice(0,l).join("/"),h)for(c=h.length;c>0;c-=1)if(s=f[h.slice(0,c).join("/")],s&&(s=s[n])){i=s,o=l;break}if(i)break;!a&&p&&p[n]&&(a=p[n],u=l)}!i&&a&&(i=a,o=u),i&&(r.splice(0,o,i),t=r.join("/"))}return t}function o(e,r){return function(){return f.apply(t,w.call(arguments,0).concat([e,r]))}}function a(t){return function(e){return i(e,t)}}function u(t){return function(e){m[t]=e}}function l(e){if(s(g,e)){var r=g[e];delete g[e],v[e]=!0,h.apply(t,r)}if(!s(m,e)&&!s(v,e))throw Error("No "+e);return m[e]}function c(t){var e,r=t?t.indexOf("!"):-1;return r>-1&&(e=t.substring(0,r),t=t.substring(r+1,t.length)),[e,t]}function d(t){return function(){return b&&b.config&&b.config[t]||{}}}var h,f,p,_,m={},g={},b={},v={},y=Object.prototype.hasOwnProperty,w=[].slice;p=function(t,e){var r,n=c(t),s=n[0];return t=n[1],s&&(s=i(s,e),r=l(s)),s?t=r&&r.normalize?r.normalize(t,a(e)):i(t,e):(t=i(t,e),n=c(t),s=n[0],t=n[1],s&&(r=l(s))),{f:s?s+"!"+t:t,n:t,pr:s,p:r}},_={require:function(t){return o(t)},exports:function(t){var e=m[t];return e!==void 0?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:d(t)}}},h=function(e,r,n,i){var a,c,d,h,f,b,y=[];if(i=i||e,"function"==typeof n){for(r=!r.length&&n.length?["require","exports","module"]:r,f=0;r.length>f;f+=1)if(h=p(r[f],i),c=h.f,"require"===c)y[f]=_.require(e);else if("exports"===c)y[f]=_.exports(e),b=!0;else if("module"===c)a=y[f]=_.module(e);else if(s(m,c)||s(g,c)||s(v,c))y[f]=l(c);else{if(!h.p)throw Error(e+" missing "+c);h.p.load(h.n,o(i,!0),u(c),{}),y[f]=m[c]}d=n.apply(m[e],y),e&&(a&&a.exports!==t&&a.exports!==m[e]?m[e]=a.exports:d===t&&b||(m[e]=d))}else e&&(m[e]=n)},e=r=f=function(e,r,n,s,i){return"string"==typeof e?_[e]?_[e](r):l(p(e,r).f):(e.splice||(b=e,r.splice?(e=r,r=n,n=null):e=t),r=r||function(){},"function"==typeof n&&(n=s,s=i),s?h(t,e,r,n):setTimeout(function(){h(t,e,r,n)},15),f)},f.config=function(t){return b=t,f},n=function(t,e,r){e.splice||(r=e,e=[]),s(m,t)||s(g,t)||(g[t]=[t,e,r])},n.amd={jQuery:!0}})(),t.requirejs=e,t.require=r,t.define=n}})(),t.define("sb_light/globals",["require"],function(){var t={version:(new Date).getTime()},e=function(){return t};return e()}),exports.globals=t.require("sb_light/globals"),function(e){function r(t,e){return function(r){return l(t.call(this,r),e)}}function n(t){return function(e){return this.lang().ordinal(t.call(this,e))}}function s(){}function i(t){a(this,t)}function o(t){var e=this._data={},r=t.years||t.year||t.y||0,n=t.months||t.month||t.M||0,s=t.weeks||t.week||t.w||0,i=t.days||t.day||t.d||0,o=t.hours||t.hour||t.h||0,a=t.minutes||t.minute||t.m||0,l=t.seconds||t.second||t.s||0,c=t.milliseconds||t.millisecond||t.ms||0;this._milliseconds=c+1e3*l+6e4*a+36e5*o,this._days=i+7*s,this._months=n+12*r,e.milliseconds=c%1e3,l+=u(c/1e3),e.seconds=l%60,a+=u(l/60),e.minutes=a%60,o+=u(a/60),e.hours=o%24,i+=u(o/24),i+=7*s,e.days=i%30,n+=u(i/30),e.months=n%12,r+=u(n/12),e.years=r}function a(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function u(t){return 0>t?Math.ceil(t):Math.floor(t)}function l(t,e){for(var r=t+"";e>r.length;)r="0"+r;return r}function c(t,e,r){var n,s=e._milliseconds,i=e._days,o=e._months;s&&t._d.setTime(+t+s*r),i&&t.date(t.date()+i*r),o&&(n=t.date(),t.date(1).month(t.month()+o*r).date(Math.min(n,t.daysInMonth())))}function d(t){return"[object Array]"===Object.prototype.toString.call(t)}function h(t,e){var r,n=Math.min(t.length,e.length),s=Math.abs(t.length-e.length),i=0;for(r=0;n>r;r++)~~t[r]!==~~e[r]&&i++;return i+s}function f(t,e){return e.abbr=t,R[t]||(R[t]=new s),R[t].set(e),R[t]}function p(e){return e?(!R[e]&&N&&t.require("./lang/"+e),R[e]):I.fn._lang}function _(t){return t.match(/\[.*\]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function m(t){var e,r,n=t.match(U);for(e=0,r=n.length;r>e;e++)n[e]=oe[n[e]]?oe[n[e]]:_(n[e]);return function(s){var i="";for(e=0;r>e;e++)i+="function"==typeof n[e].call?n[e].call(s,t):n[e];return i}}function g(t,e){function r(e){return t.lang().longDateFormat(e)||e}for(var n=5;n--&&K.test(e);)e=e.replace(K,r);return ne[e]||(ne[e]=m(e)),ne[e](t)}function b(t){switch(t){case"DDDD":return q;case"YYYY":return z;case"YYYYY":return V;case"S":case"SS":case"SSS":case"DDD":return H;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return W;case"X":return J;case"Z":case"ZZ":return G;case"T":return Z;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return Y;default:return RegExp(t.replace("\\",""))}}function v(t,e,r){var n,s=r._a;switch(t){case"M":case"MM":s[1]=null==e?0:~~e-1;break;case"MMM":case"MMMM":n=p(r._l).monthsParse(e),null!=n?s[1]=n:r._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=e&&(s[2]=~~e);break;case"YY":s[0]=~~e+(~~e>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~e;break;case"a":case"A":r._isPm="pm"===(e+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":s[3]=~~e;break;case"m":case"mm":s[4]=~~e;break;case"s":case"ss":s[5]=~~e;break;case"S":case"SS":case"SSS":s[6]=~~(1e3*("0."+e));break;case"X":r._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":r._useUTC=!0,n=(e+"").match(te),n&&n[1]&&(r._tzh=~~n[1]),n&&n[2]&&(r._tzm=~~n[2]),n&&"+"===n[0]&&(r._tzh=-r._tzh,r._tzm=-r._tzm)}null==e&&(r._isValid=!1)}function y(t){var e,r,n=[];if(!t._d){for(e=0;7>e;e++)t._a[e]=n[e]=null==t._a[e]?2===e?1:0:t._a[e];n[3]+=t._tzh||0,n[4]+=t._tzm||0,r=new Date(0),t._useUTC?(r.setUTCFullYear(n[0],n[1],n[2]),r.setUTCHours(n[3],n[4],n[5],n[6])):(r.setFullYear(n[0],n[1],n[2]),r.setHours(n[3],n[4],n[5],n[6])),t._d=r}}function w(t){var e,r,n=t._f.match(U),s=t._i;for(t._a=[],e=0;n.length>e;e++)r=(b(n[e]).exec(s)||[])[0],r&&(s=s.slice(s.indexOf(r)+r.length)),oe[n[e]]&&v(n[e],r,t);t._isPm&&12>t._a[3]&&(t._a[3]+=12),t._isPm===!1&&12===t._a[3]&&(t._a[3]=0),y(t)}function E(t){var e,r,n,s,o,u=99;for(s=t._f.length;s>0;s--){if(e=a({},t),e._f=t._f[s-1],w(e),r=new i(e),r.isValid()){n=r;break}o=h(e._a,r.toArray()),u>o&&(u=o,n=r)}a(t,n)}function S(t){var e,r=t._i;if(X.exec(r)){for(t._f="YYYY-MM-DDT",e=0;4>e;e++)if($[e][1].exec(r)){t._f+=$[e][0];break}G.exec(r)&&(t._f+=" Z"),w(t)}else t._d=new Date(r)}function x(t){var r=t._i,n=B.exec(r);r===e?t._d=new Date:n?t._d=new Date(+n[1]):"string"==typeof r?S(t):d(r)?(t._a=r.slice(0),y(t)):t._d=r instanceof Date?new Date(+r):new Date(r)}function D(t,e,r,n,s){return s.relativeTime(e||1,!!r,t,n)}function k(t,e,r){var n=j(Math.abs(t)/1e3),s=j(n/60),i=j(s/60),o=j(i/24),a=j(o/365),u=45>n&&["s",n]||1===s&&["m"]||45>s&&["mm",s]||1===i&&["h"]||22>i&&["hh",i]||1===o&&["d"]||25>=o&&["dd",o]||45>=o&&["M"]||345>o&&["MM",j(o/30)]||1===a&&["y"]||["yy",a];return u[2]=e,u[3]=t>0,u[4]=r,D.apply({},u)}function M(t,e,r){var n=r-e,s=r-t.day();return s>n&&(s-=7),n-7>s&&(s+=7),Math.ceil(I(t).add("d",s).dayOfYear()/7)}function O(t){var e=t._i,r=t._f;return null===e||""===e?null:("string"==typeof e&&(t._i=e=p().preparse(e)),I.isMoment(e)?(t=a({},e),t._d=new Date(+e._d)):r?d(r)?E(t):w(t):x(t),new i(t))}function T(t,e){I.fn[t]=I.fn[t+"s"]=function(t){var r=this._isUTC?"UTC":"";return null!=t?(this._d["set"+r+e](t),this):this._d["get"+r+e]()}}function A(t){I.duration.fn[t]=function(){return this._data[t]}}function L(t,e){I.duration.fn["as"+t]=function(){return+this/e}}for(var I,P,C="2.0.0",j=Math.round,R={},N="undefined"!=typeof module&&module.exports,B=/^\/?Date\((\-?\d+)/i,F=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,U=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,K=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Y=/\d\d?/,H=/\d{1,3}/,q=/\d{3}/,z=/\d{1,4}/,V=/[+\-]?\d{1,6}/,W=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,G=/Z|[\+\-]\d\d:?\d\d/i,Z=/T/i,J=/[\+\-]?\d+(\.\d{1,3})?/,X=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,Q="YYYY-MM-DDTHH:mm:ssZ",$=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],te=/([\+\-]|\d\d)/gi,ee="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),re={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ne={},se="DDD w W M D d".split(" "),ie="M D H h m s w W".split(" "),oe={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return l(this.year()%100,2)},YYYY:function(){return l(this.year(),4)},YYYYY:function(){return l(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return l(~~(this.milliseconds()/10),2)},SSS:function(){return l(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+l(~~(t/60),2)+":"+l(~~t%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+l(~~(10*t/6),4)},X:function(){return this.unix()}};se.length;)P=se.pop(),oe[P+"o"]=n(oe[P]);for(;ie.length;)P=ie.pop(),oe[P+P]=r(oe[P],2);for(oe.DDDD=r(oe.DDD,3),s.prototype={set:function(t){var e,r;for(r in t)e=t[r],"function"==typeof e?this[r]=e:this["_"+r]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,r,n;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(r=I([2e3,e]),n="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[e]=RegExp(n.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,r,n;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(r=I([2e3,1]).day(e),n="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[e]=RegExp(n.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},meridiem:function(t,e,r){return t>11?r?"pm":"PM":r?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var r=this._calendar[t];return"function"==typeof r?r.apply(e):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,r,n){var s=this._relativeTime[r];return"function"==typeof s?s(t,e,r,n):s.replace(/%d/i,t)},pastFuture:function(t,e){var r=this._relativeTime[t>0?"future":"past"];return"function"==typeof r?r(e):r.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return M(t,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},I=function(t,e,r){return O({_i:t,_f:e,_l:r,_isUTC:!1})},I.utc=function(t,e,r){return O({_useUTC:!0,_isUTC:!0,_l:r,_i:t,_f:e})},I.unix=function(t){return I(1e3*t)},I.duration=function(t,e){var r,n,s=I.isDuration(t),i="number"==typeof t,a=s?t._data:i?{}:t,u=F.exec(t);return i?e?a[e]=t:a.milliseconds=t:u&&(r="-"===u[1]?-1:1,a={y:0,d:~~u[2]*r,h:~~u[3]*r,m:~~u[4]*r,s:~~u[5]*r,ms:~~u[6]*r}),n=new o(a),s&&t.hasOwnProperty("_lang")&&(n._lang=t._lang),n},I.version=C,I.defaultFormat=Q,I.lang=function(t,r){return t?(r?f(t,r):R[t]||p(t),I.duration.fn._lang=I.fn._lang=p(t),e):I.fn._lang._abbr},I.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),p(t)},I.isMoment=function(t){return t instanceof i},I.isDuration=function(t){return t instanceof o},I.fn=i.prototype={clone:function(){return I(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return I(this).utc().format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!h(this._a,(this._isUTC?I.utc(this._a):I(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(t){var e=g(this,t||I.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var r;return r="string"==typeof t?I.duration(+e,t):I.duration(t,e),c(this,r,1),this},subtract:function(t,e){var r;return r="string"==typeof t?I.duration(+e,t):I.duration(t,e),c(this,r,-1),this},diff:function(t,e,r){var n,s,i=this._isUTC?I(t).utc():I(t).local(),o=6e4*(this.zone()-i.zone());return e&&(e=e.replace(/s$/,"")),"year"===e||"month"===e?(n=432e5*(this.daysInMonth()+i.daysInMonth()),s=12*(this.year()-i.year())+(this.month()-i.month()),s+=(this-I(this).startOf("month")-(i-I(i).startOf("month")))/n,"year"===e&&(s/=12)):(n=this-i-o,s="second"===e?n/1e3:"minute"===e?n/6e4:"hour"===e?n/36e5:"day"===e?n/864e5:"week"===e?n/6048e5:n),r?s:u(s)},from:function(t,e){return I.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(I(),t)},calendar:function(){var t=this.diff(I().startOf("day"),"days",!0),e=-6>t?"sameElse":-1>t?"lastWeek":0>t?"lastDay":1>t?"sameDay":2>t?"nextDay":7>t?"nextWeek":"sameElse";return this.format(this.lang().calendar(e,this))},isLeapYear:function(){var t=this.year();return 0===t%4&&0!==t%100||0===t%400},isDST:function(){return I([this.year()]).zone()>this.zone()||I([this.year(),5]).zone()>this.zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?"string"==typeof t&&(t=this.lang().weekdaysParse(t),"number"!=typeof t)?this:this.add({d:t-e}):e},month:function(t){var e=this._isUTC?"UTC":"";return null!=t?"string"==typeof t&&(t=this.lang().monthsParse(t),"number"!=typeof t)?this:(this._d["set"+e+"Month"](t),this):this._d["get"+e+"Month"]()},startOf:function(t){switch(t=t.replace(/(.)s$/,"$1")){case"year":case"y":this.month(0);case"month":case"M":this.date(1);case"week":case"w":case"day":case"d":this.hours(0);case"hour":case"h":this.minutes(0);case"minute":case"m":this.seconds(0);case"second":case"s":this.milliseconds(0)}return("week"===t||"w"===t)&&this.day(0),this},endOf:function(t){return this.startOf(t).add(t,1).subtract("ms",1)},isAfter:function(t,r){return r=r!==e?r:"millisecond",+this.clone().startOf(r)>+I(t).startOf(r)},isBefore:function(t,r){return r=r!==e?r:"millisecond",+I(t).startOf(r)>+this.clone().startOf(r)},isSame:function(t,r){return r=r!==e?r:"millisecond",+this.clone().startOf(r)===+I(t).startOf(r)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return I.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(t){var e=j((I(this).startOf("day")-I(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},isoWeek:function(t){var e=M(this,1,4);return null==t?e:this.add("d",7*(t-e))},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},lang:function(t){return t===e?this._lang:(this._lang=p(t),this)}},P=0;ee.length>P;P++)T(ee[P].toLowerCase().replace(/s$/,""),ee[P]);T("year","FullYear"),I.fn.days=I.fn.day,I.fn.months=I.fn.month,I.fn.weeks=I.fn.week,I.fn.isoWeeks=I.fn.isoWeek,I.duration.fn=o.prototype={weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*~~(this._months/12)},humanize:function(t){var e=+this,r=k(e,!t,this.lang());return t&&(r=this.lang().pastFuture(e,r)),this.lang().postformat(r)},get:function(t){return this[t.toLowerCase()]()},as:function(t){var e=t.toLowerCase();return this["as"+e.charAt(0).toUpperCase()+e.slice(1)]()},lang:I.fn.lang};for(P in re)re.hasOwnProperty(P)&&(L(P,re[P]),A(P.toLowerCase()));L("Weeks",6048e5),I.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},I.lang("en",{ordinal:function(t){var e=t%10,r=1===~~(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+r}}),"undefined"==typeof ender&&(this.moment=I),"function"==typeof t.define&&t.define.amd&&t.define("sb_light/lib/moment",[],function(){return I})}.call(this),exports.moment=t.require("sb_light/lib/moment"),t.define("sb_light/utils/ext",["sb_light/globals"],function(t){var e={};return e._unique=0,e.unique=function(){return++e._unique},e.deprecated=function(t,e,r){console.log("Warning: ",t," is deprecated. Please use ",e," instead."),r&&console.log("Warning(2): ",r)},e.slice=function(t,e,r){return e=isNaN(e)?0:e,isNaN(r)?Array.prototype.slice.call(t,e):Array.prototype.slice.call(t,e,r)},e.debug=function(){if(t.debug){var r=[(new Date).toTimeString()].concat(e.slice(arguments)).join(" ");e.ti()?Ti.API.debug(r):"undefined"!=typeof console&&console.log(r)}},e.ti=function(){return"undefined"!=typeof Ti},e.map=function(t,r,n){var s,i,o=[];if(e.isArray(t))for(s=0,i=t.length;i>s;++s)o.push(r.call(n||this,t[s],s,t));else for(var a in t)o.push(r.call(n||this,t[a],a,t));return o},e.each=function(t,r,n){if(e.isArray(t))t.forEach(r,n);else for(var s in t)r.call(n||t,t[s],s,t)},e.set=function(t,e,r){return t[e]=r,t},e.length=function(t){return e.isArray(t)?t.length:t?Object.keys(t).length:0},e.toObject=function(t,e){return t.reduce(function(t,r){return t[r[e]]=r,t},{})},e.values=function(t,r){return e.map(t,function(t){return r?t[r]:t})},e.keys=function(t){return t?Object.keys(t):[]},e.deepClone=function(t){return JSON.parse(JSON.stringify(t))},e.valid=function(t,r){switch(r||"object"){case"object":return null!==t&&t!==void 0;case"arr":case"array":return e.isArr(t);case"func":case"function":return e.isFunc(t);case"str":case"string":return e.isStr(t)&&""!==t;case"num":case"number":return e.isNum(t)&&!isNaN(t)}},e.isArr=function(t){return"[object Array]"==Object.prototype.toString.call(t)},e.isArray=e.isArr,e.isFunc=function(t){return"[object Function]"==Object.prototype.toString.call(t)},e.isFunction=e.isFunc,e.isStr=function(t){return"[object String]"==Object.prototype.toString.call(t)},e.isString=e.isStr,e.isBool=function(t){return"[object Boolean]"==Object.prototype.toString.call(t)},e.isBoolean=e.isBool,e.isNum=function(t){return"[object Number]"==Object.prototype.toString.call(t)},e.isNumber=e.isNum,e.isDate=function(t){return"[object Date]"==Object.prototype.toString.call(t)},e._getClass={}.toString,e.caps=function(t){return t=e.isArray(t)?t:[t],t.reduce(function(t,e){return e?(t?t+" ":"")+e.charAt(0).toUpperCase()+e.slice(1):t},null)},e.capitalize=e.caps,e.replace=function(t,r){var n=t;return e.each(r,function(t,e){var r=RegExp("%"+e.toUpperCase()+"%");n=n.replace(r,t)}),n},e.time=function(){return Date.now?function(){return Date.now()}:function(){return(new Date).getTime()}}(),e.parseDate=function(){e.deprecated("ext.parseDate","ext.moment")},e.moment=function(e){return t.moment(e)},e.dateNumber=function(t){return e.moment(t).valueOf()},e.date=function(t){return e.moment(t).toDate()},e.daysDiff=function(t,r){return e.moment(t).diff(e.moment(r),"days")},e.today=function(){return new Date},e.minDate=function(){return e.moment(e.slice(arguments).sort(e.sortDate)[0])},e.maxDate=function(){return e.moment(e.slice(arguments).sort(e.sortDate).last())},e.serverFormat="YYYY/MM/DD",e.userFormat=function(){var r=t.state&&t.state.value("user");return r?r.date_format:e.serverFormat},e.serverDate=function(r){return t.moment(r||new Date).format(e.serverFormat)},e.userDate=function(r){return t.moment(r||new Date).format(e.userFormat())},e.dateFromNow=function(r,n,s){return s?"("+t.moment(r).fromNow()+")&nbsp;"+t.moment(r).format(n||e.userFormat()):t.moment(r).format(n||e.userFormat())+"&nbsp;("+t.moment(r).fromNow()+")"},e.regEmail=RegExp("([\\w-\\.]+)@((?:[\\w]+\\.)+)([a-zA-Z]{2,4})"),e.regUrl=RegExp("^https?://"),e.sortFactory=function(t,e,r){return function(n,s){var i=n?n[t]:null,o=s?s[t]:null;return e(i,o)*(r?-1:1)}},e.sortTime=function(t,r){return e.sortNumbers(e.parseDate(t).getTime(),e.parseDate(r).getTime())},e.sortNumber=function(t,e){return t-e},e.sortNumbers=e.sortNumber,e.sortDate=function(t,r){return e.daysDiff(t,r)},e.sortDates=e.sortDate,e.sortString=function(t,e){return(t+"").localeCompare(e+"")},e.sortStrings=e.sortString,e.sortBool=function(t,r){return e.sortNumber(t?1:0,r?1:0)},e.sortBoolean=e.sortBool,e.sortDateValue=function(t,r){return e.sortDate(t.date,r.date)},e.sortUsers=function(){return e.sortFunc("last_name",e.sortString)},e.sortFocus=function(){return e.sortFunc("title",e.sortString)},e.sortName=function(){return e.sortFunc("name",e.sortString)},e.sortBlocksByProgress=function(t,r){var n=t.closed,s=r.closed;if(n&&!s)return 1;if(!n&&s)return-1;var i="new"==t.ownership_state,o="new"==r.ownership_state;if(i&&!o)return 1;if(!i&&o)return-1;if(i&&o||n&&s)return e.sortString(t.title,r.title);var a=t.expected_progress,u=r.expected_progress;return!a&&u?1:a&&!u?-1:a||u?e.sortNumbers(t.percent_progress/a,r.percent_progress/u):0},e.px=function(t){return[t,"px"].join("")},e.pc=function(t){return[t,"%"].join("")},e.roundTo=function(t,r){var n=Math.pow(10,e.number(r,0));return Math.round(t*n)/n},e.floorTo=function(t,r){var n=Math.pow(10,e.number(r,0));return Math.floor(t*n)/n},e.ceilTo=function(t,r){var n=Math.pow(10,e.number(r,0));return Math.ceil(t*n)/n},e.to_i=function(t,r,n){var s=parseInt(t,r||10);return isNaN(s)?e.number(n,0):s},e.to_f=function(t,r){var n=parseFloat(t);return isNaN(n)?e.number(r,0):n},e.rand=function(t,r,n){return e.floorTo(Math.random()*(r-t+1),n)+t},e.to_color=function(t){return"#"+("00000"+(0|t).toString(16)).substr(-6)},e.number=function(t,r){return t=e.isFunc(t)?t():t,t=e.isArr(t)&&e.isFunc(t[0])?t[0].apply(null,t.slice(1)):t,isNaN(t)?r||0:t},e.max=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.NEGATIVE_INFINITY)}),r=t.reduce(function(t,e){return t>e?t:e},Number.NEGATIVE_INFINITY);return r},e.min=function(){var t=e.slice(arguments).map(function(t){return e.number(t,Number.POSITIVE_INFINITY)}),r=t.reduce(function(t,e){return e>t?t:e},Number.POSITIVE_INFINITY);return r},e.first=function(){for(var t=e.slice(arguments),r=0;t.length>r;++r)if(!isNaN(t[r]))return t[r];return 0/0},e.range=function(t,r,n){return e.max(t,e.min(r,n))},e.snapto=function(t,e){for(var r=Math.abs(t[0]-e),n=t[0],s=1;t.length>s;++s)r>Math.abs(t[s]-e)&&(r=Math.abs(t[s]-e),n=t[s]);return n},e.sum=function(){var t=e.slice(arguments).map(function(t){return e.number(t)}),r=t.reduce(function(t,r){return t+e.number(r)},0);return r},e.diff=function(){var t=e.number(arguments[0]),r=e.slice(arguments,1).map(function(t){return e.number(t)}),n=r.reduce(function(t,r){return t-e.number(r)},t);return n},e.prod=function(){var t=e.slice(arguments).map(function(t){return e.number(t,1)}),r=t.reduce(function(t,r){return t*e.number(r)},1);return r},e.compareInt=function(t,r,n){return n=e.number(n,0),n>=Math.abs(t-r)},e.absDiff=function(t,e){return Math.abs(t-e)},e.healthColor=function(t){return["#D80000","#EACF00","#0FAD00"][t.status+1]},e.healthText=function(t){return["Bad","Warning","Good"][t.status+1]},e.blockProgressFill=function(t){switch(t.progress_color){case"green":return["#176717","url(#progressGood)","url(#progressHatchGood)"];case"yellow":return["#77771B","url(#progressWarning)","url(#progressHatchWarning)"];case"red":return["#641717","url(#progressBad)","url(#progressHatchBad)"];default:return["#999","url(#progressNone)","url(#progressHatchNone)"]}},e.getResultMessages=function(t){var r={errors:null,warnings:null,notices:null};return t&&(e.isArray(t.result)?t.result.forEach(function(e){e&&e.errors&&(r.errors={form:t.result.errors,message:JSON.stringify(t.result)})}):t.result&&t.result.errors&&(r.errors={form:t.result.errors,message:JSON.stringify(t.result)}),!r.errors&&t.flash&&t.flash.error&&(r.errors={message:t.flash.error}),!r.errors&&t.errors&&t.errors.error&&(r.errors={message:t.errors.error})),r.notices=t.flash?t.flash.notice:"",r.warnings=t.flash?t.flash.warning:"",r},e.massageTA=function(t){var r=[e.today()];return t.values=t.values&&t.values.length?t.values:[{date:r[0],value:0,comment:"(today, interpolated)",interpolated:!0}],t.target=t.target&&t.target.length?t.target:[{date:r[0],value:0,comment:"(today, interpolated)",interpolated:!0}],t.values.forEach(function(t){t.date=e.date(t.date),r[r.length]=t.date}),t.values.sort(e.sortDateValue),e.daysDiff(t.values[0].date,r[0])>0?t.values.push({date:r[0],value:t.values[0].value,comment:"(today, interpolated)",interpolated:!0}):0>e.daysDiff(t.values.last().date,r[0])&&t.values.push({date:r[0],value:t.values.last().value,comment:"(today,interpolated)",interpolated:!0}),t.target.forEach(function(n){n.date=e.date(n.date),r[r.length]=n.date;var s=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_start:t.tolerance.range_end,i=t.tolerance.range_start>t.tolerance.range_end?t.tolerance.range_end:t.tolerance.range_start;n.upper=n.value+(t.tolerance.percentage?n.value*s/100:s),n.lower=n.value+(t.tolerance.percentage?n.value*i/100:i)}),t.target.sort(e.sortDateValue),e.daysDiff(t.target[0],r[0])>0?t.target.push({date:r[0],value:t.target[0],comment:"(today, interpolated)",interpolated:!0}):e.daysDiff(t.target.last(),r[0])>0&&t.target.push({date:r[0],value:t.target.last(),comment:"(today,interpolated)",interpolated:!0}),t.dates=r.sort(e.sortDate),t},e.massageKpi=function(t){t=e.massageTA(t);var r=t.values,n=t.target;Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,r.length&&n.length&&(0>e.daysDiff(t.dates[0],n[0].date)&&n.unshift({value:n[0].value,upper:n[0].upper,lower:n[0].lower,date:t.dates[0],comment:"(First value, interpolated)"}),e.daysDiff(t.dates.last(),n.last().date)>0&&n.push({value:n.last().value,upper:n.last().upper,lower:n.last().lower,date:t.dates.last(),comment:"(Last value, interpolated)"})),t.tolerance.percentage=t.tolerance.percentage||!1,t.tolerance.inverse=t.tolerance.inverse||!1;var s=t.tolerance.percentage,i=r[0].value,o=r[0].value;e.each(r,function(t){i=e.min(t.value,i),o=e.max(t.value,o)});var a=n[0].value,u=n[0].value;e.each(n,function(t){a=e.min(t.value,a),u=e.max(t.value,u)});var l,c,d=e.max(t.tolerance.range_end,t.tolerance.range_start)/(s?100:1),h=e.min(t.tolerance.range_end,t.tolerance.range_start)/(s?100:1);s?(l=a+h*a,c=u+d*u):(l=a+h,c=u+d),l=e.min(l,a)-.02*e.absDiff(a,l),c=e.max(c,u)+.02*e.absDiff(u,c),t.minY=e.min(i,a,l),t.maxY=e.max(o,u,c);var f=.05*e.absDiff(t.maxY,t.minY)||10;return t.minY-=f,t.maxY+=f,t},e.massageHealth=function(t){var r=e.map(t.historical_values,function(t,r){return{date:e.date(r),value:t}});return t.series=r.sort(e.sortDateValue),t.dates=e.values(t.series,"date"),t.dates.push(Date.parse(t.end_date)),t},e.mixin=function(t,r,n){var s=n||{};t=t||{},r=r||{};var i,o;for(i in r){o=r[i];var a=e.isArray(s)?s.indexOf(i)>=0:i in s;a||(t[i]=o)}return t},e.combine=function(t,r){t=e.isArray(t)?t.concat(e.slice(arguments,1)):e.slice(arguments);var n=t.reduce(function(t,n){var s=e.mixin(t,n,r);return s},{});return n},e.merge=function(t,r,n){return e.combine([t,r],n)},Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var r=0,n=this.length;n>r;++r)t.call(e||this,this[r],r,this)}),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var r=e.slice(arguments,1),n=this,s=function(){},i=function(){return n.apply(this instanceof s?this:t,r.concat(e.slice(arguments)))};return s.prototype=this.prototype,i.prototype=new s,i}),Function.prototype.bindDelay||(Function.prototype.bindDelay=function(t,r){var n=e.slice(arguments);n.splice(1,1);var s=this.bind.apply(this,n);return setTimeout(s,r)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var r=0,n=this.length;n>r;++r)t.call(e||this,this[r],r,this)}),Array.prototype.clone||(Array.prototype.clone=function(){return[].concat(this)}),Array.prototype.last||(Array.prototype.last=function(t){return t=this.length-1-(t||0),this.length>t&&t>=0?this[t]:null}),Array.prototype.reduce||(Array.prototype.reduce=function(t){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var e,r=0,n=this.length>>0;if("function"!=typeof t)throw new TypeError("First argument is not callable");if(2>arguments.length){if(0===n)throw new TypeError("Array length is 0 and no second argument");e=this[0],r=1}else e=arguments[1];for(;n>r;)r in this&&(e=t.call(void 0,e,this[r],r,this)),++r;return e}),Array.prototype.filter||(Array.prototype.filter=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=[],s=arguments[1],i=0;r>i;i++)if(i in e){var o=e[i];t.call(s,o,i,e)&&n.push(o)}return n}),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(s){if("object"!=typeof s&&"function"!=typeof s||null===s)throw new TypeError("Object.keys called on non-object");var i=[];for(var o in s)t.call(s,o)&&i.push(o);if(e)for(var a=0;n>a;a++)t.call(s,r[a])&&i.push(r[a]);return i}}()),Array.prototype.find||(Array.prototype.find=function(t,e){for(var r=0;this.length>r;++r)if(this[r][t]==e)return{index:r,value:this[r]};return{index:0/0,value:null}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if(0===r)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&1/0!=n&&n!=-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=r)return-1;for(var s=n>=0?n:Math.max(r-Math.abs(n),0);r>s;s++)if(s in e&&e[s]===t)return s;return-1}),Array.prototype.map||(Array.prototype.map=function(t,e){var r,n,s;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;
if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(r=e),n=Array(o),s=0;o>s;){var a,u;s in i&&(a=i[s],u=t.call(r,a,s,i),n[s]=u),s++}return n}),Array.prototype.every||(Array.prototype.every=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],s=0;r>s;s++)if(s in e&&!t.call(n,e[s],s,e))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){if(null==this)throw new TypeError;var e=Object(this),r=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments[1],s=0;r>s;s++)if(s in e&&t.call(n,e[s],s,e))return!0;return!1}),Array.prototype.put||(Array.prototype.put=function(){for(var t=e.slice(arguments);t.length;)this[this.length]=t.shift();return this}),Array.prototype.punique||(Array.prototype.punique=function(){for(var t=e.slice(arguments);t.length;){var r=t.shift();0>this.indexOf(r)&&(this[this.length]=r)}return this}),Array.prototype.cloneExcept||(Array.prototype.cloneExcept=function(){var t=e.slice(arguments);return this.reduce(function(e,r){return 0>t.indexOf(r)?e.put(r):e},[])}),Date.prototype.getMonthName=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names[this.getMonth()]},Date.prototype.getMonthNameShort=function(t){return t=t&&t in Date.locale?t:"en",Date.locale[t].month_names_short[this.getMonth()]},Date.locale={en:{month_names:["January","February","March","April","May","June","July","August","September","October","November","December"],month_names_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},e}),exports.ext=t.require("sb_light/utils/ext"),t.define("sb_light/utils/subman",["sb_light/globals"],function(t){var e={},r=[];return e.subscribe=function(e,n,s,i){var o=r.find("element",e);o.value||r.push({element:e,subs:[]});var a=o.value||r.last(),u=a.subs.some(function(t){return t.who==n&&t.what==s});if(!u)try{a.subs.push({who:n,what:s,key:n.subscribe(s,i)})}catch(l){t.ext.debug("Capture error",l)}},e.unsubscribe=function(t){var e=r.find("element",t).value;e&&e.subs.forEach(function(t){t.who.unsubscribe(t.what,t.key)})},e}),exports.subman=t.require("sb_light/utils/subman"),t.define("sb_light/utils/svg",["sb_light/globals"],function(t){var e={},r="undefined"!=typeof d3&&d3||{__missing:!0};e.ZERO=1e-6,e.initD3=function(n){var s=r.__cached||{};r=n,t.ext.each(s,function(t,r){e.extendD3(r,t)})},e.extendD3=function(t,e){return r.__missing?(r.__cached=r.__cached||{},r.__cached[t]=e,void 0):(r.selection.prototype[t]=r.transition.prototype[t]=r.selection.enter.prototype[t]=e,void 0)},e.extendD3("isD3",function(){return!0}),e.extendD3("rect",function(){var e=this,r=t.ext.slice(arguments);return r.length?(["x","y","width","height"].forEach(function(t,n){null!==r[n]&&e.dim(t,r[n])}),e):["x","y","width","height"].reduce(function(r,n){return t.ext.set(r,n,e.dim(n))},{})}),e.extendD3("subscribe",function(e,r,n){var s=this;return s.each(function(){t.subman.subscribe(this,e,r,n)}),s}),e.extendD3("cleanup",function(){var e=this;return e.each(function(){t.subman.unsubscribe(this)}),e.remove(),e}),e.extendD3("dim",function(r,n){return arguments.length>1?(e.isSvg(this.node())?this.attr(r,n):("x"==r&&(r="left"),"y"==r&&(r="top"),this.style(r,t.ext.isFunc(n)||t.ext.isString(n)?n:t.ext.px(n))),this.attr(r,e.isSvg(this.node()||t.ext.isFunc(n))?n:t.ext.px(n)),this):t.ext.to_f(e.isSvg(this.node())?this.attr(r):this.style(r))}),e.extendD3("corners",function(t,e){return arguments.length?(this.dim("rx",t),this.dim("ry",e),this):{rx:this.dim("rx"),ry:this.dim("ry")}}),e.extendD3("class",function(){var e=t.ext.slice(arguments);return e.length?(this.attr("class",e.join(" ")),this):this.attr("class")}),e.extendD3("title",function(e){var r=t.ext.slice(arguments);return r.length?this.attr("title",e):this.attr("title")}),e.extendD3("radius",function(e){var r=t.ext.slice(arguments);return r.length?this.attr("rx",e).attr("ry",e):this.attr("rx")}),e._anchorMap={left:"start",start:"start",l:"start",s:"start",center:"middle",middle:"middle",c:"middle",m:"middle",right:"end",end:"end",r:"end",e:"end"},e.extendD3("align",function(r){var n=t.ext.slice(arguments);return n.length?this.style("text-anchor",e._anchorMap[r]):this.style("text-anchor")}),e.extendD3("circle",function(t,e,r){return arguments.length?(this.dim("r",t),this.dim("cx",e),this.dim("cy",r),this):{r:this.dim("r"),cx:this.dim("cx"),cy:this.dim("cy")}}),e.extendD3("line",function(t,e,r,n){return arguments.length?(this.dim("x1",t),this.dim("x2",r),this.dim("y1",e),this.dim("y2",n),this):{x1:this.dim("x1"),y1:this.dim("y1"),x2:this.dim("x2"),y2:this.dim("y2")}}),e.d3=function(t){var e=t&&t.isD3&&t.isD3();return e?t:d3.select(t)},e.isSvg=function(t){return t&&t.ownerSVGElement!==void 0},e.multiline=function(r,n,s,i){if(n){r=e.d3(r);var o=r.attr("width"),a=n.split(" "),u=r.append("tspan");u.text(a[0]);for(var l=1;a.length>l;l++){var c=u.text();c.length,u.text(c+" "+a[l]),u.node().getComputedTextLength()>o&&(u.text(c),u=r.append("tspan").attr("x",t.ext.number(s,10)).attr("dy",t.ext.number(i,18)).text(a[l]))}return r}},e.gridPath=function(t,e,r,n,s,i){var o=[],a=this,u="number"==typeof s?d3.range(t+s,t+r,s):s;i=i||s;var l="number"==typeof i?d3.range(e+i,e+n,i):i;return u.forEach(function(t){o.put(a.M(t,e),a.v(n))}),l.forEach(function(e){o.put(a.M(t,e),a.h(r))}),o.join("")},e.popupPath=function(t,e,r,n,s){var i=10,o=2*i,a=15,u=2*a,l=15,c=this;s=s||"TM";var d=[];if("T"==s.charAt(0)){switch(d.put(c.M(t+i,e)),s.charAt(1)){case"L":d.put(c.l(a,-l),c.l(a,l),c.h(r-u-o));break;case"M":d.put(c.h((r-o-u)/2),c.l(a,-l),c.l(a,l),c.h((r-o-u)/2));break;case"R":d.put(c.h(r-u-o),c.l(a,-l),c.l(a,l))}d.put(c.q(i,0,i,i),c.v(n-o)),d.put(c.q(0,i,-i,i),c.h(o-r)),d.put(c.q(-i,0,-i,-i),c.v(o-n)),d.put(c.q(0,-i,i,-i))}else"R"==s.charAt(0)||"B"==s.charAt(0)||"L"==s.charAt(0);return d.join("")},e.transform=function(t){var e=[];return t.r&&e.put(this.rotate.apply(this,t.r)),t.s&&e.put(this.scale.apply(this,t.s)),t.t&&e.put(this.translate.apply(this,t.t)),e.join(" ")};var n=",";e.translate=function(t,e){return(isNaN(e)?["translate(",t,")"]:["translate(",t,", ",e,")"]).join("")},e.scale=function(t,e){return(isNaN(e)?["scale(",t,")"]:["scale(",t,", ",e,")"]).join("")},e.rotate=function(t){return"rotate("+t+")"},e.viewBox=function(t,e,r,n){return[t,e,r,n].join(" ")},e.l=function(t,e){return["l",t,n,e].join("")},e.L=function(t,e){return["L",t,n,e].join("")},e.m=function(t,e){return["m",t,n,e].join("")},e.M=function(t,e){return["M",t,n,e].join("")},e.h=function(t){return["h",t].join("")},e.H=function(t){return["H",t].join("")},e.v=function(t){return["v",t].join("")},e.V=function(t){return["V",t].join("")},e.q=function(t,e,r,s){var i=n;return["q",t,i,e,i,r,i,s].join("")},e.Q=function(t,e,r,s){var i=n;return["Q",t,i,e,i,r,i,s].join("")},e.path=function(){return t.ext.slice(arguments).join("")},e.append=function(t,r,n){t=e.d3(t);var s=t.select(r);if(s.empty()){s=t;var i=r.split(" ");i.forEach(function(t){if(t&&t.length>0)if(s.select(t).empty()){var e=t.split(".");s=s.append(e.shift()).attr("class",e.join(" "))}else s=s.select(t)}),n&&n(s)}return s},e.remove=function(t,r){t=e.d3(n);var n=t.select(r);n.empty()||n.remove()},e.dims=function(t,e,r,n,s){return s.attr("x",t).attr("y",e).attr("width",r).attr("height",n),s},e.dim=function(e,r,n){return 3==arguments.length?e.attr(r,n):t.ext.to_f(e.attr(r))},e.style=function(t){for(var e=1;arguments.length>e;e+=2){var r=arguments[e];r=s[r]||r,t.style(r,arguments[e+1])}return t};var s={t:"font",f:"fill",fo:"fill-opacity",s:"stroke",so:"stroke-opacity",sw:"stroke-width",slc:"stroke-linecap",slj:"stroke-linejoin",sda:"stroke-dasharray",ta:"text-anchor"};return e}),exports.svg=t.require("sb_light/utils/svg"),t.define("sb_light/utils/queue",["sb_light/globals"],function(t){var e={},r=[],n=[],s=0,i=function(){e.next(),i=function(){}};e.interval=function(t){return arguments.length&&(s=t),s},e.add=function(e,n,s){s=t.ext.number(s,0),n=n||"queued_"+t.ext.unique();var o=r.find("name",n).value;o||(r.push({name:n,func:e,time:t.ext.time(),delay:s}),i())},e.high=function(e,r,s){s=t.ext.number(s,0),r=r||"queued_"+t.ext.unique();var o=n.find("name",r).value;o||(n.push({name:r,func:e,time:t.ext.time(),delay:s}),i())},e.next=function(){o(n)||o(r),e.next.bindDelay(e,s)};var o=function(e){for(var r=t.ext.time(),n=e.length,s=0,i=!1,o=[];n>s&&!i;){var a=e.shift();r-a.time>a.delay?(a.func(),i=!0):o.push(a),s+=1}return e.unshift.apply(e,o),i};return e.report=function(){n.map(function(t){return t.name}).join(" "),r.map(function(t){return t.name}).join(" ")},e}),exports.queue=t.require("sb_light/utils/queue"),t.define("sb_light/utils/events",["sb_light/globals"],function(){var t={};return t.stop=function(t){t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),t&&t.preventDefault&&t.preventDefault()},t}),exports.events=t.require("sb_light/utils/events"),t.define("sb_light/utils/Class",[],function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;return this.Class=function(){},Class.extend=function(r){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var i=new this;t=!1;for(var o in r)i[o]="function"==typeof r[o]&&"function"==typeof s[o]&&e.test(r[o])?function(t,e){return function(){var r=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=r,n}}(o,r[o]):r[o];return n.prototype=i,n.prototype.constructor=n,n.extend=arguments.callee,n},Class}),exports.Class=t.require("sb_light/utils/Class"),t.define("widgets/widget",["sb_light/utils/Class"],function(t){var e=t.extend({_sb:null,_dom:null,_def:null,_domFuncs:null,_sizeFuncs:null,_sizeDefs:null,_parent:null,_name:null,_events:null,_binds:null,_props:null,init:function(t,e,r){this._sb=t,this._props=this._buildPropsList(),this._binds={},this._sizeFuncs={},this._sizeDefs={},this._parent=e,this._def=r,this._domFuncs=this._propertyOverrides();try{this.create(),this.postCreate()}catch(n){throw console.log("Failed to create widget "+r.id+" "+JSON.stringify(n.message?n.message+"\n"+n.source:n)),Error("Failed to create widget "+r.id+" "+JSON.stringify(n.message?n.message+"\n"+n.source:n))}},bind:function(t){if(!this._binds[t]){if(!this[t])throw Error("SB_Light Widget ("+t+") is not a function of : "+this.id());this._binds[t]=this[t].bind(this)}return this._binds[t]},_buildPropsList:function(){var t=[];for(var e in this)t.push(e);return t.join(",")},has:function(t){var e=RegExp("(^|,)_?"+t+"(,|$)");return this._props.match(e)},create:function(){this._dom=this.createDom(this._def),this.parentDom().appendChild(this._dom)},postCreate:function(){this.applyProperties()},dom:function(){return this._dom},id:function(){return this._def.id||this._dom.id},name:function(){return this._name||this._def.widget},parentId:function(){return this._parent?this._sb.ext.isFunc(this._parent.id)?this._parent.id():this._parent.id:null},parentDom:function(){return this._parent?this._sb.ext.isFunc(this._parent.dom)?this._parent.dom():this._parent:null},cid:function(t){return[this.id(),t].join("_")},_dims:{b:"bottom",l:"left",r:"right",t:"top",h:"height",w:"width",f:"fringe"},_dimReg:/left|right|top|bottom|height|width|fringe/,cidDim:function(t,e,r){var n=(this._dims[e]||e||"")+"",s=["@",this.cid(t)],n=n.match(this._dimReg)?n:null,i=2!=arguments.length||n?r||0:e;return n&&s.put("#",n),s.put("#",i),s.join("")},_noop:function(){},_propertyOverrides:function(){return{"default":this.bind("property"),subscribe:this.bind("subscribe"),css:this.bind("cssText"),style:this.bind("cssText"),widget:this._noop,"widget-name":this.bind("dataProperty"),"class":this.bind("className"),children:this._noop,text:this.bind("text"),left:this._noop,right:this._noop,top:this._noop,bottom:this._noop,x:this._noop,y:this._noop,height:this._noop,width:this._noop,fringe:this._noop}},appendChild:function(t){this._dom&&t&&this._dom.appendChild(t)},createDom:function(t){if(!t.widget)throw Error("The 'widget' option must be specified, and be the name of a valid HTML element.");return document.createElement(t.widget)},applyProperties:function(){this._def["class"]=(this._def["class"]||"")+" sb_light_widget",this._def["widget-name"]=this.name();for(var t in this._def){var e=this._domFuncs[t]||this._domFuncs["default"];e(t,this._def[t])}},prop:function(t,e){var r;if(r=this.has("_"+t)?"_"+t:t,!this.has(r))throw Error("SB_Light Widget ("+t+") is not a property of : "+this._name);return arguments.length>1?(this[r]=e,this):this[r]},source:function(t,e){return arguments.length>1?(this._def[t]=e,this):this._def[t]===void 0?null:this._def[t]},className:function(){var t=this._sb.ext.slice(arguments,"class"==arguments[0]?1:0);if(t.length){var e=this.dom();return t[0].split(" ").forEach(function(r){if(""!==r){var n=e.className.replace(r," ");e.className=n+(t[1]?"":" "+r)}}),this}return this.dom().className},property:function(t,e){return arguments.length>1?(this._dom.setAttribute(t,e),this):this._dom.getAttribute(t)},subscribe:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0),e=t[0];for(var r in e){var n=e[r];if(!this._events[r])throw Error("SB_Light Widget ("+this._name+") does not provide the event: "+r);this._events[r]=this._events[r]||{},this._events[r][n.id]=n.func}},unsubscribe:function(t,e){this._events&&this._events[t]&&delete this._events[t][e]},trigger:function(t){if(this._sb.ext.slice(arguments,2),this._events&&this._events[t])for(var e in this._events[t])this._sb.queue.add(this._events[t][e])},dataProperty:function(t,e){this.property.call(this,"data-"+t,e)},cssText:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.style.cssText=t[0],this):this._dom.style.cssText},text:function(){var t=this._sb.ext.slice(arguments,arguments.length>1?1:0);return t.length?(this._dom.textContent=t[0],this):this._dom.textContent},sizeDefs:function(t,e){return arguments.length>1?(this._sizeDefs[t]=e,this):this._sizeDefs[t]},sizeFuncs:function(t,e){return arguments.length>1?(this._sizeFuncs[t]=e,this):this._sizeFuncs[t]},applyLayout:function(){this.dom();var t=this.bind("dim");this._sb.ext.px;var e=this.bind("sizeFuncs");["left","top","width","height"].forEach(function(r){t(r,e(r)())}),this._sb.queue.add(this.bind("handleResize"),"handleResize_"+this.id())},handleResize:function(){},_provideEvents:function(){var t=this._sb.ext.slice(arguments);this._events=this._events||{};for(var e=0;arguments.length>e;++e)this._events[t]={}},dim:function(t,e){return arguments.length>1?(this.dom().style[t]=this._sb.ext.isStr(e)?e:this._sb.ext.px(e),this):this._sb.ext.to_i(this.dom().style[t])},rect:function(){return{x:this.dim("left"),y:this.dim("top"),width:this.dim("width"),height:this.dim("height")}}});return e}),exports.widget=t.require("widgets/widget"),t.define("widgets/svg",["widgets/widget"],function(t){var e=t.extend({_d3:null,_pd3:null,_svgDiv:null,_children:null,_rootElement:null,_dispatcher:null,_width:null,_height:null,_left:null,_top:null,init:function(t,e,r,n){if(!d3)throw"You need to load the d3.js library to use SVG widgets";this._rootElement=n||(t.ext.isStr(r.widget)?r.widget:"svg"),this._super(t,e,r)},create:function(){this._name=this._name||this._rootElement+" "+this.id(),this._children={},this._dispatches=this._dispatches||{},this._pd3=d3.select(this.parentDom()),this._d3=this.createDom(this._def),this._dom=this._d3.node(),this.createChildren(this.childrenLayout())},postCreate:function(){var t=this._sb.ext.keys(this._def.dispatches);t.length&&(this._dispatcher=d3.dispatch.apply(d3,t)),this._super()},pd3:function(){return this._pd3},d3:function(){return this._d3},parentId:function(){return this.pd3().attr("id")},_propertyOverrides:function(){var t=this._super(),e=this;return t["default"]=this.bind("attr"),t.style=this.bind("css"),t.dispatches=this.bind("dispatches"),this._sb.ext.mixin(t,["stroke","stroke-width","stroke-linecap","stroke-opacity","stroke-linejoin","stroke-dasharray","fill","fill-opacity","text-anchor"].reduce(function(t,r){return t[r]=e.bind("style"),t},{})),this._sb.ext.mixin(t,["left","top","width","height"].reduce(function(t,r){return t[r]=e.bind("prop"),t},{})),t},childrenLayout:function(){return null},createChildren:function(t){try{var r;t=this._sb.ext.isArr(t)?t:t?[t]:[];for(var n=0;t.length>n;++n)r=t[n],r.id=this._sb.layout.uniqueId(r),this._children[r.id]=this._sb.ext.isString(r.widget)?new e(this._sb,this.dom(),r):new r.widget(this._sb,this.dom(),r),r.children&&this._children[r.id].createChildren(r.children)}catch(s){throw["SB_Light::SVG::create ",s.message,r.id].join(" -- ")}},child:function(t){return this._children[t]||this._children[this.cid(t)]||null},appendChild:function(){},createDom:function(t){if(!t.widget)throw"The 'widget' option must be specified, and be the name of a valid HTML element.";return"svg"!=this._rootElement||this.parentDom().ownerSVGElement||(this._svgDiv=this.pd3().append("div").attr("class","sb_light_widget")),(this._svgDiv||this.pd3()).append(this._rootElement)},attr:function(){return this.d3().attr.apply(this._d3,arguments)},style:function(){return this.d3().style.apply(this._d3,arguments)},css:function(){return this._svgDiv?this.cssText.apply(this,arguments):this.style.apply(this,arguments)},text:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);return this.d3().text.apply(this.d3(),t)},className:function(){var t=this._sb.ext.slice(arguments,"class"==arguments[0]||"className"==arguments[0]?1:0),e=this._svgDiv||this._d3;if(t.length){var r=t[0].split(/\s/);return r.forEach(function(r){e.classed(r,t[1]!==!0)}),this}return e.attr("class")},dispatches:function(){var t=this._sb.ext.slice(arguments,2==arguments.length?1:0);if(t.length){var e=t[0];for(var r in e)this._dispatcher.on(r,e[r]);return this}return this._dispatches},dispatch:function(t,e,r,n){this._dispatcher&&this._dispatcher[t]&&this._dispatcher[t].apply(e,[r,n])},dispatcher:function(){return this._dispatcher},applyLayout:function(){(this._svgDiv||this._d3).node();var t=this.bind("dim");this._sb.ext.px;var e=this.bind("sizeFuncs");["left","top","width","height"].forEach(function(r){var n=e(r);n&&t(r,n())}),this.redraw()},handleResize:function(){this.redraw()},redraw:function(){},dim:function(t,e){if(t.match(/left|top|width|height/)&&this.prop.apply(this,this._sb.ext.slice(arguments)),this._svgDiv){if(arguments.length>1)return this._svgDiv.style(t,this._sb.ext.px(e)),t.match(/width|height/)&&this.d3().attr(t,e),this}else if(arguments.length>1)return this.d3().attr(t,e),this;return this.prop(t)},rect:function(){return this._super()}});return e}),exports.svg=t.require("widgets/svg"),t.define("sb_light/layout",["sb_light/globals","widgets/widget","widgets/svg"],function(t,e,r){var n={};n.init=function(){},n.create=function(n,s){try{var i;if(t.ext.isStr(s.widget))i="svg"==s.widget?new r(t,n,s):new e(t,n,s);else{var o=s.widget;i=new o(t,n,s)}return i}catch(a){throw console.log(["SB_Light::Layout::create ",JSON.stringify(a),s.id].join(" -- ")),Error(["SB_Light::Layout::create ",JSON.stringify(a),s.id].join(" -- "))}},n.parse=function(t,e,r){var i=t.ownerDocument?t.getBoundingClientRect():t.rect(),o={root:t,widgets:{},rootWidth:i.width,rootHeight:i.height};return s(null,e,o),r||n.resize(o),o},n.resize=function(t){l(t),d(t),p(t)},n.change=function(t,e,r,s,i){t.widgets[e].source(r,s),i||n.resize(t)},n.uniqueId=function(e){return e.id||(e.id="unknown_"+t.ext.unique()),e.id};var s=function(e,r,i){var o=e?i.widgets[e]:i.root;if(!o)throw Error("Warning: missing parent id",e);r=t.ext.isArray(r)?r:[r],r.forEach(function(t,e){t.id=n.uniqueId(t),t.style=t.style||"",t.style=t.style+(t.style.match("/z-index/")?"":";z-index:"+e);var r=n.create(o,t);i.widgets[t.id]=r,t.children&&t.children.length&&("svg"==t.widget?r.createChildren(t.children):s(t.id,t.children,i))})},i=/^@(.+?)(#(left|right|top|bottom|height|width))?(#(-?\d+))?$/,o=/^(-?\d+)([^0-9]+)?$/,a=["left","right","top","bottom","height","width"],u=["top","bottom","height"],l=function(e){for(var r in e.widgets){var n=e.widgets[r];e.widgets[n.parentId()]||null;var s=n.sizeDefs.bind(n),i=t.ext.valid;a.forEach(function(t){s(t,n.source(t))}),i(s("left"))&&i(s("width"))&&i(s("right"))&&s("right",null),i(s("top"))&&i(s("bottom"))&&i(s("height"))&&s("bottom",null);var o=i(n.source("fringe"))?n.source("fringe"):0;i(s("left"))||i(s("width"))&&i(s("right"))||s("left",o),i(s("right"))||i(s("width"))&&i(s("left"))||s("right",o),i(s("top"))||i(s("height"))&&i(s("bottom"))||s("top",o),i(s("bottom"))||i(s("height"))&&i(s("top"))||s("bottom",o)}},c=function(t){return u.indexOf(t)>-1},d=function(e){for(var r in e.widgets){var n=e.widgets[r],s=n.sizeFuncs.bind(n),u=e.widgets[n.parentId()]||null,l=n.parentId()||"_root",d=u&&u.sizeFuncs.bind(u)||null,p=d?[d,"width",l+"@width"]:e.rootWidth,_=d?[d,"height",l+"@height"]:e.rootHeight,m=t.ext.valid;a.forEach(function(a){var u=n.sizeDefs(a)+"",l=u?u.match(i):null,d=u.match(o);if(d)3==d.length&&"%"==d[2]?(d=t.ext.to_f(d[1])/100,s(a,h(r,a,t.ext.prod,c(a)?_:p,d))):2!=d.length&&m(d[2])||(d=t.ext.to_f(d[1]),s(a,h(r,a,t.ext.sum,d)));else if("auto"==u)s(a,f(r,a,n,e));else{if(!l)return"width"==a?s(a,h(r,a,t.ext.diff,p,[s,"left",r+"@left"],[s,"right",r+"@right"])):"height"==a?s(a,h(r,a,t.ext.diff,_,[s,"top",r+"@top"],[s,"bottom",r+"@bottom"])):"left"==a?s(a,h(r,a,t.ext.diff,p,[s,"width",r+"@width"],[s,"right",r+"@right"])):"top"==a?s(a,h(r,a,t.ext.diff,_,[s,"height",r+"@height"],[s,"bottom",r+"@bottom"])):"right"==a?s(a,h(r,a,t.ext.diff,p,[s,"width",r+"@width"],[s,"left",r+"@left"])):"bottom"==a&&s(a,h(r,a,t.ext.diff,_,[s,"height",r+"@height"],[s,"top",r+"@top"])),void 0;var g=l[1]&&e.widgets[l[1]]?l[1]:null,b=m(l[3])?l[3]:a,v=m(l[5])?t.ext.to_f(l[5],0):0,y=e.widgets[g];if(!y)throw Error("SB_LIGHT::Layout: No element found matching the definition:"+u+". Please check your layout definition.");var w=y.sizeFuncs.bind(y);"right"==b&&"left"==a?s(a,h(r,a,t.ext.sum,[w,"left",g+"@left"],[w,"width",g+"@width"],v)):"left"==b&&"right"==a?s(a,h(r,a,t.ext.sum,[w,"right",g+"@right"],[w,"width",g+"@width"],v)):"bottom"==b&&"top"==a?s(a,h(r,a,t.ext.sum,[w,"top",g+"@top"],[w,"height",g+"@height"],v)):"top"==b&&"bottom"==a?s(a,h(r,a,t.ext.sum,[w,"bottom",g+"@bottom"],[w,"height",g+"@height"],v)):s(a,h(r,a,t.ext.sum,[w,b,g+"@"+b],v))}})}},h=function(e,r,n){var s=e+":"+r,i=t.ext.slice(arguments,3);return function(e){if(e=e||"Chain: ",e.match(s))throw Error("sb_light::utils::layout Error -- Circular dependancy ("+e+") "+s);var r=i.map(function(r){return t.ext.isArr(r)?[r[0](r[1]),e+"_"+s+(r[2]?"("+r[2]+")":"")]:r}),o=n.apply(n,r);return o}},f=function(e,r,n,s){var i=e+":"+r;return n.dim(r,"auto"),function(o){if(o=o||"Chain: ",o.match(i))throw Error("sb_light::utils::layout Error -- Circular dependancy ("+o+") "+i);var a=[];for(var u in s.widgets){var l=s.widgets[u],c=l.sizeFuncs.bind(l);l.parentId()==e&&a.push(function(){return"width"==r?c("left")(o+"_"+i+"_"+u+"@"+r)+c("width")(o+"_"+i+"_"+u+"@"+r):"height"==r?c("top")(o+"_"+i+"_"+u+"@"+r)+c("height")(o+"_"+i+"_"+u+"@"+r):"left"==r?c("left")(o+"_"+i+"_"+u+"@"+r):"top"==r?c("top")(o+"_"+i+"_"+u+"@"+r):void 0})}if(a.length)return"width"==r||"height"==r?t.ext.max.apply(null,a):t.ext.min.apply(null,a);var d=n.parentId(),h=s.widgets[d]||null,f=h?h.dom():s.root.dom()||s.root||null,p=n.dom().getBoundingClientRect(),_=f?f.getBoundingClientRect():{left:0,top:0,bottom:0,right:0,width:0,height:0},m=h?h.sizeFuncs("height")(o+"_"+i):s.rootHeight,g=h?h.sizeFuncs("width")(o+"_"+i):s.rootWidth;return"bottom"!==r&&"right"!=r?p[r]:"bottom"==r?m-p.height-(p.top-_.top):g-p.width-(p.left-_.left)}},p=function(e){for(var r in e.widgets){var n=e.widgets[r];n.sizeFuncs.bind(n),t.ext.roundTo,n.applyLayout()}};return n}),exports.layout=t.require("sb_light/layout"),t.define("sb_light/utils/consts",["sb_light/globals"],function(){var t={};return t.COLOR={BLOCK:{green:"#176717",yellow:"#77771B",red:"#641717"}},t.STATE={BLOCK:"block",BLOCK_TREE_ZOOM:"blockTreeZoom",BLOCK_MAP_ZOOM:"blockMapZoom",CHILD_BLOCK:"childBlock",BLOCK_SETTINGS_VIEW:"blockSettingsView",BLOCK_SETTINGS_COLLAPSE:"blockSettingsCollapse",BLOCKS_TREE_VIEW:"blocksTreeView",BLOCKS_MAP_VIEW:"blocksMapView",BLOCKS_TIMELINE_VIEW:"blocksTimelineView",MANAGE_BLOCK_VIEW:"manageBlockView",PAGE:"page",USER_ID:"userId",COMPANY_ID:"companyId",COMPANY:"company",USER:"user",SESSION:"session",PREV_PAGE:"previousPage",PREV_BLOCK:"previousBlock"},t.BLOCK_SETTINGS={VIEW:{DEFAULT:{name:"Default",key:"bd"},STATUS:{name:"Status",key:"bs"},PROGRESS:{name:"Progress",key:"bp"},HEALTH:{name:"Health",key:"bh"},KPI:{name:"Outputs",key:"bk"},RISK:{name:"Risk",key:"br"},NPV:{name:"Value",key:"bn"}},COLLAPSE:"c"},t.BLOCKS_MAP={VIEW:{RADIAL:"radial",HIERARCHY:"hierarchy"}},t.BLOCKS_TREE={VIEW:{STATUS:t.BLOCK_SETTINGS.VIEW.STATUS.key,PROGRESS:t.BLOCK_SETTINGS.VIEW.PROGRESS.key,HEALTH:t.BLOCK_SETTINGS.VIEW.HEALTH.key,KPI:t.BLOCK_SETTINGS.VIEW.KPI.key,RISK:t.BLOCK_SETTINGS.VIEW.RISK.key,NPV:t.BLOCK_SETTINGS.VIEW.NPV.key}},t.BLOCKS_TIMELINE={VIEW:{CHART:"chart",TABLE:"table"}},t.MANAGE_BLOCK={VIEW:{BLOCK:"block",NEW_CHILD:"newChild",EDIT_CHILD:"editChild",CHILDREN_LIST:"childrenList",NEW_LINK:"newLink",EDIT_LINK:"editLink"}},t.SIZES={BLOCK_WIDTH:350,BLOCK_HEIGHT:185,BLOCK_HEIGHT_SMALL:150,BLOCK_PADDING_X:80,BLOCK_PADDING_Y:90},t}),exports.consts=t.require("sb_light/utils/consts"),t.define("sb_light/models/_abstractModel",["sb_light/utils/Class"],function(t){var e=t.extend({name:null,_sb:null,_model:null,_modelArray:null,_urlDef:null,_selectQueue:null,_subscriptions:null,init:function(t,e,r){if(!e)throw Error("AbstractModel: Model name must be declared");if(!r)throw Error("AbstractModel: Model urlDef must be declared");this._sb=t,this.name=e,this._urlDef=r,this._selectQueue=[],this._subscriptions={},this._sb.state.register(this,this._urlDef,this._handleUpdate.bind(this))},reset:function(t){this._model=null,this._modelArray=null,this._sb.state.resetTimestamp(this.name),t&&this._publish()},isValid:function(){return null!=this.get()},get:function(){return this._model?this._modelArray:(this._sb.ext.debug("Getting the "+this.name+" model."),this._sb.state.authorized()&&(this._sb.ext.debug("Forcing the update"),this._sb.state.forceModelUpdate(this)),null)},raw:function(){return this._model},rawArray:function(){return this._modelArray},subscribe:function(t){var e="Sub_"+this.name+"_"+this._sb.ext.unique();this._subscriptions[e]=t;var r=this.get();return r&&this._sb.queue.add(t,e,0),e},unsubscribe:function(t){var e=this._sb.ext,r=[],n=this._subscriptions;e.each(n,function(e,n){(e==t||n==t)&&r.push(n)}),r.forEach(function(t){delete n[t]})},_publish:function(){this.get();var t=this._sb.queue;this._sb.ext.each(this._subscriptions,function(e,r){t.add(e,r,0)})},select:function(t,e,r){this._selectQueue.push({type:t,cb:e,func:r}),this._processQueue()},_handleUpdate:function(t){this._processResponse(t),this._model&&(this._publish(),this._processQueue())},_processQueue:function(){var t=this.get();if(t)for(;this._selectQueue.length;){var e=this._selectQueue.pop();switch(e.type){case"map":e.cb(this._model);break;case"all":e.cb(t);break;case"filter":e.cb(t.filter(e.func))}}},_processResponse:function(t){this._model=this._model||{},this._sb.ext.debug("Processin Model",this.name),this._addItems(t.added),this._updateItems(t.updated),this._deleteItems(t.deleted),this._massageUpdatedModel(),this._resetArrayCache()},_addItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_updateItems:function(t){t=t||{};for(var e in t)this._model[e]=t[e]},_deleteItems:function(t){var e=this._model;t=t||[];var r=this;t.forEach(function(t){e[t]&&r._sb.ext.debug("Deleting Model",r.name,t),delete e[t]})},_massageUpdatedModel:function(){},_resetArrayCache:function(){this._modelArray=this._sb.ext.map(this._model,function(t){return t})}});return e}),exports._abstractModel=t.require("sb_light/models/_abstractModel"),t.define("sb_light/models/tagsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"tags",t.urls.MODEL_TAGS)}});return e}),exports.tagsModel=t.require("sb_light/models/tagsModel"),t.define("sb_light/models/newsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"news",t.urls.MODEL_NEWS)},_massageUpdatedModel:function(){this._super()}});return e}),exports.newsModel=t.require("sb_light/models/newsModel"),t.define("sb_light/models/usersModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"users",t.urls.MODEL_USERS)},_massageUpdatedModel:function(){this._super();for(var t in this._model){var e=this._model[t];e.name=e.first_name+" "+e.last_name}}});return e}),exports.usersModel=t.require("sb_light/models/usersModel"),t.define("sb_light/models/blocksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({_progress:null,_health:null,_npv:null,_npv_queue:null,_progress_queue:null,_health_queue:null,_properties:null,_propertiesList:["comments","news","tags","documents","context","watching_users"],init:function(t){this._npv_queue=[],this._progress_queue=[],this._health_queue=[],this._properties={},this._dataHandlers={_health:this._massageHealth,_progress:this._massageProgress,_npv:this._massageNpv},this._super(t,"blocks",t.urls.MODEL_BLOCKS)},_handleUpdate:function(t){this._progress=null,this._health=null,this._npv=null,this._super(t)},_massageUpdatedModel:function(){this._super();var t=this._model[this._sb.state.value("company").root_block.id];this._massage(t,null,0,(new Date).getTime()),this._sb.ext.debug("Finished massaging blocks")},rawPaths:function(){var t=this.rawArray()||[],e={};return t.forEach(function(t){t.paths.forEach(function(r){e[r]=t})}),e},rawArrayPaths:function(){return this._sb.ext.map(this.rawPaths(),function(t,e){return{path:e,block:t}})},progress:function(t){this._data(t,"_progress",this._sb.urls.BLOCKS_PROGRESS)},health:function(t){this._data(t,"_health",this._sb.urls.BLOCKS_HEALTH)},npv:function(t){this._data(t,"_npv",this._sb.urls.BLOCKS_NPV)},comments:function(t,e,r){this._property(e,"comments",t,r)},news:function(t,e,r){this._property(e,"news",t,r)},tags:function(t,e,r){this._property(e,"tags",t,r)},documents:function(t,e,r){this._property(e,"documents",t,r)},context:function(t,e,r){this._property(e,"context",t,r)},watching:function(t,e,r){this._property(e,"watching_users",t,r)},_property:function(t,e,r,n){if(!(this._propertiesList.indexOf(e)>=0))throw Error("BlockModel property is not valid:"+e);this._properties[e]=this._properties[e]||{},!this._properties[e][r]||n?(this._properties[e][r]="waiting",this._properties[e+"_queue"]=this._properties[e+"_queue"]||{},this._properties[e+"_queue"][r]=this._properties[e+"_queue"][r]||[],this._properties[e+"_queue"][r].push(t),this._sb.controller.invoke(this._sb.urls.BLOCKS_PROPERTIES,{id:r,type:e},this._handleProperty.bind(this,e,r))):"waiting"==this._properties[e][r]?this._properties[e+"_queue"][r].push(t):t(this._properties[e][r])},_data:function(t,e,r){var n=this._handleData.bind(this,e);this[e+"_queue"].push(t),this[e]?n():1==this[e+"_queue"].length&&this._sb.controller.invoke(r,null,n)},_handleData:function(t,e){for(this[t]=e?e.result:this[t],this._dataHandlers[t]&&e&&e.result&&this._dataHandlers[t].call(this,this[t]);this[t+"_queue"].length;){var r=this[t+"_queue"].pop();r(this[t])}},_handleProperty:function(t,e,r){for(this._properties[t]=this._properties[t]||{},this._properties[t][e]=r?r.result:this._properties[t][e];this._properties[t+"_queue"][e].length;){var n=this._properties[t+"_queue"][e].pop();n(this._properties[t][e])}},_massageHealth:function(t){var e=this._sb.ext.massageHealth;this._sb.ext.each(t,function(t){e(t)})},_massageProgress:function(t){var e=this._sb.ext.massageTA;this._sb.ext.each(t,function(t){e(t)})},_massageNpv:function(){},_massage:function(t,e,r,n){var s=t._schema!=n;t._schema=s?n:t._schema,t.paths=!s&&t.paths||[],t.children=t.children||[];var i=e?this._model[e.last()]:null;
if(i){var o=t.parents.find("parent_id",i.id).value,a=t.parents.find("linked_parent_id",null).value;o.position=i.children.indexOf(t.id),o.level=r,t.paths.put(e.concat([t.id])),i.id==a.parent_id&&(t.default_path=t.paths.last(),t.default_parent=i.id,t.default_level=r,t.default_position=o.position),i.is_owner&&(o.can_move_left=o.position>0,o.can_move_right=i.children.length-1>o.position&&i.children.length>1,o.can_delete=!0)}else t.default_path=[t.id],t.default_parent=null,t.paths.put([t.id]),t.default_position=0,t.default_level=0;for(var u=t.paths.last(),l=0;t.children.length>l;++l)this._massage(this._model[t.children[l]],u,r+1,n)},_resetArrayCache:function(){this._super(),this._modelArray.sort(this._sb.ext.sortBlocksByProgress)}});return e}),exports.blocksModel=t.require("sb_light/models/blocksModel"),t.define("sb_light/models/levelsModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"levels",t.urls.MODEL_LEVELS)}});return e}),exports.levelsModel=t.require("sb_light/models/levelsModel"),t.define("sb_light/models/focusModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"focus",t.urls.MODEL_FOCUS)}});return e}),exports.focusModel=t.require("sb_light/models/focusModel"),t.define("sb_light/models/risksModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"risks",t.urls.MODEL_RISKS)}});return e}),exports.risksModel=t.require("sb_light/models/risksModel"),t.define("sb_light/models/kpisModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"kpis",t.urls.MODEL_KPIS)},_massageUpdatedModel:function(){this._super();var t=this._sb;t.ext.each(this._model,function(e){t.ext.massageKpi(e)})}});return e}),exports.kpisModel=t.require("sb_light/models/kpisModel"),t.define("sb_light/models/companiesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"companies",t.urls.MODEL_COMPANIES)}});return e}),exports.companiesModel=t.require("sb_light/models/companiesModel"),t.define("sb_light/models/timezonesModel",["sb_light/models/_abstractModel"],function(t){var e=t.extend({init:function(t){this._super(t,"timezones",t.urls.MODEL_TIMEZONES)}});return e}),exports.timezonesModel=t.require("sb_light/models/timezonesModel"),t.define("sb_light/models",["sb_light/globals","sb_light/models/tagsModel","sb_light/models/newsModel","sb_light/models/usersModel","sb_light/models/blocksModel","sb_light/models/levelsModel","sb_light/models/focusModel","sb_light/models/risksModel","sb_light/models/kpisModel","sb_light/models/companiesModel","sb_light/models/timezonesModel"],function(t,e,r,n,s,i,o,a,u,l,c){function d(e){var r=h[e];if(!r)throw Error("sb.appModel.js: Model name not found: "+e);return r.model||(r.model=new r.klass(t)),r}var h={tags:{klass:e},news:{klass:r},users:{klass:n},blocks:{klass:s},levels:{klass:i},focus:{klass:o},risks:{klass:a},kpis:{klass:u},companies:{klass:l},timezones:{klass:c}},f={};return f.reset=function(t){for(var e in h){var r=h[e]?h[e].model:null;r&&r.reset(t)}},f.get=function(t){var e=d(t);return e.model},f.subscribe=function(t,e,r){var n=d(t);return n.model.subscribe(e,r)},f.unsubscribe=function(t,e){var r=d(t);return r.model.unsubscribe(e)},f.rawArray=function(t){var e=d(t);return e.model?e.model.rawArray():void 0},f.raw=function(t){var e=d(t);return e.model?e.model.raw():void 0},f.select=function(e,r,n,s){var i=d(e);i.model&&(t.ext.debug("Doing a select on the model.",e),i.model.select(r,n,s))},f.isValid=function(t){var e=d(t),r=!1;return e.model&&(r=e.model.isValid()),r},f}),exports.models=t.require("sb_light/models"),t.define("sb_light/controller",["sb_light/globals"],function(t){var e={};return e.invoke=function(e,r,n,s,i){var o=t.urls.url(e,r),a={};e.deleteId&&delete r.id;var u=e.massageParamsFunc?t.urls[e.massageParamsFunc](r):r;null!=u&&(u instanceof Array?a.json=JSON.stringify(u):Object.keys(u).length>0&&(e.normalParams?a=u:a.json=JSON.stringify(u)));var l=e.post===void 0||e.post||!1;t.api.request(o,a,l,n,s,i||null)},e.forgotPassword=function(r,n,s){e.invoke(t.urls.LOGIN_FORGOT_PASSWORD,{username:r},n,s,t.state.invalid)},e.blockComment=function(r,n,s){e.invoke(t.urls.COMMENT_PROPERTIES_ADD,{id:r,body:n},s,s)},e.blockClose=function(r,n,s){e.invoke(t.urls.BLOCKS_CLOSE,t.ext.mixin({id:r},n),s,s)},e.blockPublish=function(r,n,s){e.invoke(t.urls.BLOCKS_MAKE_PUBLIC,{id:r,children:n},s,s)},e.changeDefaultCompany=function(r,n,s){e.invoke(t.urls.USERS_CHANGE_DEFAULT_COMPANY,{id:t.state.value("userId"),default_company_id:r},n,s)},e}),exports.controller=t.require("sb_light/controller"),t.define("sb_light/api/state",["sb_light/globals","sb_light/utils/consts"],function(t,e){function r(e){if(e){var r=e.user?e.user.id:null,n=e.company?e.company.id:null;(r!=o.userId||n!=o.companyId)&&(o.userId=e.user?e.user.id:null,o.companyId=e.company?e.company.id:o.companyId),null==o.block&&null!=e.block&&(o.block=e.block+"")}else o.userId=null,o.user=o.company=null;null==i.value("userId")?(t.ext.debug("setting session to unauthorized"),(i.unknown()||i.startup())&&(e.flash={notice:"Please enter your login credentials."}),o.session=i.session_invalid):(o.company=e.company,o.user=e.user,e.company&&e.company.license&&"expired"==e.company.license.status?(t.ext.debug("setting session to payment"),o.session=i.session_payment):(t.ext.debug("setting session to normal"),o.session=i.session_normal)),i.authorized()||t.models.reset(),i.value("flash",e.flash),i.value("errors",e.errors)}function n(t){for(var e in i.models)t&&t[e]&&(u[e]=a[e]=null,i.models[e].timestamp=t[e].timestamp,i.models[e].cb(t[e]))}function s(e,r){var n=r&&r.result,s=n[e.name]||n;null==e.raw()&&s&&(t.ext.isArray(s)&&(s=s.reduce(function(t,e){return t[e.id]=e,t},{})),e._handleUpdate({added:s})),u[e.name]=!1}var i={};i.stateKeys=["session_unknown","session_normal","session_payment","session_invalid","session_disconnected","session_startup"],i.stateKeys.reduce(function(t,e,r){return t[e]=r,t},i);var o={page:"",block:null,news:null,kpi:null,risk:null,tag:null,userId:null,companyId:null,company:null,user:null,session:i.session_startup,url:"",childBlock:null,blockTreeZoom:1,blockMapZoom:1,blockSettingsView:"",blockSettingsCollapse:"",blocksTreeView:e.BLOCKS_TREE.VIEW.STATUS,blocksMapView:e.BLOCKS_MAP.VIEW.RADIAL,blocksTimelineView:e.BLOCKS_TIMELINE.VIEW.CHART,previousBlock:null,previousPage:null},a={},u={},l={},c=["page","block","childBlock","blocksTreeView","blocksMapView","blocksTimelineView","manageBlockView"];return i.host="",i.models={},i.subscriptions={},i.url=function(e){return void 0!==e&&(e="string"==typeof e?t.urls.url_to_o(e):e,t.ext.each(e,function(t,e){i.value(t,e,!1)}),i.publish("url")),"#"+c.reduce(function(t,e){return val=i.value(e),null!==val&&void 0!==val?t.put([e,i.value(e)].join("=")):t},[]).join(";")},i.register=function(t,e,r){i.models[t.name]||(i.models[t.name]={timestamp:0,cb:r,urlDef:e},!i.authorized()||a||a[t.name]||(a[t.name]=_forceModelUpdate.bindDelay(i,200,t)))},i.resetTimestamp=function(t){i.models[t]&&(i.models[t].timestamp=0)},i.login=function(e,r,n,s){var a={};e&&r&&(a.username=e,a.password=r),o.companyId&&(a.company_id=o.companyId),t.api.post(t.urls.url(t.urls.LOGIN),a,n,s,i.unauthorized)},i.reset=function(e){o.session=i.session_unknown,e&&(o.companyId=e),o.block=null,o.news=null,o.kpi=null,o.risk=null,o.tag=null,t.queue.add(t.models.reset.bind(t.models),"sblight_models_reset")},i.logout=function(){t.api.post(t.urls.url(t.urls.LOGOUT)),i.reset()},i.changeCompany=function(e){i.reset(e),t.queue.add(i.publish.bind(i,"session"),"sblight_state_publish")},i.forceModelUpdate=function(e){if(a[e.name]&&(clearTimeout(a[e.name]),a[e.name]=null),!u[e.name]&&i.authorized()){u[e.name]=!0;var r=i.models[e.name];r.timestamp=0;var n=t.urls.url(r.urlDef),o=s.bind(i,e);t.api.get(n,null,o)}},i.any=function(){return!0},i.startup=function(){return o.session==i.session_startup},i.known=function(){return o.session!=i.session_unknown},i.unknown=function(){return o.session==i.session_unknown},i.unauthorized=function(){return o.session==i.session_unknown||o.session==i.session_invalid||o.session==i.session_startup},i.invalid=function(){return o.session==i.session_invalid},i.authorized=function(){return o.session==i.session_normal||o.session==i.session_payment},i.disconnected=function(){return o.session==i.session_disconnected},i.update=function(t){return r(t),n(t),i.publish.bindDelay(i,50,"session"),i.authorized()},i.value=function(t,e,r){if(void 0!==e&&o[t]!=e){var n=o[t],s=l[t],a=s?s(n||null,e):e;if("url"==t)throw"Please use State.url to change the url object directly.";o[t]=a,i.publish(t),c.indexOf(t)>-1&&(o.url=i.url(),r!==!1&&i.publish("url"))}return o[t]},i.clone=function(){return t.ext.mixin({},o)},i.getValueKey=function(e,r){var n=t.urls.s_to_o(i.value(e));return n[r]||null},i.setValueKey=function(e,r,n){var s=t.urls.s_to_o(i.value(e));null==n?delete s[r]:s[r]=n,i.value(e,t.urls.o_to_s(s))},i.subscribe=function(e,r){if(!t.ext.isFunc(r))throw"SB_LIGHT:State -- subscribing to an event with an invalid function.";t.ext.debug("subscribing to: ",e),i.subscriptions[e]=i.subscriptions[e]||{};var n="Sub_state_"+e+"_"+t.ext.unique();i.subscriptions[e][n]=r},i.unsubscribe=function(e,r){var n=this._sb.ext,s=[];n.each(i.subscriptions[e],function(t,e){(t==r||e==r)&&s.push(e)}),s.forEach(function(r){t.ext.debug("unsubscribing from: ",e),delete i.subscriptions[e][r]})},i.publish=function(e){i.subscriptions[e]||[];var r=i.value(e),n=t.ext;n.each(i.subscriptions[e],function(t){e.indexOf("Zoom")>-1?(n.debug("Publish Zoom: ",e,r),t.bindDelay(null,0,r)):(n.debug("Publish: ",e,r),t.bindDelay(null,50,r))})},i.addTimestamps=function(e){t.ext.debug("Adding timestamp for ",Object.keys(i.models).join(","));for(var r in i.models)e[r+"_timestamp"]=i.models[r].timestamp},i}),exports.state=t.require("sb_light/api/state"),t.define("sb_light/api/queries",["sb_light/globals"],function(t){var e={};e.company=function(e){var r=t.models.raw("companies");return e=e||t.state.value("companyId"),r&&e&&r[e]||null},e.fullname=function(e){var r=t.models.raw("users");return r&&e&&r[e]?r[e].name:"<removed>"},e.firstname=function(e){var r=t.models.raw("users");return r&&e&&r[e]?r[e].first_name:"<removed>"},e.currentUser=function(){var e=t.models.raw("users");return e&&e[t.state.value("userId")]||null},e.user=function(e){var r=t.models.raw("users");return r[e]},e.companyMembership=function(){var t=e.currentUser();if(t.company_membership)return t.company_membership;var r=e.company();return t&&r&&t.companies[r.id]||null},e.userDate=function(r,n){var s=e.currentUser();return t.moment(r,n).format(s.date_format)};var r="YYYY/MM/DD";e.userToServerDate=function(n){var s=e.currentUser(),i=t.moment(n,s.date_format);return i.format(r)},e.authors=function(){var e=t.state.value("companyId");return t.models.rawArray("users").filter(function(t){var r=t.company_membership||t.companies&&t.companies[e]||null;return r&&r.active&&("Author"==r.role||"Administrator"==r.role)}).sort(t.ext.sortUsers)},e.focusArea=function(e){var r=t.models.raw("focus");return r&&r[e]?r[e].title:null},e.focusAreaDesc=function(e){var r=t.models.raw("focus");return r&&r[e]?r[e].description:null},e.levelColor=function(e){var r=t.models.raw("levels"),n=r&&r[e]?r[e].color:null;return n?t.ext.to_color(n):null},e.levelName=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.levelPos=function(){var e=t.models.raw("levels");return e&&e[id]?e[id].title:null},e.currentNewsItem=function(){var e=t.state.value("news"),r=t.models.raw("news");return r&&e?r[e]:null};var n=/%(users|blocks)_(\d+)%/g;e.newsMessage=function(e){var r=n,s=t.models.raw("blocks"),i=t.models.raw("users");return e.msg.replace(r,function(t,e,r){return"blocks"==e?s[r]?s[r].title:"(unknown block)":"users"==e?i[r]?i[r].name:"(unknown user)":void 0})};var s=/%users_(\d+)%/g;e.newsUsers=function(t){var e=s,r=[],n=null;do n&&r.push(n[1]),n=e.exec(t.msg);while(n);return r};var i=/%blocks_(\d+)%/g;e.newsBlocks=function(t){var e=i,r=[],n=null;do n&&r.push(n[1]),n=e.exec(t.msg);while(n);return r},e.currentBlock=function(){return e.block(e.currentBlockId())},e.previousBlock=function(){return e.block(e.previousBlockId())},e.rootBlock=function(){var r=t.state.value("company");return r?e.block(r.root_block.id):null},e.currentBlockId=function(){var t=e.currentBlockPath();return t&&t.length?t.last():null},e.previousBlockId=function(){var t=e.previousBlockPath();return t&&t.length?t.last():null},e.currentBlockPath=function(r){return e.blockPath(t.state.value("block"),r)},e.currentBlockLevel=function(){return e.blockLevel(e.currentBlockPath())},e.previousBlockPath=function(r){var n=t.state.value("previousBlock")||t.state.value("company").root_block.id;return e.blockPath(n,r)},e.previousBlockLevel=function(){return e.blockLevel(e.previousBlockPath())},e.managedBlocks=function(){return t.models.rawArray("blocks").reduce(function(t,e){return e.is_manager?t.put(e):t},[])},e.parentPath=function(t,r){return t=e.blockPath(t),e.blockPath(t.slice(0,-1),r)},e.blockParentInfo=function(t){t=e.blockPath(t);var r=e.block(t);return r&&r.parents&&r.parents.length?r.parents.find("parent_id",t.last(1)).value:null},e.blockPath=function(t,r){t=o(t);var n=e.block(t);return n&&2>t.length&&n.parents.length>0&&(t=n.default_path),r?t.join("_"):t};var o=function(t){return"array"==typeof t?t:"number"==typeof t?[t+""]:"string"==typeof t?t.split("_"):t};e.blockId=function(t){return t=o(t),t&&t.length?t.last():null},e.block=function(r){var n=e.blockId(r),s=t.models.raw("blocks");return n&&s&&s[n]?s[n]:null},e.blockLevel=function(t){var r=e.blockParentInfo(t||e.currentBlockPath());return r?r.level:0},e.childrenPaths=function(t,r){t=e.blockPath(t);var n=e.block(t);return n?n.children.map(function(n){return e.blockPath(t.concat([n]),r)}):null},e.parentPaths=function(r,n){var s=e.block(r);return s.paths.reduce(function(e,r){var s=t.queries.parentPath(r,n);return s&&s.length?e.put(s):e},[])},e.siblingPaths=function(r,n){var s=e.block(r);return s.paths.reduce(function(e,s){var i=t.queries.childrenPaths(t.queries.parentPath(s),n);return i?(i=i.filter(function(e){return t.queries.blockPath(e,!0)!=t.queries.blockPath(r,!0)}),e.concat(i)):e},[])},e.arePathsEqual=function(t,r){return e.blockPath(t,!0)==e.blockPath(r,!0)},e.isCenterPath=function(t){return e.currentBlockPath(!0).indexOf(e.blockPath(t,!0))>-1},e.isCurrentPath=function(t){return e.arePathsEqual(t,e.currentBlockPath())},e.maxDate=function(){return t.ext.moment(e.rootBlock().end_date)},e.minDate=function(){return t.ext.moment(e.rootBlock().start_date)},e.dateRange=function(r){var n={minStart:t.moment(new Date(1980,1,1)),maxStart:t.moment(new Date(2038,12,31)),minEnd:t.moment(new Date(1980,1,1)),maxEnd:t.moment(new Date(2038,12,31))},s=e.block(r.default_parent),i=r.children.map(function(t){return e.block(t).start_date}).put(s?s.end_date:n.maxStart),o=r.children.map(function(t){return e.block(t).end_date}).put(s?s.start_date:n.minEnd);return n.maxStart=t.ext.minDate.apply(null,i),n.minStart=s?s.start_date:n.minStart,n.maxEnd=s&&!s.floating_end_date?s.end_date:n.maxEnd,n.minEnd=t.ext.maxDate.apply(null,o),n},e.is_link=function(t,e){return null!=a(t,e).linked_parent_id},e.custom_progress_weight=function(e,r){return t.ext.to_i(a(e,r).custom_progress_weight)};var a=function(e,r){var n=t.models.raw("blocks"),s=n[e],i=n[r];if(-1==s.children.indexOf(r))throw Error("Block("+r+") is not a parent of block("+e+")");return i.parents.reduce(function(t,r){return r.parent_id==e?t.put(r):t},[])[0]};return e.progressVariance=function(t){var r=e.block(t);if(r){var n=r.percent_progress||100,s=r.expected_progress||0;return s>0?Math.round(100*((n-s)/s)):100}return 0},e.blockFullTree=function(r,n,s){if(s=s||t.models.raw("blocks")){r=e.blockPath(r||e.rootBlock().default_path),n=n||[];var i=s[r.last()],o={name:i.title,data:i,path:r,children:[]},a=i.children.cloneExcept(n.last());a.map(function(t){return r.concat([t])});var u=r.last(1);u&&n.last()!=u&&a.unshift(r.slice(0,-1));var l=1;return a.forEach(function(t){var n=e.blockFullTree(t,r,s);l+=n.size,o.children.put(n)}),o.size=l,o}},e.buildStrategyTree=function(r){var n=e.currentBlockPath(),s=e.currentBlock(),i=t.models.raw("blocks");if(!n||!s||!i)return null;var o=n.reduce(function(t,e){var r=t.last()||[];return t.put(r.concat([e])),t},[]),a=-(o.length-1);if(s.children.length){var u=s.children.indexOf(r),l=s.children[0>u?0:u];o.push(o.last().concat([l]))}var c={},d=c;return o.forEach(function(e){var r=t.ext.slice(e,0,-1),n=r.last(),s=e.last(),o=n?i[n].children:[s],u=o.indexOf(s);d.children=o.map(function(e,n){var s=r.concat([e]).join("_"),o=t.state.value(t.consts.STATE.BLOCKS_TREE_VIEW),l=t.state.getValueKey(t.consts.STATE.BLOCK_SETTINGS_VIEW,s);return l&&l!=t.consts.BLOCK_SETTINGS.VIEW.DEFAULT.key||(l=o),{path:s,dy:a,dx:n-u,data:i[e],viewType:l}}),a+=1,d=d.children[u]}),c.children[0]},e}),exports.queries=t.require("sb_light/api/queries"),t.define("sb_light/api/urls",["sb_light/globals"],function(t){var e={},r={MODEL_BLOCKS:{url:"/blocks.js",post:!1},MODEL_COMPANIES:{url:"/companies.js",post:!1},MODEL_CAPABILITIES:{url:"/company_settings.js",post:!1},MODEL_EXPORTS:{url:"/exports.js",post:!1},MODEL_FOCUS:{url:"/focus.js",post:!1},MODEL_GROUPS:{url:"/groups.js",post:!1},MODEL_KPIS:{url:"/kpis.js",post:!1},MODEL_RISKS:{url:"/risks.js",post:!1},MODEL_LEVELS:{url:"/levels.js",post:!1},MODEL_NEWS:{url:"/news.js",post:!1},MODEL_LICENSES:{url:"/licenses.js",post:!1},MODEL_PROGRESS:{url:"/blocks/progress.js",post:!1},MODEL_HEALTH:{url:"/health_calculations.js",post:!1},MODEL_NPV:{url:"/blocks/npv.js",post:!1},MODEL_RISK:{url:"/blocks/risk.js",post:!1},MODEL_USERS:{url:"/users.js",post:!1},MODEL_TAGS:{url:"/tags.js",post:!1},MODEL_TIMEZONES:{url:"/companies/timezones.js",post:!1},MODEL_DASHBOARD:{url:"/reports/dashboard_layout.js",post:!1},BLOCKS_CONTEXT:{url:"/blocks/context/%id%.js"},BLOCKS_CLOSE:{url:"/blocks/close/%id%.js",deleteId:!0},BLOCKS_MANAGE_CHILDREN:{url:"/blocks/manage_children/%id%.js",deleteId:!0},BLOCKS_DELETE:{url:"/blocks/%type%/%id%.js",normalParams:!0},BLOCKS_DOCUMENTS:{url:"/blocks/documents/%id%.js"},BLOCKS_IMPORT:{url:"/blocks/import/%id%.js"},BLOCKS_INVITE:{url:"/blocks/invite/%id%.js"},BLOCKS_MAKE_PUBLIC:{url:"/blocks/make_public/%id%.js",normalParams:!0},BLOCKS_MOVE:{url:"/blocks/move/%id%.js",normalParams:!0},BLOCKS_PROPERTIES:{url:"/blocks/%type%/%id%.js"},BLOCKS_RELOCATE:{url:"/blocks/reassign_parent/%id%.js",normalParams:!0},BLOCKS_UPDATE:{url:"/blocks/update/%id%.js",massageParamsFunc:"massageParamsForBlockUpdate"},BLOCKS_UNWATCH:{url:"/blocks/unwatch/%id%.js"},BLOCKS_WATCHING_USERS:{url:"/blocks/watching_users/%id%.js"},BLOCKS_TAGGED:{url:"/blocks_for_tag/%name%.js"},BLOCKS_UPDATE_GROUPS:{url:"/blocks/update_group_expression/%id%.js",normalParams:!0},BLOCKS_CHANGE_CHARTED_KPI:{url:"/blocks/set_default_kpi/%id%.js"},BLOCKS_UPDATE_CASHFLOWS:{url:"/blocks/update_net_cashflows/%id%.js"},BLOCKS_HEALTH:{url:"/blocks/health.js",normalParams:!0},BLOCKS_PROGRESS:{url:"/blocks/progress.js",normalParams:!0},BLOCK_FILES_UPLOAD_URL:{url:"/blocks/%id%/documents/create.js"},BLOCK_FILES_DOWNLOAD_URL:{url:"/blocks/%id%/documents/show/%doc_id%.js"},BLOCK_FILES_DELETE:{url:"/blocks/%id%/documents/destroy/%doc_id%.js"},BOOKMARKS:{url:"/saved_client_states/index.js"},BOOKMARK_CREATE_DYNAMIC:{url:"/saved_client_states/create_dynamic.js"},BOOKMARK_SAVE_DYNAMIC:{url:"/saved_client_states/%id%/save_dynamic.js",normalParams:!0},BOOKMARK_CREATE:{url:"/saved_client_states/create.js",normalParams:!0},BOOKMARK_UPDATE:{url:"/saved_client_states/%id%/update.js",normalParams:!0},BOOKMARK_DELETE:{url:"/saved_client_states/%id%/delete.js"},COMMENT_PROPERTIES_ADD:{url:"/blocks/%id%/comment.js",normalParams:!0,deleteId:!0},COMPANIES_CREATE:{url:"/companies/create.js"},COMPANIES_UPDATE:{url:"/companies/update.js"},COMPANIES_HEALTH:{url:"/health_calculations.js"},COMPANIES_HEALTH_CREATE:{url:"/health_calculations/create.js"},COMPANIES_HEALTH_UPDATE:{url:"/health_calculations/%id%/update.js"},COMPANIES_HEALTH_DELETE:{url:"/health_calculations/%id%/destroy.js"},COMPANIES_HEALTH_DEFAULT:{url:"/health_calculations/%id%/set_default.js"},COMPANIES_LOGO_PREVIEW_URL:{url:"/upload/company_logo_preview.js"},COMPANIES_REMOVE_PREVIEW_LOGO:{url:"/upload/remove_company_logo_preview.js"},CAPABILITIES_UPDATE:{url:"/company_settings/update.js"},EXPORTS_CREATE:{url:"/exports/%id%/create.js"},EXPORTS_REPORT:{url:"/exports/%id%/create.js"},EXPORTS_DELETE:{url:"/exports/%id%/destroy.js"},FOCUS_CREATE:{url:"/focus/create.js"},FOCUS_UPDATE:{url:"/focus/update/%id%.js",deleteId:!0},FOCUS_DELETE:{url:"/focus/destroy/%id%.js",deleteId:!0},FOCUS_REPARENT:{url:"/focus/reparent/%id%.js"},GROUPS_CREATE:{url:"/groups/create.js"},GROUPS_DELETE:{url:"/groups/%id%/destroy.js",deleteId:!0},GROUPS_UPDATE:{url:"/groups/%id%/update.js",deleteId:!0},GROUPS_ADD:{url:"/groups/%id%/add.js"},GROUPS_REMOVE:{url:"/groups/%id%/remove.js"},RISKS_CREATE:{url:"/risks/create.js"},RISKS_DESTROY:{url:"/risks/%id%/destroy.js"},RISKS_UPDATE:{url:"/risks/%id%/update.js"},RISKS_UPDATE_STATUS:{url:"/risks/%id%/update_status.js"},RISKS_ADD_IMPACT:{url:"/risks/%id%/add_impact.js"},RISKS_REMOVE_IMPACT:{url:"/risks/%id%/remove_impact.js"},RISKS_ATTACH_DOC:{url:"/risks/%id%/attach_document.js"},RISKS_SHOW_DOC:{url:"/risks/%id%/show_document/%doc_id%.js"},RISKS_DESTROY_DOC:{url:"/risks/%id%/destroy_document.js"},RISKS_DUMMY_REFRESH:{url:"/risks/%id%/refresh_risk.js"},RISKS_SETTINGS:{url:"/risk_profiles/update_risk_settings.js"},RISKS_MATRIX_SIZE:{url:"/risk_profiles/set_matrix_size.js"},RISKS_PROFILES_UPDATE:{url:"/risk_profiles/update_batch.js"},KPIS_CREATE:{url:"/kpis/create.js"},KPIS_DESTROY:{url:"/kpis/%id%/destroy.js"},KPIS_UPDATE:{url:"/kpis/%id%/update.js"},KPIS_ATTACH_BLOCK:{url:"/kpis/%id%/attach.js"},KPIS_DETACH_BLOCK:{url:"/kpis/%id%/detach.js"},LEVELS_UPDATE:{url:"/levels/update.js"},MEASURES_BLOCKS:{url:"/blocks/measure_values/%id%.js"},USERS_CREATE:{url:"/users/create.js"},USERS_CREATE_BATCH:{url:"/users/create_batch.js"},USERS_ADD_GROUP:{url:"/users/%id%/add_group.js",normalParams:!0},USERS_REMOVE_GROUP:{url:"/users/%id%/remove_group.js",normalParams:!0},USERS_ACTIVATE:{url:"/users/%id%/activate.js"},USERS_DEACTIVATE:{url:"/users/%id%/deactivate.js"},USERS_UPDATE:{url:"/users/%id%/update.js",deleteId:!0},USERS_REMOVE_MEMBERSHIP:{url:"/users/%id%/delete_membership.js"},USERS_CHANGE_MEMBERSHIP:{url:"/users/%id%/update_membership.js",deleteId:!0},USERS_CHANGE_DEFAULT_COMPANY:{url:"/users/%id%/change_default_company.js",normalParams:!0},REGISTER_COMPANY:{url:"/registration/register_company.js"},LOGIN:{url:"/login/auth.js"},LOGOUT:{url:"/login/logout.js"},LOGIN_FORGOT_PASSWORD:{url:"/login/forgot_password.js",normalParams:!0},LOGIN_REMEMBER_ME:{url:"/login/remember_me.js"},URL_SAVE_BOOKMARK:{url:"/users/save_bookmark.js"},PAYMENTS:{url:"/purchases/index.js"},PAYMENTS_QUOTE:{url:"/purchases/quote.js"},PAYMENTS_CREATE:{url:"/purchases/create.js"},ADMIN_RAISE:{url:"/admin/log_client_error.js"}};r.url=function(e,r){if(!e||!e.url)throw Error("Url does not exist: "+e);r=r||{};var s=e.url;for(var i in r)s=s.replace(n(i),r[i]);if(s.indexOf("%")>-1)throw Error("Bad url."+s);return t.state.host+s};var n=function(t){return e[t]=e[t]||RegExp("%"+t+"%"),e[t]};return r.massageParamsForBlockUpdate=function(t){return delete t.id,t},r.s_to_o=function(e){return e?e.split("-").reduce(function(e,r){return r?t.ext.set.apply(Object,[e].concat(r.split("!"))):e},{}):{}},r.o_to_s=function(e){return t.ext.map(e,function(t,e){return[e,t].join("!")}).join("-")},r.url_to_o=function(e){var r="string"==typeof e?e.split(";"):e;return r=t.ext.isArray(r)?r:r.reduce(function(r,n){if(n="string"==typeof n?n.split("="):n,t.ext.isArray(n))r[n[0]]=n[1];else{if(!n.key)throw"URL Cannot be parsed: "+JSON.stringify(e);r[n.key]=n.value}return r},{})},r.o_to_params=function(e){return t.ext.map(e,function(t,e){return e+"="+encodeURIComponent(t)}).join("&")},r}),exports.urls=t.require("sb_light/api/urls"),t.define("sb_light/api/api",["sb_light/globals"],function(t){function e(e,s,i){if(t.ext.debug("Sending request to ",e,i,JSON.stringify(s)),!o.ajax)throw"Error: sb.api.ajax has not been inititalized. Please set this value to one of the functions available in sb.ajax";s=s||{},t.state.addTimestamps(s),o.ajax({url:e,type:i?"POST":"GET",data:s,dataType:"json",context:o,success:r.bind(null,t.ext.slice(arguments)),error:n.bind(null,t.ext.slice(arguments))})}function r(e,r){t.ext.debug("SUCCESS: SB_Api",e,r),u=l;var n=t.state.authorized();if(t.state.update(r)){var s=t.ext.getResultMessages(r).errors;!s&&e[3]&&(e[3](r),i()),s&&e[4]&&(e[4](r),i())}else n&&(c.length=0),e[4]&&e[4](r)}function n(e,r){t.ext.debug("FAILURE SB_Api",JSON.stringify(r)),t.state.value("session",t.state.session_disconnected)}function s(e){var r=e.url+(JSON.stringify(e.params)||"");t.ext.debug("Pushing request on the queue: ",r),0==c.filter(function(t){return t.key==r}).length&&c.push({key:r,data:e})}function i(){if(a)t.ext.debug("Running Error Request"),e.apply(this,this._errorData);else if(c.length>0){var r=c.shift().data;r.state()?e.call(null,r.url,r.params,r.post,r.success,r.failure):(r.count+=1,this._maxRetries>r.count&&s.bindDelay(null,_retryDelay,r),i())}}var o={},a=null,u=50,l=50,c=[];return o.get=function(t,e,r,n,s){o.request(t,e,!1,r,n,s)},o.post=function(t,e,r,n,s){o.request(t,e,!0,r,n,s)},o.request=function(r,n,s,i,o,a){var u=a||t.state.authorized;u.call(t.state)&&e(r,n,s,i,o)},o}),exports.api=t.require("sb_light/api/api"),t.define("sb_light/api/ajax",["sb_light/globals"],function(t){var e={};return e.d3=function(e){return function(r){var n=r.url.replace(/^(https?:\/\/)/,"//"),s=t.urls.o_to_params(r.data);"POST"!==r.type&&s&&(n+="?"+s);var i=e.json(n).on("load",function(t){r.success(t)}).on("error",function(t){r.error(t)});t.state.host!==window.location.host&&i.header("Access-Control-Request-Method",r.type),"POST"!==r.type?i.get():(i.header("Content-type","application/x-www-form-urlencoded"),i.post(s))}},e.dojo=function(e){return function(r){r.url=r.url.replace(/^(https?:\/\/)/,"//"),t.ext.debug("dojo ajax",r.type,r.url),e(r.url,{method:r.type,data:r.data}).then(r.success,r.error)}},e.jquery=function(e){return function(r){var n=t.state.host!=window.location.host;r.url=n?r.url.replace(/^(https?:\/\/)/,"//"):r.url.replace(/^(https?:\/\/)?.+?\//,"/"),t.ext.debug("jquery ajax",r.type,r.url),e.ajax({type:r.type,url:r.url,data:r.data,dataType:r.dataType,crossDomain:n}).done(r.success).fail(r.error)}},e.node=function(e){return function(r){t.ext.debug("Request Agent: ",e);var n="POST"===r.type?e.post(r.url).send(r.data):e.get(r.url).query(r.data);n.set("Accept","application/json").end(function(e){e.ok?(t.ext.debug("Node Ajax success!",e.text),r.success&&r.success(JSON.parse(e.text))):(t.ext.debug("Node Ajax Error",e.text),r.error&&r.error(e.text))})}},e.titanium=function(){return function(e){var r,n;if(t.ext.ti()){var s=t.ext.merge({type:"GET",url:null,data:!1,contentType:"application/json",async:!0,autoEncodeUrl:!0,success:null,error:null,beforeSend:null,complete:null},e),i=Ti.Network.createHTTPClient({autoEncodeUrl:s.autoEncodeUrl,async:s.async});if("GET"===s.type&&s.data){n=[];for(r in s.data)n.put(r+"="+encodeURIComponent(s.data[r]));s.url+="?"+n.join("&"),delete s.data}return i.open(s.type,s.url),i.setRequestHeader("Content-Type",s.contentType),s.beforeSend&&s.beforeSend(i),i.setTimeout(1e4),i.onerror=function(){return null!==s.error?s.error(this):void 0},i.onload=function(){if(400>this.status)try{if(null!==s.success){var t=JSON.parse(this.responseText);return s.success(t)}}catch(e){return Ti.API.error("XHR success function threw Exception: "+e),void 0}else if(null!==s.error)return s.error(this)},s.data?(i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(s.data)):i.send(),null!==s.complete?s.complete(this):void 0}}},e}),exports.ajax=t.require("sb_light/api/ajax"),t.define("widgets/layoutWidget",["widgets/widget"],function(t){var e=t.extend({_layout:null,init:function(t,e,r){this._rootElement=this._rootElement||"div",this._super(t,e,r)},createDom:function(t){return t.widget=this._rootElement,this._dom=this._super(t),this._layout=this._sb.layout.parse(this,this.childrenLayout(),!0),this._dom},childrenLayout:function(){return[]},child:function(t){return this._layout.widgets[t]||this._layout.widgets[this.cid(t)]},applyLayout:function(){this._super(),this._sb.queue.add(this.bind("handleResize"),"handleResize_"+this.id())},handleResize:function(t){this._super(t);var e=this._dom.getBoundingClientRect();this._layout.rootWidth=e.width,this._layout.rootHeight=e.height,this._sb.layout.resize(this._layout)}});return e}),exports.layoutWidget=t.require("widgets/layoutWidget"),t.define("widgets/formInput",["widgets/layoutWidget"],function(t){var e=t.extend({create:function(){this._name="layoutWidget::formInput",this._super()},_propertyOverrides:function(){var t=this._super();return t.type=this.bind("type"),t.value=this.bind("value"),t.label=this.bind("label"),t.error=this.bind("error"),t},type:function(t,e){var r=this._sb.ext.slice(arguments,"type"==arguments[0]?1:0);return r.length?(this._layout.widgets[this.cid("input")].property("type",e),this):this._layout.widgets[this.cid("input")].property("type")},label:function(t,e){var r=this._sb.ext.slice(arguments,"label"==arguments[0]?1:0);return r.length?(this._layout.widgets[this.cid("label")].text(e),this):this._layout.widgets[this.cid("label")].text()},value:function(t,e){var r=this._sb.ext.slice(arguments,"value"==arguments[0]?1:0);return r.length?(this._layout.widgets[this.cid("input")].dom().value=e,this):this._layout.widgets[this.cid("input")].dom().value},error:function(t,e){var r=this._sb.ext.slice(arguments,"error"==arguments[0]?1:0);return r.length?(this._layout.widgets[this.cid("error")].text(e),this):this._layout.widgets[this.cid("error")].text()},childrenLayout:function(){return[{id:this.cid("label"),widget:"label",left:10,width:"24%",height:20,top:0,text:"Test Form Widget",style:"text-align:right"},{id:this.cid("input"),widget:"input",left:this.cidDim("label","r",20),width:"40%",height:20,top:0,value:"Test Input Widget"},{id:this.cid("error"),widget:"div",left:this.cidDim("input","r",20),width:"36%",height:20,top:0,text:"Error Widget"}]}});return e}),exports.formInput=t.require("widgets/formInput"),t.define("widgets/resizer",["widgets/layoutWidget"],function(t){var e=t.extend({_dragPos:null,_dragDim:"left",_min:0,_max:0,create:function(){this._name="layoutWidget::resizer",this._provideEvents("resize"),this._super()},postCreate:function(){this._super(),this.dom().addEventListener("mousedown",this.bind("_startDrag"))},_propertyOverrides:function(){var t=this._super();return t.min=this.bind("prop"),t.max=this.bind("prop"),t},childrenLayout:function(){return[{id:this.cid("mainBar"),widget:"div",fringe:2,style:"background-color:#FFF;border:solid 1px black;"},{id:this.cid("ghostBar"),widget:"div",fringe:3,left:4,style:"background-color:#000"}]},applyLayout:function(){this._super()},applyProperties:function(){this._super();var t=this.dom().getBoundingClientRect();this._dragDim=t.width>t.height?"top":"left",this.className(this._horizontal?"resizer-v":"resizer-h")},_startDrag:function(t){this._sb.events.stop(t),this._dragging=this.dim(this._dragDim),this.className("dragging"),this.dom().ownerDocument.body.addEventListener("mousemove",this.bind("_drag")),this.dom().ownerDocument.body.addEventListener("mouseup",this.bind("_stopDrag"))},_drag:function(t){var e=this.parentDom().getBoundingClientRect(),r=("left"==this._dragDim?t.clientX:t.clientY)-e[this._dragDim];r=this._sb.ext.range(this._min,this._max,r),this._sb.ext.debug("Resizer::Drag",this.id(),this._dragDim,this._min,this._max,r,t.clientX,e.left),this.dim(this._dragDim,r)},_stopDrag:function(){this._sb.ext.debug("Resizer::DragDone",this.id(),this._dragDim),this.className("dragging",!0),this.dom().ownerDocument.body.removeEventListener("mousemove",this.bind("_drag")),this.dom().ownerDocument.body.removeEventListener("mouseup",this.bind("_stopDrag")),this.trigger("resize")
}});return e}),exports.resizer=t.require("widgets/resizer"),t.define("widgets/pages/loginPage",["widgets/layoutWidget","widgets/formInput"],function(t,e){var r=t.extend({create:function(){this._name="widget::loginPage",this._super()},postCreate:function(){this._super(),this.dom().addEventListener("submit",this.bind("_handleSubmit"))},childrenLayout:function(){return[{id:this.cid("center_hack"),widget:"div",fringe:"49%",style:"display:none;"},{id:this.cid("form"),widget:"form",left:this.cidDim("center_hack",-300),right:this.cidDim("center_hack",-300),top:50,bottom:50,children:[{id:this.cid("title"),widget:"h3",text:"Welcome to StrategyBlocks",left:20,right:20,top:40,height:30,style:"text-align:center"},{id:this.cid("error"),widget:"p",left:20,right:20,top:this.cidDim("title","b",20),height:30},{id:this.cid("username"),widget:e,left:20,right:20,top:this.cidDim("error","b",20),height:30,value:"glenn.murphy@strategyblocks.com",label:"Email",error:""},{id:this.cid("password"),widget:e,left:20,right:20,top:this.cidDim("username","b",20),type:"password",value:"",height:30,label:"Password",error:""},{id:this.cid("submit"),widget:"button",type:"submit",width:80,left:"28%",height:25,top:this.cidDim("password","b",50),text:"Sign-In"}]}]},_handleSubmit:function(t){this._sb.events.stop(t);var e=this.child("username").value(),r=this.child("password").value();this._sb.state.login(e,r,this.bind("_handleSubmitResponse"),this.bind("_handleSubmitResponse"))},_handleSubmitResponse:function(t){var e=this._sb.ext.getResultMessages(t);e.errors&&t&&t.result&&t.result.errors&&result.errors.form&&(this.cid("username").error(t.result.errors.form.username),this.cid("password").error(t.result.errors.form.password)),this.child("error").text(e.errors?e.errors.message:e.warnings||e.notices||""),this.child("error").className("error",!e.errors),this.child("error").className("warning",e.errors||!e.warnings),this.child("error").className("notice",e.errors||!e.notices)}});return r}),exports.loginPage=t.require("widgets/pages/loginPage"),t.define("widgets/main",["widgets/widget","widgets/layoutWidget","widgets/formInput","widgets/resizer","widgets/svg","widgets/pages/loginPage"],function(t,e,r,n,s,i){return{widget:t,layoutWidget:e,formInput:r,resizer:n,svg:s,login:i}}),exports.sb_light=t.require("widgets/main"),t.define("sb_light/main",["sb_light/globals","sb_light/lib/moment","sb_light/utils/ext","sb_light/utils/subman","sb_light/utils/svg","sb_light/utils/queue","sb_light/utils/events","sb_light/layout","sb_light/utils/consts","sb_light/utils/Class","sb_light/models","sb_light/controller","sb_light/api/state","sb_light/api/queries","sb_light/api/urls","sb_light/api/api","sb_light/api/ajax","widgets/main"],function(t,e,r,n,s,i,o,a,u,l,c,d,h,f,p,_,m,g){if(t.debug=!0,t.moment=e||this.moment||window.moment,!t.moment&&!t.moment.version)throw"Moment JS has not been loaded properly.";return t.ext=r,t.subman=n,t.svg=s,t.queue=i,t.events=o,t.layout=a,t.consts=u,t.models=c,t.controller=d,t.state=h,t.queries=f,t.urls=p,t.api=_,t.ajax=m,t.Class=l,t.widgets=g,h.host="https://app.strategyblocks.com",t.ext.debug("Loaded SB: ",t.state.host),t}),exports.sb_light=t.require("sb_light/main")})();